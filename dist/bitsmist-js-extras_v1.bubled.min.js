!function(){"use strict";if(!window.BITSMIST||!window.BITSMIST.v1||!window.BITSMIST.v1.Component)throw new ReferenceError("Bitsmist Core Library does not exist.");var t=window.BITSMIST.v1,n=function(e){function n(n){e.call(this,Object.assign({notifyOnChange:!0,async:!1},n)),this._filter,this._observers=[],this.filter=t.Util.safeGet(this._options,"filter",(function(){return!0}))}e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n;var r={filter:{configurable:!0}};return r.filter.get=function(){return this._filter},r.filter.set=function(e){t.Util.assert("function"==typeof e,"Store.filter(setter): Filter is not a function. filter="+e,TypeError),this._filter=e},n.prototype.set=function(e,n,r){for(var i,o=[],a=arguments.length-3;a-- >0;)o[a]=arguments[a+3];var s={},c=e?this.get(e):this._items;if(c&&"object"==typeof c?this.__deepMerge(c,n,s):this.get(e)!==n&&(t.Util.safeSet(this._items,e,n),s[e]=n),t.Util.safeGet(r,"notifyOnChange",t.Util.safeGet(this._options,"notifyOnChange"))&&Object.keys(s).length>0)return(i=this).notify.apply(i,[s].concat(o))},n.prototype.replace=function(e,n){for(var r,i=[],o=arguments.length-2;o-- >0;)i[o]=arguments[o+2];if(this._items={},this.__deepMerge(this._items,e),t.Util.safeGet(n,"notifyOnChange",t.Util.safeGet(this._options,"notifyOnChange")))return(r=this).notify.apply(r,["*"].concat(i))},n.prototype.subscribe=function(e,n,r){t.Util.assert("function"==typeof n,"ObservableStore.subscribe(): Notification handler is not a function. id="+e,TypeError),this._observers.push({id:e,handler:n,options:r})},n.prototype.unsubscribe=function(e){for(var t=0;t<this._observers.length;t++)if(this._obvservers[t].id===e){this._observers.splice(t,1);break}},n.prototype.notify=function(e){for(var n,r,i=[],o=arguments.length-1;o-- >0;)i[o]=arguments[o+1];return t.Util.safeGet(this._options,"async",!1)?(n=this).notifyAsync.apply(n,[e].concat(i)):(r=this).notifySync.apply(r,[e].concat(i))},n.prototype.notifySync=function(e){for(var t=this,n=[],r=arguments.length-1;r-- >0;)n[r]=arguments[r+1];for(var i=Promise.resolve(),o=function(r){i=i.then((function(){var i,o;if((i=t)._filter.apply(i,[e,t._observers[r]].concat(n)))return(o=t._observers[r]).handler.apply(o,[e].concat(n))}))},a=0;a<t._observers.length;a++)o(a);return i},n.prototype.notifyAsync=function(e){for(var t,n,r=[],i=arguments.length-1;i-- >0;)r[i]=arguments[i+1];for(var o=0;o<this._observers.length;o++)(t=this)._filter.apply(t,[e,this._observers[o]].concat(r))&&(n=this._observers[o]).handler.apply(n,[e].concat(r));return Promise.resolve()},n.prototype.mute=function(){this._options.notifyOnChange=!1},n.prototype.unmute=function(){this._options.notifyOnChange=!0},n.prototype.__deepMerge=function(e,n,r){return r=r||{},t.Util.assert(e&&"object"==typeof e&&n&&"object"==typeof n,"ObservableStore.__deepMerge(): Parameters must be an object.",TypeError),Object.keys(n).forEach((function(t){Array.isArray(e[t])?(e[t]=e[t].concat(n[t]),r[t]=e[t]):e.hasOwnProperty(t)&&e[t]&&"object"==typeof e[t]&&n[t]&&"object"==typeof n[t]&&!(e[t]instanceof HTMLElement)?Util.deepMerge(e[t],n[t]):e[t]!==n[t]&&(e[t]=n[t],r[t]=e[t])})),e},Object.defineProperties(n.prototype,r),n}(t.ChainableStore);function r(){}function i(){}r.format=function(e,t,n){var i=n;switch(t.toLowerCase()){case"yyyy/mm/dd":i=r.formatDate(t,i);break;case"price":i=r.formatPrice(t,i)}return i},r.formatPrice=function(e,t){return t?"¥"+String(parseInt(t)).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,"):""},r.formatNumber=function(e){return e?String(parseInt(e)).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,"):""},r.formatDate=function(e,t){var n="";return t&&8===t.length&&(n=t.substr(0,4)+"/"+t.substr(4,2)+"/"+t.substr(6,2)),n},r.deformat=function(e,t,n){var i=n;switch(t){case"yyyy/mm/dd":i=r.deformatDate(t,n);break;case"price":i=r.deformatPrice(t,n)}return i},r.deformatPrice=function(e,t){var n="";return t&&(n=t.replace(/,/g,"").replace(/\//g,"").replace(/\\/g,"").replace("¥","")),n},r.deformatDate=function(e,t){var n="";return t&&(n=t.replace(/,/g,"").replace(/\//g,"").replace(/\\/g,"")),n},r.getNow=function(e){e=e||"-";var t=new Date;return t.getFullYear()+e+("00"+(t.getMonth()+1)).slice(-2)+e+("00"+t.getDate()).slice(-2)+" "+("00"+t.getHours()).slice(-2)+":"+("00"+t.getMinutes()).slice(-2)+":"+("00"+t.getSeconds()).slice(-2)},r.getToday=function(e){e=void 0===e?"-":e;var t=new Date;return t.getFullYear()+e+("00"+(t.getMonth()+1)).slice(-2)+e+("00"+t.getDate()).slice(-2)},r.sanitize=function(e){return"string"==typeof e?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"):e},i.showConditionalElements=function(e,n){t.Util.scopedSelectorAll(e,"[bm-visible]").forEach((function(e){var r=e.getAttribute("bm-visible");t.Util.safeEval(r,n,n)?e.style.removeProperty("display"):e.style.display="none"}))},i.hideConditionalElements=function(e){t.Util.scopedSelectorAll(e,"[bm-visible]").forEach((function(e){e.style.display="none"}))},i.setFields=function(e,n,o){var a=t.Util.safeGet(o,"masters"),s=t.Util.safeGet(o,"triggerEvent"),c=t.Util.scopedSelectorAll(e,"[bm-bind]");c.push(e),c.forEach((function(e){var o=e.getAttribute("bm-bind");if(o in n){var c=t.Util.safeGet(n,o,"");if(e.hasAttribute("bm-bindtext")){var l=e.getAttribute("bm-bindtext").split("."),u=l[0],d=l[1]||"";c=i._getMasterValue(a,u,n[o],d)}if(e.hasAttribute("bm-format")&&(c=r.format("",e.getAttribute("bm-format"),c)),i.setValue(e,c),s){var f=document.createEvent("HTMLEvents");f.initEvent(s,!0,!0),e.dispatchEvent(f)}}}))},i.getFields=function(e){var n={},r=t.Util.scopedSelectorAll(e,"[bm-bind]");return r.push(e),r.forEach((function(e){var r=e.getAttribute("bm-bind"),o=i.getValue(e);if(e.hasAttribute("bm-format")&&(o=t.FormatterUtil.deformat("",e.getAttribute("bm-format"),o)),Array.isArray(n[r]))o&&n[r].push(o);else if(n[r]){if(o){var a=[];a.push(n[r]),a.push(o),n[r]=a}}else n[r]=o})),n},i.clearFields=function(e,n){n=n||"";var r=t.Util.scopedSelectorAll(e,n+" input");r.forEach((function(e){switch(e.type.toLowerCase()){case"search":case"text":case"number":e.value="";break;case"checkbox":case"radio":e.checked=!1}})),r=e.querySelectorAll(n+" select"),(r=Array.prototype.slice.call(r,0)).forEach((function(e){e.selectedIndex=-1}))},i.setValue=function(e,t){null==t&&(t="");var n=e.getAttribute("bm-bindtarget");n?i._setValue_target(e,n,t):e.hasAttribute("value")?i._setValue_value(e,t):i._setValue_element(e,t)},i.build=function(e,t,n){if("select"===e.tagName.toLowerCase())i._build_select(e,t,n)},i.getValue=function(e){var t=void 0;switch(e.tagName.toLowerCase()){case"input":switch(e.type.toLowerCase()){case"radio":case"checkbox":e.checked&&(t=e.hasAttribute("value")?e.getAttribute("value"):e.checked);break;default:t=e.value}break;case"select":t=e.value;break;default:e.hasAttribute("selected")&&(t=e.getAttribute("value"))}return t},i._build_select=function(e,t,n){if(n=n||{},e.options.length=0,"emptyItem"in n){var r="text"in n.emptyItem?n.emptyItem.text:"",i="value"in n.emptyItem?n.emptyItem.value:"",o=document.createElement("option");o.text=r,o.value=i,o.setAttribute("selected",""),e.appendChild(o)}Object.keys(t).forEach((function(r){var i=document.createElement("option");i.text=n.text?t[r][n.text]:r,i.value=n.value?t[r][n.value]:r,e.appendChild(i)})),"defaultValue"in n&&(e.value=n.defaultValue)},i._build_radio=function(e,t,n){Object.keys(n.items).forEach((function(e){var t=document.createElement("label"),r=document.createElement("input");r.type="radio",r.id=key,r.name=key,r.value=e,r.setAttribute("bm-bind",key),r.setAttribute("bm-submit",""),t.appendChild(r),t.appendChild(document.createTextNode(n.items[e].title)),element.appendChild(t)}))},i._setValue_target=function(e,t,n){for(var r=t.split(","),i=0;i<r.length;i++){var o=r[i].toLowerCase();switch(o){case"text":e.innerText=n;break;case"html":e.innerHTML=n;break;case"outerhtml":n&&(e.outerHTML=n);break;case"href":case"src":case"rel":"http"!==n.substring(0,4)&&"/"!==n.substring(0,1)||e.setAttribute(o,n);break;default:var a=e.getAttribute(o);a=a?a+" "+n:n,e.setAttribute(o,a)}}},i._setValue_value=function(e,t){"input"===e.tagName.toLowerCase()&&"checkbox"===e.type.toLowerCase()||"input"===e.tagName.toLowerCase()&&"radio"===e.type.toLowerCase()?Array.isArray(t)?t.indexOf(e.getAttribute("value"))>-1&&(e.checked=!0):e.getAttribute("value")===t&&(e.checked=!0):e.setAttribute("value",t)},i._setValue_element=function(e,t){if("select"===e.tagName.toLowerCase())e.value=t;else if("input"===e.tagName.toLowerCase())switch(e.type.toLowerCase()){case"number":case"search":case"text":e.value=t;break;case"checkbox":e.checked=!!t;break;case"radio":e.value===t&&(e.checked=!0)}else e.innerText=t},i._getMasterValue=function(e,t,n,r){var i=n;if(e&&t in e){var o=e[t].getItem(n);o&&(i=o[r])}return i};var o=function(e){function n(t){e.call(this,t),this.filter=function(e,t){var n=!1;return("*"===e||e.indexOf(t.id)>-1)&&(n=!0),n}}return e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n,n.prototype.bindTo=function(e){var n=this,r=e.getAttribute("bm-bind");if(!!(!e.__bm_bindinfo||!e.__bm_bindinfo.bound)&&t.Util.safeGet(this._options,"2way",!0)){this.subscribe(r,(function(){i.setValue(e,n.get(r))}));var o=t.Util.safeGet(this._options,"eventName","change");e.addEventListener(o,function(){n.set(r,i.getValue(e),{notifyOnChange:!1})}.bind(this)),e.__bm_bindinfo={bound:!0}}},n}(n),a=function(e){function n(){e.apply(this,arguments)}e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n;var r={name:{configurable:!0}};return r.name.get=function(){return"FileOrganizer"},n.FileOrganizer_onDoOrganize=function(e,n,r){var i=[];return this._enumSettings(n.detail.settings.files,(function(e,n){i.push(t.AjaxUtil.loadScript(n.href))})),Promise.all(i)},n.getInfo=function(){return{sections:"files",order:110}},n.init=function(e,t){this._addOrganizerHandler(e,"doOrganize",n.FileOrganizer_onDoOrganize)},Object.defineProperties(n,r),n}(t.Organizer),s=function(e){function n(){e.apply(this,arguments)}e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n;var r={name:{configurable:!0}};return r.name.get=function(){return"ErrorOrganizer"},n.getInfo=function(){return{sections:"errors",order:120}},n.globalInit=function(){n._observers=new t.ObservableStore({filter:n.__filter}),document.addEventListener("DOMContentLoaded",(function(){t.settings.get("organizers.ErrorOrganizer.settings.captureError",!0)&&n.__initErrorListeners()}))},n.init=function(e,r){t.Util.safeGet(r,"settings.errors")&&n._observers.subscribe(e.uniqueId,e.trigger.bind(e),{component:e})},n.__filter=function(e,t){for(var n=[],r=arguments.length-2;r-- >0;)n[r]=arguments[r+2];for(var i=!1,o=t.options.component.settings.get("errors.targets"),a=n[0].error,s=0;s<o.length;s++)if(a.name===o[s]||"*"===o[s]){i=!0;break}return i},n.__initErrorListeners=function(){window.addEventListener("unhandledrejection",(function(e){var t={};try{e.reason?e.reason instanceof XMLHttpRequest?(t.message=e.reason.statusText,t.stack=e.reason.stack,t.object=e.reason):(t.message=e.reason.message,t.object=e.reason):t.message=e,t.type=e.type,t.name=n.__getErrorName(e),t.filename="",t.funcname="",t.lineno="",t.colno="",n.__handleException(t)}catch(e){}return!1})),window.addEventListener("error",(function(e,t,r,i){var o={};try{o.type="error",o.name=n.__getErrorName(e),o.message=e.message,o.file=e.filename,o.line=e.lineno,o.col=e.colno,e.error&&(o.stack=e.error.stack,o.object=e.error),n.__handleException(o)}catch(e){}return!1}))},n.__getErrorName=function(e){var t,n;if((n=e.reason instanceof XMLHttpRequest||e.reason?e.reason:e.error?e.error:e.message).name)t=n.name;else if(n instanceof TypeError)t="TypeError";else if(n instanceof XMLHttpRequest)t="AjaxError";else if(n instanceof EvalError)t="EvalError";else if(n instanceof RangeError)t="RangeError";else if(n instanceof ReferenceError)t="ReferenceError";else if(n instanceof SyntaxError)t="SyntaxError";else if(n instanceof URIError)t="URIError";else{var r=n.indexOf(":");r>-1&&(t=n.substring(0,r))}return t},n.__handleException=function(e){return n._observers.notifyAsync("error",{sender:n,error:e})},Object.defineProperties(n,r),n}(t.Organizer),c=function(e){function n(){e.apply(this,arguments)}e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n;var r={name:{configurable:!0}};return r.name.get=function(){return"ElementOrganizer"},n.ElementOrganizer_onDoOrganize=function(e,t,r){var i=this,o=n.getInfo().order;this._enumSettings(t.detail.settings.elements,(function(e,t){i.addEventHandler(e,{handler:n.ElementOrganizer_onDoProcess,order:o,options:{attrs:t}})}))},n.ElementOrganizer_onDoProcess=function(e,t,r){var i=this,o=r.options.attrs,a=[];return Object.keys(o).forEach((function(e){a=a.concat(n.__initElements(i,t,e,o[e]))})),Promise.all(a)},n.getInfo=function(){return{sections:"elements",order:220}},n.init=function(e,t){e._overlay,e._overlayPromise=Promise.resolve(),this._addOrganizerHandler(e,"doOrganize",n.ElementOrganizer_onDoOrganize)},n.__getTargetElements=function(e,t,n){return n.rootNode?"this"===n.rootNode||n.rootNode===e.tagName.toLowerCase()?[e]:e.rootElement.querySelectorAll(n.rootNode):"this"===t||t===e.tagName.toLowerCase()?[e]:e.rootElement.querySelectorAll("#"+t)},n.__initElements=function(e,t,r,o){for(var a=[],s=n.__getTargetElements(e,r,o),c=function(c){var l=s[c];Object.keys(o).forEach((function(t){switch(t){case"scroll":s[c].scrollTo(o[t]);break;case"showLoader":n.__showOverlay(e,o[t]),l=e._overlay;break;case"hideLoader":n.__hideOverlay(e,o[t]),l=e._overlay;break;case"build":var r=o[t].resourceName;i.build(s[c],e.resources[r].items,o[t]);break;case"attribute":n.__setAttributes(s[c],o[t]);break;case"class":n.__setClasses(s[c],o[t]);break;case"style":Object.keys(o[t]).forEach((function(e){s[c].style[e]=o[t][e]}));break;case"property":Object.keys(o[t]).forEach((function(e){s[c][e]=o[t][e]}));break;case"autoFocus":s[c].focus()}})),o.waitFor&&a.push(n.__waitFor(e,t,r,o,l))},l=0;l<s.length;l++)c(l);return a},n.__waitFor=function(e,n,r,i,o){var a=!1;switch(i.waitFor){case"transition":a="0s"!==window.getComputedStyle(o).getPropertyValue("transition-duration");break;case"animation":a="none"!==window.getComputedStyle(o).getPropertyValue("animation-name")}return t.Util.warn(a,"ElementOrganizer.__initAttr(): Element not in "+i.waitFor+". name="+e.name+", eventName="+n.type+", elementName="+r),new Promise((function(a,s){var c=setTimeout((function(){s("ElementOrganizer.__initAttr(): Timed out waiting for "+i.waitFor+". name="+e.name+", eventName="+n.type+", elementName="+r)}),t.settings.get("system.waitForTimeout",1e4));o.addEventListener(i.waitFor+"end",(function(){clearTimeout(c),a()}),{once:!0})}))},n.__setAttributes=function(e,t){Object.keys(t).forEach((function(n){switch(n){case"add":Object.keys(t[n]).forEach((function(r){e.setAttribute(r,t[n][r])}));break;case"remove":for(var r=0;r<t[n].length;r++)e.removeAttribute(t[n][r])}}))},n.__setClasses=function(e,t){Object.keys(t).forEach((function(n){switch(n){case"add":e.classList.add(t[n]);break;case"remove":e.classList.remove(t[n]);break;case"replace":e.setAttribute("class",t[n])}}))},n.__createOverlay=function(e,t){e._overlay||(e.insertAdjacentHTML("afterbegin",'<div class="overlay"></div>'),e._overlay=e.firstElementChild)},n.__closeOnClick=function(e,t){e._overlay.addEventListener("click",(function(t){t.target===t.currentTarget&&"function"==typeof e.close&&e.close({reason:"cancel"})}),{once:!0})},n.__getEffect=function(e){var t="";return"0s"!==window.getComputedStyle(e).getPropertyValue("transition-duration")?t="transition":"none"!==window.getComputedStyle(e).getPropertyValue("animation-name")&&(t="animation"),t},n.__showOverlay=function(e,r){var i,o;n.__createOverlay(e),t.Util.safeGet(r,"closeOnClick")&&n.__closeOnClick(e),window.getComputedStyle(e._overlay).getPropertyValue("visibility");var a=["show"].concat(t.Util.safeGet(r,"addClasses",[]));(i=e._overlay.classList).add.apply(i,a),(o=e._overlay.classList).remove.apply(o,t.Util.safeGet(r,"removeClasses",[]));var s=n.__getEffect(e._overlay);s?e._overlayPromise=new Promise((function(t,n){e._overlay.addEventListener(s+"end",(function(){t()}),{once:!0})})):s=Promise.resolve()},n.__hideOverlay=function(e,n){e._overlayPromise.then((function(){var r,i;window.getComputedStyle(e._overlay).getPropertyValue("visibility");var o=["show"].concat(t.Util.safeGet(n,"removeClasses",[]));(r=e._overlay.classList).remove.apply(r,o),(i=e._overlay.classList).add.apply(i,t.Util.safeGet(n,"addClasses",[]))}))},Object.defineProperties(n,r),n}(t.Organizer),l=function(e){function n(){e.apply(this,arguments)}e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n;var r={name:{configurable:!0}};return r.name.get=function(){return"ResourceOrganizer"},n.ResourceOrganizer_onDoOrganize=function(e,t,r){var i=this,o=[];return this._enumSettings(t.detail.settings.resources,(function(e,t){o.push(n._addResource(i,e,t))})),Promise.all(o)},n.ResourceOrganizer_onDoFetch=function(e,n,r){var i=this,o=[];return Object.keys(this._resources).forEach((function(e){var r=i._resources[e];r.options.get("autoFetch",!0)&&(r.target.id=t.Util.safeGet(n.detail,"id",r.target.id),r.target.parameters=t.Util.safeGet(n.detail,"parameters",r.target.parameters),o.push(r.get(r.target.id,r.target.parameters).then((function(){var t=i.settings.get("resources."+e+".autoSetProperty");t&&(i[t]=r.items)}))))})),Promise.all(o)},n.ResourceOrganizer_onDoSubmit=function(e,n,r){var i=this,o=[],a=t.Util.safeGet(n.detail,"items");return Object.keys(this._resources).forEach((function(e){var r=i._resources[e];if(r.options.get("autoSubmit",!0)){var s=t.Util.safeGet(n.detail,"method",r.target.method||"put"),c=t.Util.safeGet(n.detail,"id",r.target.id),l=t.Util.safeGet(n.detail,"parameters",r.target.parameters);o.push(i._resources[e][s](c,a,l))}})),Promise.all(o)},n.getInfo=function(){return{sections:"resources",order:300}},n.init=function(e,t){Object.defineProperty(e,"resources",{get:function(){return this._resources}}),e.addResource=function(e,t){return n._addResource(this,e,t)},e.switchResource=function(e){return n._switchResource(this,e)},e._resources={},this._addOrganizerHandler(e,"doOrganize",n.ResourceOrganizer_onDoOrganize),this._addOrganizerHandler(e,"doFetch",n.ResourceOrganizer_onDoFetch),this._addOrganizerHandler(e,"doSubmit",n.ResourceOrganizer_onDoSubmit)},n._addResource=function(e,n,r){t.Util.assert(r.handlerClassName,"ResourceOrganizer._addResource(): handler class name not specified. name="+e.name+", resourceName="+n);var i=t.ClassUtil.createObject(r.handlerClassName,e,n,r.handlerOptions);if(e._resources[n]=i,i.options.get("autoLoad")){var o=i.options.get("autoLoadOptions.id"),a=i.options.get("autoLoadOptions.parameters");return i.get(o,a).then((function(){var t=e.settings.get("resources."+n+".autoSetProperty");t&&(e[t]=i.items)}))}},n._switchResource=function(e){this._defaultResource=this._resources[e]},Object.defineProperties(n,r),n}(t.Organizer),u=function(e){function n(){e.apply(this,arguments)}e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n;var r={name:{configurable:!0}};return r.name.get=function(){return"ValidationOrganizer"},n.ValidationOrganizer_onDoOrganize=function(e,t,r){var i=this;this._enumSettings(t.detail.settings.validators,(function(e,t){n._addValidator(i,e,t)}))},n.ValidationOrganizer_onDoValidate=function(e,n,r){var i=n.detail.validatorName;if(i){t.Util.assert(this._validators[i],"ValidationOrganizer.organize(): Validator not found. name="+this.name+", validatorName="+i);var o=t.Util.safeGet(n.detail,"items"),a=this.settings.get("validators."+i+".rules"),s=this.settings.get("validators."+i+".handlerOptions");this._validators[i].checkValidity(o,a,s)}},n.ValidationOrganizer_onDoReportValidity=function(e,n,r){var i=n.detail.validatorName;if(i){t.Util.assert(this._validators[i],"ValidationOrganizer.organize(): Validator not found. name="+this.name+", validatorName="+i);var o=t.Util.safeGet(n.detail.settings,"items"),a=this.settings.get("validators."+i+".rules"),s=this.settings.get("validators."+i+".handlerOptions");this._validators[i].reportValidity(o,a,s)}},n.getInfo=function(){return{sections:["validators"],order:310}},n.init=function(e,t){Object.defineProperty(e,"validators",{get:function(){return this._validators}}),Object.defineProperty(e,"validationResult",{get:function(){return this._validationResult}}),e.addValidator=function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];return n._addValidator.apply(n,[this].concat(e))},e.validate=function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];return n._validate.apply(n,[this].concat(e))},e._validators={},e._validationResult={},this._addOrganizerHandler(e,"doOrganize",n.ValidationOrganizer_onDoOrganize),this._addOrganizerHandler(e,"doValidate",n.ValidationOrganizer_onDoValidate),this._addOrganizerHandler(e,"doReportValidity",n.ValidationOrganizer_onDoReportValidity)},n._addValidator=function(e,n,r){var i;return r.handlerClassName&&(i=t.ClassUtil.createObject(r.handlerClassName,e,n,r),e._validators[n]=i),i},n._validate=function(e,t){return t=t||{},e._validationResult={result:!0},Promise.resolve().then((function(){return e.trigger("beforeValidate",t)})).then((function(){return e.trigger("doValidate",t)})).then((function(){return e.validationResult.result?e.trigger("doValidateSuccess",t):e.trigger("doValidateFail",t)})).then((function(){return e.trigger("afterValidate",t)})).then((function(){if(!e._validationResult.result)return e.trigger("doReportValidity",t)}))},Object.defineProperties(n,r),n}(t.Organizer),d=function(e){function n(){e.apply(this,arguments)}e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n;var r={name:{configurable:!0}};return r.name.get=function(){return"FormOrganizer"},n.FormOrganizer_onAfterTransform=function(e,t,n){i.hideConditionalElements(this)},n.FormOrganizer_onDoClear=function(e,n,r){var o=t.Util.safeGet(n.detail,"target","");i.clearFields(this,o),this._items={}},n.FormOrganizer_onDoFill=function(e,n,r){var o=n.detail&&"rootNode"in n.detail?this.querySelector(n.detail.rootNode):this,a=t.Util.safeGet(n.detail,"items",this._items);i.setFields(o,a,{masters:this.resources,triggerEvent:"change"}),i.showConditionalElements(this,a)},n.getInfo=function(){return{sections:"forms",order:310,depends:"ValidationOrganizer"}},n.init=function(e,t){Object.defineProperty(e,"items",{get:function(){return this._items},set:function(e){this._items=e}}),Object.defineProperty(e,"cancelSubmit",{get:function(){return this._cancelSubmit}}),e.build=function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];return n._build.apply(n,[this].concat(e))},e.submit=function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];return n._submit.apply(n,[this].concat(e))},e._items={},e._cancelSubmit=!1,this._addOrganizerHandler(e,"afterTransform",n.FormOrganizer_onAfterTransform),this._addOrganizerHandler(e,"doClear",n.FormOrganizer_onDoClear),this._addOrganizerHandler(e,"doFill",n.FormOrganizer_onDoFill)},n._build=function(e,t,n,r){i.build(t,n,r)},n._submit=function(e,t){return t=t||{},e._cancelSubmit=!1,Promise.resolve().then((function(){e.settings.get("forms.settings.autoCollect",!0)&&(t.items=n.__collectData(e))})).then((function(){if(e.settings.get("forms.settings.autoValidate",!0))return t.validatorName=e.settings.get("forms.settings.validatorName"),e.validate(t).then((function(){e.validationResult.result||(e._cancelSubmit=!0)}))})).then((function(){return e.trigger("beforeSubmit",t).then((function(){if(!e._cancelSubmit)return Promise.resolve().then((function(){return e.trigger("doSubmit",t)})).then((function(){return e.items=t.items,e.trigger("afterSubmit",t)}))}))}))},n.__collectData=function(e,t){var n={},r=i.getFields(e),o=e.querySelectorAll("[bm-submit]");return(o=Array.prototype.slice.call(o,0)).forEach((function(e){var t=e.getAttribute("bm-bind");n[t]=r[t]})),n},Object.defineProperties(n,r),n}(t.Organizer),f=function(e){function n(){e.apply(this,arguments)}e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n;var r={name:{configurable:!0}};return r.name.get=function(){return"ListOrganizer"},n.ListOrganizer_onAfterTransform=function(e,n,r){return this._listRootNode=this.querySelector(this.settings.get("lists.settings.listRootNode")),t.Util.assert(this._listRootNode,"List.fill(): List root node not found. name="+this.name+", listRootNode="+this.settings.get("settings.listRootNode")),this.transformRow(this.settings.get("lists.settings.rowTemplateName"))},n.ListOrganizer_onBeforeFill=function(e,t,n){this._listRootNode.innerHTML=""},n.ListOrganizer_onDoFill=function(e,r,i){var o=this;this._rowElements=[];var a=t.Util.safeGet(r.detail.options,"async",this.settings.get("settings.async",!0))?n._buildAsync:n._buildSync,s=document.createDocumentFragment(),c=t.Util.safeGet(r.detail,"items",this._rows);return Promise.resolve().then((function(){return a(o,s,c)})).then((function(){o._listRootNode.appendChild(s)}))},n.getInfo=function(){return{sections:"lists",order:310}},n.init=function(e,t){Object.defineProperty(e,"rows",{get:function(){return this._rows},set:function(e){this._rows=e}}),e.transformRow=function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];return n._transformRow.apply(n,[this].concat(e))},e._rows=[],e._activeRowTemplateName="",this._addOrganizerHandler(e,"afterTransform",n.ListOrganizer_onAfterTransform),this._addOrganizerHandler(e,"beforeFill",n.ListOrganizer_onBeforeFill),this._addOrganizerHandler(e,"doFill",n.ListOrganizer_onDoFill)},n._transformRow=function(e,t,n){return n=n||{},e._activeRowTemplateName===t?Promise.resolve():Promise.resolve().then((function(){return e.loadTemplate(t)})).then((function(){e._activeRowTemplateName=t})).then((function(){return e.trigger("afterRowTransform",n)})).then((function(){}))},n._buildSync=function(e,r,i){t.Util.assert(e._templates[e._activeRowTemplateName],"List._buildSync(): Row template not loaded yet. name="+e.name+", rowTemplateName="+e._activeRowTemplateName);for(var o=Promise.resolve(),a=e.settings.get("rowevents"),s=e.templates[e._activeRowTemplateName].html,c=function(t){o=o.then((function(){return n._appendRowSync(e,r,t,i[t],s,a)}))},l=0;l<i.length;l++)c(l);return o},n._buildAsync=function(e,r,i){t.Util.assert(e.templates[e._activeRowTemplateName],"List._buildAsync(): Row template not loaded yet. name="+e.name+", rowTemplateName="+e._activeRowTemplateName);for(var o=e.settings.get("rowevents"),a=e.templates[e._activeRowTemplateName].html,s=0;s<i.length;s++)n._appendRowAsync(e,r,s,i[s],a,o)},n._createRow=function(e){var t=document.createElement("tbody");t.innerHTML=e;var n=t.firstElementChild;return n.setAttribute("bm-powered",""),n},n._appendRowSync=function(e,t,r,o,a,s){e.triggerAsync("beforeBuildRow",{item:o});var c=Promise.resolve();c=c.then((function(){var c=n._createRow(a);return t.appendChild(c),e._rowElements.push(c),s&&Object.keys(s).forEach((function(t){e.initEvents(t,s[t],c)})),Promise.resolve().then((function(){return e.trigger("beforeFillRow",{item:o,no:r,element:c})})).then((function(){i.showConditionalElements(c,o),i.setFields(c,o,{masters:e.resources})})).then((function(){return e.trigger("afterFillRow",{item:o,no:r,element:c})}))}))},n._appendRowAsync=function(e,t,r,o,a,s){e.triggerAsync("beforeBuildRow",{item:o});var c=n._createRow(a);t.appendChild(c),e._rowElements.push(c),s&&Object.keys(s).forEach((function(t){e.initEvents(t,s[t],c)})),e.triggerAsync("beforeFillRow",{item:o,no:r,element:c}),i.showConditionalElements(c,o),i.setFields(c,o,{masters:e.resources}),e.triggerAsync("afterFillRow",{item:o,no:r,element:c})},Object.defineProperties(n,r),n}(t.Organizer),p=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={name:{configurable:!0}};return n.name.get=function(){return"DatabindingOrganizer"},t.getInfo=function(){return{sections:"binds",order:320}},t.init=function(e,n){Object.defineProperty(e,"binds",{get:function(){return this._binds},set:function(e){t.update(this,e)}}),e.bindData=function(e){return t._bindData(this,e)},e.update=function(e){return t._update(this,e)},e._binds=new o},t.organize=function(e,n,r){switch(e){case"afterTransform":t._bindData(n);break;case"afterFetch":var i=r.bindings;i&&t.setResource(n,i)}},t.setResource=function(e,t){var n=t.resourceName;e._binds.replace(e.resources[n].item)},t.update=function(e,n){e._binds.items=n,t._bindData(e)},t._bindData=function(e,t){var n=(t=t||e).querySelectorAll("[bm-bind]");(n=Array.prototype.slice.call(n,0)).forEach((function(t){e._binds.bindTo(t)}))},Object.defineProperties(t,n),t}(t.Organizer),h=function(e){function n(){e.apply(this,arguments)}e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n;var r={name:{configurable:!0}};return r.name.get=function(){return"PluginOrganizer"},n.PluginOrganizer_onDoOrganize=function(e,t,r){var i=this;this._enumSettings(t.detail.settings.plugins,(function(e,t){n._addPlugin(i,e,t)}))},n.getInfo=function(){return{sections:"plugins",order:800}},n.init=function(e,t){e._plugins={},this._addOrganizerHandler(e,"doOrganize",n.PluginOrganizer_onDoOrganize)},n._addPlugin=function(e,n,r){var i,o="className"in(r=r||{})?r.className:n;return i=t.ClassUtil.createObject(o,e,r),e._plugins[n]=i,i},Object.defineProperties(n,r),n}(t.Organizer),g=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={name:{configurable:!0}};return n.name.get=function(){return"KeyOrganizer"},t.KeyOrganizer_onAfterTransform=function(e,n,r){var i=this,o=this.settings.get("keys");if(o){var a=t.__getActions(o);this.addEventListener("keydown",(function(e){t.KeyOrganizer_onKeyDown.call(this,e,this)})),this.addEventListener("keyup",(function(e){t.KeyOrganizer_onKeyUp.call(this,e,this,o,a)})),this._enumSettings(this.settings.get("keys"),(function(e,n){t.__initButtons(i,e,n)}))}},t.KeyOrganizer_onKeyDown=function(e,t){t.__isComposing=229===e.keyCode},t.KeyOrganizer_onKeyUp=function(e,n,r,i){if(!n.__isComposing){var o=e.key?e.key:t.__getKeyfromKeyCode(e.keyCode);switch(o){case"Esc":o="Escape";break;case"Down":o="ArrowDown";break;case"Up":o="ArrowUp";break;case"Left":o="ArrowLeft";break;case"Right":o="ArrowRight"}i[o=o.toLowerCase()]&&i[o].handler.call(this,e,n,i[o].option)}},t.getInfo=function(){return{sections:"keys",order:800}},t.init=function(e,n){e.__isComposing=!1,this._addOrganizerHandler(e,"afterTransform",t.KeyOrganizer_onAfterTransform)},t._defaultSubmit=function(e,t,n){return t.submit().then((function(){t.cancelSubmit||(t.isModal&&(t.modalResult.result=!0),n&&n.autoClose&&t.close({reason:"submit"}))}))},t._defaultCancel=function(e,t,n){return t.close({reason:"cancel"})},t._defaultClear=function(e,t,n){var r;return this.hasAttribute("bm-cleartarget")&&(r=this.getAttribute("bm-cleartarget")),t.clear({target:r})},t.__getKeyfromKeyCode=function(e){var t;if(13===e)t="Enter";else t=String.fromCharCode(e);return t},t.__initButtons=function(e,n,r){if(r&&r.rootNode){var i=r.handler?r.handler:t.__getDefaultHandler(n),o=e.querySelectorAll(r.rootNode);(o=Array.prototype.slice.call(o,0)).forEach((function(t){t.addEventListener("click",(function(t){i.call(this,t,e,r)}))}))}},t.__getActions=function(e){var n={};return Object.keys(e).forEach((function(r){for(var i=Array.isArray(e[r].key)?e[r].key:[e[r].key],o=0;o<i.length;o++)n[i[o]]={},n[i[o]].type=r,n[i[o]].handler=e[r].handler?e[r].handler:t.__getDefaultHandler(r),n[i[o]].option=e[r]})),n},t.__getDefaultHandler=function(e){var n;switch(e){case"submit":n=t._defaultSubmit;break;case"clear":n=t._defaultClear;break;case"cancel":n=t._defaultCancel}return n},Object.defineProperties(t,n),t}(t.Organizer),m=function(n){function r(){n.apply(this,arguments)}n&&(r.__proto__=n),r.prototype=Object.create(n&&n.prototype),r.prototype.constructor=r;var i={name:{configurable:!0}};return i.name.get=function(){return"ChainOrganizer"},r.onDoOrganize=function(e,t,n){var i=this,o=r.getInfo().order;this._enumSettings(t.detail.settings.chains,(function(e,t){i.addEventHandler(e,{handler:r.onDoProcess,order:o,options:t})}))},r.onDoProcess=function(e,n,i){for(var o=this,a=i.options,s=[],c=Promise.resolve(),l=function(e){var i=a[e].method||"refresh",l=a[e].state||"ready",u=a[e].sync,d=document.querySelectorAll(a[e].rootNode);d=Array.prototype.slice.call(d,0),t.Util.assert(d.length>0,"ChainOrganizer.onDoOrganizer(): Node not found. name="+o.name+", eventName="+n.type+", rootNode="+a[e].rootNode+", method="+i),c=u?c.then((function(){return r.__execTarget(o,d,i,l)})):r.__execTarget(o,d,i,l),s.push(c)},u=0;u<a.length;u++)l(u);return Promise.all(s)},r.getInfo=function(){return{sections:"chains",order:800}},r.init=function(e,t){this._addOrganizerHandler(e,"doOrganize",r.onDoOrganize)},r.deinit=function(t,n){var i=e.details.setting.chains;i&&Object.keys(i).forEach((function(e){t.removeEventHandler(e,{handler:r.onDoOrganize,options:i[e]})}))},r.__execTarget=function(e,t,n,r){var i=[];return t.forEach((function(t){var o=e.waitFor([{object:t,state:r}]).then((function(){return t[n]({sender:e})}));i.push(o)})),Promise.all(i)},Object.defineProperties(r,i),r}(t.Organizer),_=function(e){function n(){e.apply(this,arguments)}e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n;var r={name:{configurable:!0}};return r.name.get=function(){return"DialogOrganizer"},n.DialogOrganizer_onAfterReady=function(e,t,n){if(this.settings.get("dialogs.settings.autoOpen"))return this.open()},n.getInfo=function(){return{sections:"dialogs",order:800}},n.init=function(e,t){Object.defineProperty(e,"modalResult",{get:function(){return this._modalResult}}),Object.defineProperty(e,"isModal",{get:function(){return this._isModal}}),e.open=function(e){return n._open(this,e)},e.openModal=function(e){return n._openModal(this,e)},e.close=function(e){return n._close(this,e)},e._isModal=!1,e._cancelClose,e._cancelOpen,e._modalResult,e._modalPromise,this._addOrganizerHandler(e,"afterReady",n.DialogOrganizer_onAfterReady),e.settings.set("settings.autoRefresh",!1),e.settings.set("settings.autoRefreshOnOpen",!0),e.settings.set("settings.autoSetup",!1),e.settings.set("settings.autoSetupOnOpen",!0)},n._open=function(e,r){return r=r||{},e.trigger("beforeOpen",r).then((function(){if(!e._cancelOpen)return Promise.resolve().then((function(){if(e.settings.get("dialogs.backdropOptions.show"))return n.__showBackdrop(e,e.settings.get("dialogs.backdropOptions"))})).then((function(){if(t.Util.safeGet(r,"autoSetupOnOpen",e.settings.get("settings.autoSetupOnOpen")))return e.setup(r)})).then((function(){if(t.Util.safeGet(r,"autoRefreshOnOpen",e.settings.get("settings.autoRefreshOnOpen")))return e.refresh(r)})).then((function(){return e.trigger("doOpen",r)})).then((function(){return e.trigger("afterOpen",r)}))}))},n._openModal=function(e,t){return new Promise((function(r,i){return e._isModal=!0,e._modalResult={result:!1},e._modalPromise={resolve:r,reject:i},n._open(e,t)}))},n._close=function(e,t){return t=t||{},e._cancelClose=!1,e.trigger("beforeClose",t).then((function(){if(!e._cancelClose)return e.trigger("doClose",t).then((function(){if(e.settings.get("dialogs.backdropOptions.show"))return n.__hideBackdrop(e,e.settings.get("dialogs.backdropOptions"))})).then((function(){return e._isModal&&e._modalPromise.resolve(e._modalResult),e.trigger("afterClose",t)}))}))},n.__createBackdrop=function(e,t){n._backdrop||(document.body.insertAdjacentHTML("afterbegin",'<div class="backdrop"></div>'),n._backdrop=document.body.firstElementChild)},n.__showBackdrop=function(e,r){n.__createBackdrop(e);var i=new Promise((function(i,o){var a,s;window.getComputedStyle(n._backdrop).getPropertyValue("visibility");var c=["show"].concat(e.settings.get("dialogs.backdropOptions.showOptions.addClasses",[]));(a=n._backdrop.classList).add.apply(a,c),(s=n._backdrop.classList).remove.apply(s,e.settings.get("dialogs.backdropOptions.showOptions.removeClasses",[]));var l=n.__getEffect();l?n._backdrop.addEventListener(l+"end",(function(){t.Util.safeGet(r,"closeOnClick",!0)&&n.__closeOnClick(e),i()}),{once:!0}):(t.Util.safeGet(r,"closeOnClick",!0)&&n.__closeOnClick(e),i())}));if(t.Util.safeGet(r,"showOptions.sync",t.Util.safeGet(r,"sync")))return i},n.__hideBackdrop=function(e,r){var i=new Promise((function(t,r){var i,o;window.getComputedStyle(n._backdrop).getPropertyValue("visibility");var a=["show"].concat(e.settings.get("dialogs.backdropOptions.hideOptions.removeClasses",[]));(i=n._backdrop.classList).remove.apply(i,a),(o=n._backdrop.classList).add.apply(o,e.settings.get("dialogs.backdropOptions.hideOptions.addClasses",[]));var s=n.__getEffect();s?n._backdrop.addEventListener(s+"end",(function(){t()}),{once:!0}):t()}));if(t.Util.safeGet(r,"hideOptions.sync",t.Util.safeGet(r,"sync")))return i},n.__closeOnClick=function(e,t){n._backdrop.addEventListener("click",(function(t){t.target===t.currentTarget&&e.close({reason:"cancel"})}),{once:!0})},n.__getEffect=function(){var e="";return"0s"!==window.getComputedStyle(n._backdrop).getPropertyValue("transition-duration")?e="transition":"none"!==window.getComputedStyle(n._backdrop).getPropertyValue("animation-name")&&(e="animation"),e},Object.defineProperties(n,r),n}(t.Organizer),v=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={name:{configurable:!0}};return n.name.get=function(){return"PreferenceOrganizer"},t.PreferenceOrganizer_onDoOrganize=function(e,t,n){var r=this;return this.waitFor([{rootNode:"bm-preference"}]).then((function(){document.querySelector("bm-preference").subscribe(r,r.settings.get("preferences"))}))},t.getInfo=function(){return{sections:"preferences",order:900}},t.init=function(e,n){this._addOrganizerHandler(e,"doOrganize",t.PreferenceOrganizer_onDoOrganize)},Object.defineProperties(t,n),t}(t.Organizer);function y(e,t){void 0===t&&(t={});for(var n=function(e){for(var t=[],n=0;n<e.length;){var r=e[n];if("*"!==r&&"+"!==r&&"?"!==r)if("\\"!==r)if("{"!==r)if("}"!==r)if(":"!==r)if("("!==r)t.push({type:"CHAR",index:n,value:e[n++]});else{var i=1,o="";if("?"===e[s=n+1])throw new TypeError('Pattern cannot start with "?" at '.concat(s));for(;s<e.length;)if("\\"!==e[s]){if(")"===e[s]){if(0==--i){s++;break}}else if("("===e[s]&&(i++,"?"!==e[s+1]))throw new TypeError("Capturing groups are not allowed at ".concat(s));o+=e[s++]}else o+=e[s++]+e[s++];if(i)throw new TypeError("Unbalanced pattern at ".concat(n));if(!o)throw new TypeError("Missing pattern at ".concat(n));t.push({type:"PATTERN",index:n,value:o}),n=s}else{for(var a="",s=n+1;s<e.length;){var c=e.charCodeAt(s);if(!(c>=48&&c<=57||c>=65&&c<=90||c>=97&&c<=122||95===c))break;a+=e[s++]}if(!a)throw new TypeError("Missing parameter name at ".concat(n));t.push({type:"NAME",index:n,value:a}),n=s}else t.push({type:"CLOSE",index:n,value:e[n++]});else t.push({type:"OPEN",index:n,value:e[n++]});else t.push({type:"ESCAPED_CHAR",index:n++,value:e[n++]});else t.push({type:"MODIFIER",index:n,value:e[n++]})}return t.push({type:"END",index:n,value:""}),t}(e),r=t.prefixes,i=void 0===r?"./":r,o="[^".concat(b(t.delimiter||"/#?"),"]+?"),a=[],s=0,c=0,l="",u=function(e){if(c<n.length&&n[c].type===e)return n[c++].value},d=function(e){var t=u(e);if(void 0!==t)return t;var r=n[c],i=r.type,o=r.index;throw new TypeError("Unexpected ".concat(i," at ").concat(o,", expected ").concat(e))},f=function(){for(var e,t="";e=u("CHAR")||u("ESCAPED_CHAR");)t+=e;return t};c<n.length;){var p=u("CHAR"),h=u("NAME"),g=u("PATTERN");if(h||g){var m=p||"";-1===i.indexOf(m)&&(l+=m,m=""),l&&(a.push(l),l=""),a.push({name:h||s++,prefix:m,suffix:"",pattern:g||o,modifier:u("MODIFIER")||""})}else{var _=p||u("ESCAPED_CHAR");if(_)l+=_;else if(l&&(a.push(l),l=""),u("OPEN")){m=f();var v=u("NAME")||"",y=u("PATTERN")||"",O=f();d("CLOSE"),a.push({name:v||(y?s++:""),pattern:v&&!y?o:y,prefix:m,suffix:O,modifier:u("MODIFIER")||""})}else d("END")}}return a}function b(e){return e.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function O(e){return e&&e.sensitive?"":"i"}function w(e,t,n){return function(e,t,n){void 0===n&&(n={});for(var r=n.strict,i=void 0!==r&&r,o=n.start,a=void 0===o||o,s=n.end,c=void 0===s||s,l=n.encode,u=void 0===l?function(e){return e}:l,d=n.delimiter,f=void 0===d?"/#?":d,p=n.endsWith,h="[".concat(b(void 0===p?"":p),"]|$"),g="[".concat(b(f),"]"),m=a?"^":"",_=0,v=e;_<v.length;_++){var y=v[_];if("string"==typeof y)m+=b(u(y));else{var w=b(u(y.prefix)),S=b(u(y.suffix));if(y.pattern)if(t&&t.push(y),w||S)if("+"===y.modifier||"*"===y.modifier){var R="*"===y.modifier?"?":"";m+="(?:".concat(w,"((?:").concat(y.pattern,")(?:").concat(S).concat(w,"(?:").concat(y.pattern,"))*)").concat(S,")").concat(R)}else m+="(?:".concat(w,"(").concat(y.pattern,")").concat(S,")").concat(y.modifier);else"+"===y.modifier||"*"===y.modifier?m+="((?:".concat(y.pattern,")").concat(y.modifier,")"):m+="(".concat(y.pattern,")").concat(y.modifier);else m+="(?:".concat(w).concat(S,")").concat(y.modifier)}}if(c)i||(m+="".concat(g,"?")),m+=n.endsWith?"(?=".concat(h,")"):"$";else{var E=e[e.length-1],C="string"==typeof E?g.indexOf(E[E.length-1])>-1:void 0===E;i||(m+="(?:".concat(g,"(?=").concat(h,"))?")),C||(m+="(?=".concat(g,"|").concat(h,")"))}return new RegExp(m,O(n))}(y(e,n),t,n)}function S(e,t,n){return e instanceof RegExp?function(e,t){if(!t)return e;for(var n=/\((?:\?<(.*?)>)?(?!\?)/g,r=0,i=n.exec(e.source);i;)t.push({name:i[1]||r++,prefix:"",suffix:"",modifier:"",pattern:""}),i=n.exec(e.source);return e}(e,t):Array.isArray(e)?function(e,t,n){var r=e.map((function(e){return S(e,t,n).source}));return new RegExp("(?:".concat(r.join("|"),")"),O(n))}(e,t,n):w(e,t,n)}var R=function(e){function n(){e.apply(this,arguments)}e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n;var r={name:{configurable:!0}};return r.name.get=function(){return"RouteOrganizer"},n.RouteOrganizer_onDoOrganize=function(e,t,r){var i=this;this._enumSettings(t.detail.settings.routings,(function(e,t){n._addRoute(i,t)})),this._routeInfo=n.__loadRouteInfo(this,window.location.href),this._enumSettings(t.detail.settings.specs,(function(e,t){i._specs[e]=t}))},n.RouteOrganizer_onDoStart=function(e,t,n){if(this.routeInfo.specName){var r={query:this.settings.get("settings.query")};return this.switchSpec(this.routeInfo.specName,r)}},n.RouteOrganizer_onAfterReady=function(e,t,n){return this.openRoute()},n.RouteOrganizer_onDoValidateFail=function(e,t,r){this.settings.get("routings.settings.autoFix")&&n.__fixRoute(this,t.detail.url)},n.RouteOrganizer_onAfterValidate=function(e,t,r){if(!this.validationResult.result)throw n.__dumpValidationErrors(this),new URIError("URL validation failed.")},n.getInfo=function(){return{sections:["routings","specs"],order:900,depends:"ValidationOrganizer"}},n.globalInit=function(){history.replaceState(n.__getState("connect"),null,null)},n.init=function(e,r){Object.defineProperty(e,"routeInfo",{get:function(){return this._routeInfo}}),Object.defineProperty(e,"specs",{get:function(){return this._specs}}),Object.defineProperty(e,"spec",{get:function(){return this._spec}}),e.loadParameters=function(e){return n._loadParameters(e)},e.switchSpec=function(e,t){return n._switchSpec(this,e,t)},e.openRoute=function(e,t){return n._open(this,e,t)},e.jumpRoute=function(e,t){return n._jumpRoute(this,e,t)},e.updateRoute=function(e,t){return n._updateRoute(this,e,t)},e.refreshRoute=function(e,t){return n._refreshRoute(this,e,t)},e.replaceRoute=function(e,t){return n._replaceRoute(this,e,t)},e.normalizeRoute=function(){return n._normalizeRoute(this)},e._routes=[],e._specs={},e._spec=new t.ChainableStore({chain:e.settings,writeThrough:!0}),Object.defineProperty(e,"settings",{get:function(){return this._spec}}),this._addOrganizerHandler(e,"doOrganize",n.RouteOrganizer_onDoOrganize),this._addOrganizerHandler(e,"doStart",n.RouteOrganizer_onDoStart),this._addOrganizerHandler(e,"afterReady",n.RouteOrganizer_onAfterReady),this._addOrganizerHandler(e,"doValidateFail",n.RouteOrganizer_onDoValidateFail),this._addOrganizerHandler(e,"afterValidate",n.RouteOrganizer_onAfterValidate),n._loadAttrSettings(e),n.__initPopState(e)},n._addRoute=function(e,t,n){var r=[],i={origin:t.origin,name:t.name,path:t.path,keys:r,specName:t.specName,componentName:t.componentName,re:S(t.path,r)};n?e._routes.unshift(i):e._routes.push(i)},n._buildUrl=function(e,t,r){var i="";if(i+=t.url?t.url:"",i+=t.path?t.path:"",i+=t.query?"?"+t.query:"",t.queryParameters){var o={};r&&r.mergeParameters&&(o=Object.assign(o,e.routeInfo.queryParameters)),o=Object.assign(o,t.queryParameters),i+=n._buildUrlQuery(o)}return i||"/"},n._buildUrlQuery=function(e){var t="";return e&&(t=Object.keys(e).reduce((function(t,n){return Array.isArray(e[n])?t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n].join())+"&":e[n]&&(t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n])+"&"),t}),"")),t?"?"+t.slice(0,-1):""},n._loadParameters=function(e){e=e||window.location.href;var t,n,r={};if(window.location.href.indexOf("?")>-1)for(var i=e.slice(e.indexOf("?")+1).split("&"),o=0;o<i.length;o++)n=(t=i[o].split("="))[1]?t[1].split("#")[0]:t[1],r[t[0]]=decodeURIComponent(n);return r},n._switchSpec=function(e,r,i){return t.Util.assert(r,"RouteOrganizer._switchSpec(): A spec name not specified.",TypeError),Promise.resolve().then((function(){if(!e._specs[r])return n._loadSpec(e,r,i).then((function(t){e._specs[r]=t}))})).then((function(){e._spec.items=e._specs[r]})).then((function(){if(e.settings.get("settings.hasExtender"))return n._loadExtender(e,r,i)})).then((function(){return e.attachOrganizers({settings:e._specs[e._routeInfo.specName]})})).then((function(){return e.trigger("doOrganize",{settings:e._specs[e._routeInfo.specName]})})).then((function(){return e.trigger("afterLoadSettings",{settings:e._specs[e._routeInfo.specName]})}))},n._open=function(e,r,i){i=Object.assign({},i);var o,a,s=t.Util.safeGet(i,"pushState",!!r),c=e._routeInfo;if(r?(o=n._buildUrl(e,r,i),a=n.__loadRouteInfo(e,o)):(o=window.location.href,a=c),!i.jump&&a.name&&c.specName==a.specName)return Promise.resolve().then((function(){s&&history.pushState(n.__getState("_open.pushState"),null,o),e._routeInfo=a})).then((function(){if(c.specName!=a.specName)return n._updateRoute(e,c,a,i)})).then((function(){if(e.settings.get("routings.settings.autoValidate")){var t={validatorName:e.settings.get("routings.settings.validatorName"),items:n._loadParameters(o),url:o};return e.validate(t)}})).then((function(){return n._refreshRoute(e,a,i)})).then((function(){return n._normalizeRoute(e,window.location.href)}));n._jumpRoute(e,{url:o})},n._jumpRoute=function(e,t,r){var i=n._buildUrl(e,t,r);window.location.href=i},n._updateRoute=function(e,t,r,i){return n._switchSpec(e,r.specName)},n._refreshRoute=function(e,t,n){return e.refresh(n)},n._replaceRoute=function(e,t,r){history.replaceState(n.__getState("replaceRoute",window.history.state),null,n._buildUrl(e,t,r)),e._routeInfo=n.__loadRouteInfo(e,window.location.href)},n._normalizeRoute=function(e,t){return Promise.resolve().then((function(){return e.trigger("beforeNormalizeURL")})).then((function(){return e.trigger("doNormalizeURL")})).then((function(){return e.trigger("afterNormalizeURL")}))},n._loadAttrSettings=function(e){var t=e.getAttribute("bm-specpath");t&&e.settings.set("system.specPath",t)},n._loadSpec=function(e,n,r){var i=[],o=t.Util.safeGet(r,"path",t.Util.concatPath([e.settings.get("system.appBaseUrl",""),e.settings.get("system.specPath","")])),a=t.Util.deepMerge({type:"js",bindTo:this},r);return i.push(t.SettingOrganizer.loadFile(n,o,a)),Promise.all(i).then((function(e){return e[0]}))},n._loadExtender=function(e,n,r){var i=t.Util.safeGet(r,"query"),o=t.Util.safeGet(r,"path",t.Util.concatPath([e.settings.get("system.appBaseUrl",""),e.settings.get("system.specPath","")]))+n+".extender.js"+(i?"?"+i:"");return t.AjaxUtil.loadScript(o)},n.__loadRouteInfo=function(e,t){for(var r,i,o={},a=new URL(t,window.location.href),s={},c=e._routes.length-1;c>=0;c--)if(!e._routes[c].origin||a.origin==e._routes[c].origin){var l=e._routes[c].path?e._routes[c].re.exec(a.pathname):[];if(l){r=e._routes[c].name,i=e._routes[c].specName?e._routes[c].specName:"";for(var u=0;u<l.length-1;u++){s[e._routes[c].keys[u].name]=l[u+1];var d=e._routes[c].keys[u].name,f=l[u+1];i=i.replace("{{:"+d+"}}",f)}break}}return o.name=r,o.specName=i,o.url=a.href,o.path=a.pathname,o.query=a.search,o.parsedUrl=a,o.routeParameters=s,o.queryParameters=n._loadParameters(t),o},n.__initPopState=function(e){window.addEventListener("popstate",(function(t){return Promise.resolve().then((function(){return e.trigger("beforePopState")})).then((function(){return n._open(e,{url:window.location.href},{pushState:!1})})).then((function(){return e.trigger("afterPopState")}))}))},n.__getState=function(e,n){var r={msg:e};return n&&(r=t.Util.deepMerge(t.Util.deepClone(n),r)),r},n.__fixRoute=function(e,t){var r=!0,i=n._loadParameters(t);Object.keys(e.validationResult.invalids).forEach((function(t){var n=e.validationResult.invalids[t];void 0!==n.fix?i[n.key]=n.fix:"notAllowed"===n.failed[0].validity?delete i[n.key]:r=!1})),r&&(n._replaceRoute(e,{queryParameters:i}),e.validationResult.result=!0)},n.__dumpValidationErrors=function(e){Object.keys(e.validationResult.invalids).forEach((function(t){var n=e.validationResult.invalids[t];if(n.failed)for(var r=0;r<n.failed.length;r++);}))},Object.defineProperties(n,r),n}(t.Organizer),E=function(e,n){var r=this;this._component=e,this._options=new t.Store({items:Object.assign({},n)}),this._options.merge(this._getOptions()),this._options.set("name",this._options.get("name",this.constructor.name));var i=this._options.get("events",{});if(Object.keys(i).forEach((function(t){e.addEventHandler(t,i[t],null,r)})),this._options.get("expose")){var o=this;Object.defineProperty(e.__proto__,this._options.get("expose"),{get:function(){return o}})}},C={name:{configurable:!0},component:{configurable:!0}};C.name.get=function(){return this._options.get("name")},C.component.get=function(){return this._component},C.component.set=function(e){this._component=e},E.prototype._getOptions=function(){return{}},Object.defineProperties(E.prototype,C);var k=function(e,n,r){r=r||{},this._resourceName=n,this._component=e,this._options=new t.Store({items:r}),this._data={},this._items=[],this._name="ResourceHandler",this._target={},this._currentIndex=0},z={name:{configurable:!0},resourceName:{configurable:!0},target:{configurable:!0},data:{configurable:!0},items:{configurable:!0},options:{configurable:!0}};z.name.get=function(){return this._name},z.name.set=function(e){this._name=e},z.resourceName.get=function(){return this._resourceName},z.resourceName.set=function(e){this._resourceName=e},z.target.get=function(){return this._target},z.data.get=function(){return this._data},z.data.set=function(e){this._data=e,this._items=this.__reshapeItems(e)},z.items.get=function(){return this._items},z.options.get=function(){return this._options},k.prototype.get=function(e,t){var n=this;return Promise.resolve().then((function(){return n._get(e,t)})).then((function(e){return n.data=e,n._data}))},k.prototype.delete=function(e,t){var n=this;return Promise.resolve().then((function(){return n._delete(e,t)}))},k.prototype.post=function(e,t,n){var r=this;return t=this.__reshapeData(t),Promise.resolve().then((function(){return r._post(e,t,n)}))},k.prototype.put=function(e,t,n){var r=this;return t=this.__reshapeData(t),Promise.resolve().then((function(){return r._put(e,t,n)}))},k.prototype.getText=function(e){var t=e,n=this._options.get("fieldOptions.text");return this._items&&e in this._items&&(t=this._items[e][n]),t},k.prototype.getItem=function(e){var t;return this._items&&e in this._items&&(t=this._items[e]),t},k.prototype._get=function(e,t){},k.prototype._delete=function(e,t){},k.prototype._post=function(e,t,n){},k.prototype._put=function(e,t,n){},k.prototype.__reshapeItems=function(e){var n=this._options.get("fieldOptions.items"),r=n?t.Util.safeGet(e,n):e;this._options.get("reshapeOptions.get.reshape")&&(r=this._options.get("reshapeOptions.get.reshaper",this.__reshaper_get.bind(this))(r));return r},k.prototype.__reshapeData=function(e){if(this._options.get("reshapeOptions.put.reshape")){var t=this._options.get("reshapeOptions.put.reshaper",(function(){return e}));e=t(e)}return e},k.prototype.__reshaper_get=function(e){var t;if(e){var n=this._options.get("fieldOptions.id");t=e.reduce((function(e,t){return e[t[n]]=t,e}),{})}return t},Object.defineProperties(k.prototype,z);var A=function(e){function n(n,r,i){e.call(this,n,r,Object.assign({autoLoad:!0},i)),this._name="CookieResourceHandler",this._cookieName=t.Util.safeGet(i,"cookieOptions.name","preferences")}return e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n,n.prototype._get=function(e,t){return this.__getCookie(this._cookieName)},n.prototype._put=function(e,t,n){this.__setCookie(this._cookieName,t)},n.prototype.__getCookie=function(e){var t=document.cookie.split(";").reduce((function(e,t){var n=t.split("="),r=n[0],i=n[1];return r&&(e[r.trim()]=i?decodeURIComponent(i.trim()):void 0),e}),{});return t[e]?JSON.parse(t[e]):{}},n.prototype.__setCookie=function(e,t){var n=e+"="+encodeURIComponent(JSON.stringify(t))+"; ",r=this._options.get("cookieOptions");n+=Object.keys(r).reduce((function(e,t){return e+=t+"="+r[t]+"; "}),""),document.cookie=n},n}(k),I=function(e){function n(t,n,r){e.call(this,t,n,r),this._name="ApiResourceHandler"}return e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n,n.prototype._get=function(e,n){var r=this,i="GET",o=this._getOption("headers",i),a=this._getOption("options",i),s=this._getOption("url",i),c=s.dataType,l=this._buildApiUrl(this._resourceName,e,n,s);return t.AjaxUtil.ajaxRequest({url:l,method:i,headers:o,options:a}).then((function(e){return r._convertResponseData(e.responseText,c)}))},n.prototype._delete=function(e,n){var r="DELETE",i=this._getOption("headers",r),o=this._getOption("options",r),a=this._getOption("url",r);a.dataType;var s=this._buildApiUrl(this._resourceName,e,n,a);return t.AjaxUtil.ajaxRequest({url:s,method:r,headers:i,options:o})},n.prototype._post=function(e,n,r){var i="POST",o=this._getOption("headers",i),a=this._getOption("options",i),s=this._getOption("url",i),c=s.dataType,l=this._buildApiUrl(this._resourceName,e,r,s);return t.AjaxUtil.ajaxRequest({url:l,method:i,headers:o,options:a,data:this._convertRequestData(n,c)})},n.prototype._put=function(e,n,r){var i="PUT",o=this._getOption("headers",i),a=this._getOption("options",i),s=this._getOption("url",i),c=s.dataType,l=this._buildApiUrl(this._resourceName,e,r,s);return t.AjaxUtil.ajaxRequest({url:l,method:i,headers:o,options:a,data:this._convertRequestData(n,c)})},n.prototype._convertRequestData=function(e,t){return JSON.stringify(e)},n.prototype._convertResponseData=function(e,t){return JSON.parse(e)},n.prototype._getOption=function(e,t){var n=this._options.get("ajaxOptions",{}),r=e in n&&"COMMON"in n[e]?n[e].COMMON:{},i=e in n&&t in n[e]?n[e][t]:{};return Object.assign(r,i)},n.prototype._buildApiUrl=function(e,t,n,r){var i=r.baseUrl||this._component.settings.get("system.apiBaseUrl",""),o=r.scheme||"",a=r.host||"",s=r.dataType||"",c=r.version||"";return(r.format||"").replace("@scheme@",o).replace("@host@",a).replace("@baseUrl@",i).replace("@resource@",e).replace("@id@",t).replace("@dataType@",s).replace("@query@",this._buildUrlQuery(n)).replace("@version@",c)},n.prototype._buildUrlQuery=function(e){var t="";return e&&(t=Object.keys(e).reduce((function(t,n){return Array.isArray(e[n])?t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n].join())+"&":e[n]&&(t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n])+"&"),t}),"")),t?"?"+t.slice(0,-1):""},n}(k),U=function(e){function t(t,n,r){e.call(this,t,n,Object.assign({autoLoad:!0,autoFetch:!1,autoSubmit:!1},r)),this._name="ObjectResourceHandler",r.items&&(this.data=r.items)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype._get=function(e,t){return this._data},t.prototype._put=function(e,t,n){this.data=t},t}(k),P=function(e){function t(t,n,r){e.call(this,t,n,Object.assign({autoLoad:!0,autoFetch:!1,autoSubmit:!1},r)),this._name="LinkedResourceHandler",this._ref}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={data:{configurable:!0},items:{configurable:!0}};return n.data.get=function(){return this._ref.data},n.data.set=function(e){},n.items.get=function(){return this._ref.items},t.prototype.getText=function(e){return this._ref.getText(e)},t.prototype.getItem=function(e){return this._ref.getItem(e)},t.prototype._get=function(e,t){var n=this,r=this._options.get("rootNode"),i=this._options.get("resourceName")||this._resourceName;return this._component.waitFor([{rootNode:r}]).then((function(){return n._ref=document.querySelector(r).resources[i],n._ref}))},t.prototype._delete=function(e,t){return this._ref.delete(e,t)},t.prototype._post=function(e,t,n){return this._ref.post(e,t,n)},t.prototype._put=function(e,t,n){return this._ref.put(e,t,n)},Object.defineProperties(t.prototype,n),t}(k),N=function(e){function t(t,n,r){e.call(this,t,n,Object.assign({},r)),this._name="WebstorageResourceHandler"}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype._get=function(e,t){var n,r=localStorage.getItem(e);return r&&(n=JSON.parse(r)),n},t.prototype._delete=function(e,t){localStorage.removeItem(e)},t.prototype._post=function(e,t,n){localStorage.setItem(e,JSON.stringify(t))},t.prototype._put=function(e,t,n){localStorage.setItem(e,JSON.stringify(t))},t}(k),T=function(e,n,r){r=r||{},this._name=n,this._component=e,this._options=new t.Store({items:r})},j={name:{configurable:!0},options:{configurable:!0}};j.name.get=function(){return this._name},j.name.set=function(e){this._name=e},j.options.get=function(){return this._options},T.createValidationResult=function(e,t,n,r,i){return{key:e,value:t,message:T._getFunctionValue(e,t,"message",n),fix:T._getFunctionValue(e,t,"fix",n),failed:r,extras:i}},T.validate=function(e,t,n){t=t||{};var r={};return(n=n||{}).allowList&&Object.keys(e).forEach((function(i){if(-1===n.allowList.indexOf(i)){r[i]=T.createValidationResult(i,e[i],t[i],[{rule:"allowList",validity:"notAllowed"}])}})),n.allowOnlyInRules&&Object.keys(e).forEach((function(n){if(!(n in t)){r[n]=T.createValidationResult(n,e[n],t[n],[{rule:"allowList",validity:"notAllowed"}])}})),n.disallowList&&Object.keys(e).forEach((function(i){if(n.disallowList.indexOf(i)>-1){r[i]=T.createValidationResult(i,e[i],t[i],[{rule:"disallowList",validity:"disallowed"}])}})),Object.keys(t).forEach((function(n){if("constraints"in t[n]&&t[n].constraints&&"required"in t[n].constraints&&t[n].constraints.required&&!(n in e)){r[n]=T.createValidationResult(n,e[n],t[n],[{rule:"required",validity:"valueMissing"}])}})),r},T.prototype.checkValidity=function(e,t,n){},T.prototype.reportValidity=function(e,t){},T._getFunctionValue=function(e,t,n,r){var i;return r&&n in r&&(i="function"==typeof r[n]?r[n](e,t,r):r[n]),i},Object.defineProperties(T.prototype,j);var x=function(e){function n(){e.apply(this,arguments)}return e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n,n.validate=function(r,o){var a={};return t.Util.assert(r,"FormValidationHandler.checkValidity(): Form tag does not exist.",TypeError),t.Util.assert(r.checkValidity,"FormValidationHandler.checkValidity(): check validity not supported.",TypeError),t.Util.scopedSelectorAll(r,"input:not([novalidate])").forEach((function(t){var r=t.getAttribute("bm-bind"),s=i.getValue(t),c=o&&o[r]?o[r]:null,l=n._validateValue(t,r,s,c);l.length>0&&(a[r]=e.createValidationResult(r,s,c,l,{element:t}),a.message=a.message||t.validationMessage)})),a},n.prototype.checkValidity=function(r,o,a){var s,c={},l=this._component.querySelector("form");if(o||a){var u=i.getFields(l);c=e.validate(u,o,a)}s=n.validate(l,o);var d=t.Util.deepMerge(c,s);this._component.validationResult.result=!(Object.keys(d).length>0),this._component.validationResult.invalids=d},n.prototype.reportValidity=function(e,n){var r=this._component.querySelector("form");t.Util.assert(r,"FormValidationHandler.reportValidity(): Form tag does not exist.",TypeError),t.Util.assert(r.reportValidity,"FormValidationHandler.reportValidity(): Report validity not supported.",TypeError),r.reportValidity()},n._validateValue=function(e,t,n,r){var i=[],o=e.validity;if(!o.valid)for(var a in o)"valid"!==a&&o[a]&&i.push({validity:a});return i},n}(T),L=function(e){function n(){e.apply(this,arguments)}return e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n,n.validate=function(t,r){var i={};return r&&Object.keys(t).forEach((function(o){if(r[o]){var a=n._validateValue(o,t[o],r[o]);a.length>0&&(i[o]=e.createValidationResult(o,t[o],r[o],a))}})),i},n.prototype.checkValidity=function(r,i,o){var a=e.validate(r,i,o),s=n.validate(r,i),c=t.Util.deepMerge(a,s);this._component.validationResult.result=!(Object.keys(c).length>0),this._component.validationResult.invalids=c},n.prototype.reportValidity=function(e,t){},n._validateValue=function(e,t,r){var i=[];return r&&r.constraints&&Object.keys(r.constraints).forEach((function(o){var a=n._checkConstraint(e,t,o,r.constraints[o]);a&&i.push(a)})),i},n._checkConstraint=function(e,t,r,i){var o;switch(r){case"type":o=n._checkType(e,t,r,i);break;case"required":t||(o={rule:"required",validity:"valueMissing"});break;case"minlength":String(t).length<i&&(o={rule:"minlength",validity:"tooShort(min:"+i+")"});break;case"maxlength":String(t).length>i&&(o={rule:"maxlength",validity:"tooLong(max:"+i+")"});break;case"min":parseInt(t)<i&&(o={rule:"min",validity:"rangeUnderflow(min:"+i+")"});break;case"max":parseInt(t)>i&&(o={rule:"max",validity:"rangeOverflow(max:"+i+")"});break;case"pattern":new RegExp(i).test(t)||(o={rule:"pattern",validity:"patternMismatch(pattern:"+i+")"});break;case"valids":-1===i.indexOf(t)&&(o={rule:"valids",validity:"validsMismatch"});break;case"custom":i(e,t,i)||(o={rule:"custom",validity:"customMismatch"})}return o},n._checkType=function(e,t,n,r){var i;if(t)switch(r){case"object":"object"!=typeof t&&(i={rule:"type",validity:"typeMismatch(object)"});break;case"function":"function"!=typeof t&&(i={rule:"type",validity:"typeMismatch(function)"});break;case"string":"string"!=typeof t&&(i={rule:"type",validity:"typeMismatch(string)"});break;case"number":var o=parseInt(t);isNaN(o)&&(i={rule:"type",validity:"typeMismatch(number)"})}return i},n}(T);function V(e){return Reflect.construct(t.Component,[e],this.constructor)}function D(e){return Reflect.construct(t.Component,[e],this.constructor)}function F(e){return Reflect.construct(t.Component,[e],this.constructor)}function M(){return Reflect.construct(HTMLElement,[],this.constructor)}function H(){return Reflect.construct(HTMLElement,[],this.constructor)}function q(e){return Reflect.construct(t.Component,[e],this.constructor)}t.ClassUtil.inherit(V,t.Component),V.prototype._getSettings=function(){return{settings:{name:"ChainedSelect",autoClear:!0,autoSubmit:!0,useDefaultInput:!0,rootNodes:{newitem:".btn-newitem",removeitem:".btn-removeitem",edititem:".btn-edititem",select:"select"}},events:{this:{handlers:{beforeStart:["ChainedSelect_onBeforeStart"],afterTransform:["ChainedSelect_onAfterTransform"],doClear:["ChainedSelect_onDoClear"],doFill:["ChainedSelect_onDoFill"]}},"cmb-item":{rootNode:"select",handlers:{change:["ChainedSelect_onCmbItemChange"]}},"btn-newitem":{rootNode:".btn-newitem",handlers:{click:["ChainedSelect_onBtnNewItemClick"]}},"btn-edititem":{rootNode:".btn-edititem",handlers:{click:["ChainedSelect_onBtnEditItemClick"]}},"btn-removeitem":{rootNode:".btn-removeitem",handlers:{click:["ChainedSelect_onBtnRemoveItemClick"]}}},validators:{}}},Object.defineProperty(V.prototype,"items",{get:function(){for(var e=0,t=1;this.querySelector(":scope .item[data-level='"+t+"'] select");)t++,e++;return e}}),V.prototype.ChainedSelect_onBeforeStart=function(e,t,n){this.rootNodes=this.settings.get("settings.rootNodes"),this.settings.get("settings.useDefaultInput",!0)&&(this.addEventHandler("beforeAdd","ChainedSelect_onBeforeAdd"),this.addEventHandler("doAdd","ChainedSelect_onDoAdd"),this.addEventHandler("beforeEdit","ChainedSelect_onBeforeEdit"),this.addEventHandler("doEdit","ChainedSelect_onDoEdit"),this.addEventHandler("beforeRemove","ChainedSelect_onBeforeRemove"),this.addEventHandler("doRemove","ChainedSelect_onDoRemove"))},V.prototype.ChainedSelect_onAfterTransform=function(e,t,n){this.clear({fromLevel:1,toLevel:this.length}),this.settings.get("settings.isAddable",!0)||this.querySelectorAll(":scope "+this.rootNodes.newitem).forEach((function(e){e.style.display="none"})),this.settings.get("settings.isEditable",!0)||this.querySelectorAll(":scope "+this.rootNodes.edititem).forEach((function(e){e.style.display="none"})),this.settings.get("settings.isRemovable",!0)||this.querySelectorAll(":scope "+this.rootNodes.removeitem).forEach((function(e){e.style.display="none"}))},V.prototype.ChainedSelect_onDoClear=function(e,n,r){for(var i=t.Util.safeGet(n.detail,"fromLevel",1),o=t.Util.safeGet(n.detail,"toLevel",this.length),a=i;a<=o;a++)this.settings.get("settings.autoClear")&&(this.querySelector(":scope .item[data-level='"+a+"'] "+this.rootNodes.select).options.length=0),this.querySelector(":scope .item[data-level='"+a+"'] "+this.rootNodes.select).selectedIndex=-1,this._initElement("select",a),this._initElement("newitem",a),this._initElement("edititem",a),this._initElement("removeitem",a)},V.prototype.ChainedSelect_onDoFill=function(e,n,r){var i=t.Util.safeGet(n.detail,"level",1);this.assignItems(i,this.items)},V.prototype.ChainedSelect_onCmbItemChange=function(e,t,n){return this.selectItem(e.parentNode.getAttribute("data-level"),e.value)},V.prototype.ChainedSelect_onBtnNewItemClick=function(e,t,n){var r=this;if(!e.classList.contains("disabled")){var i=e.parentNode.getAttribute("data-level");this.modalResult={result:!1};var o={level:i,validatorName:""};return this.trigger("beforeAdd",o).then((function(){if(r.modalResult.result)return r.validate(o).then((function(){if(r.validationResult.result)return Promise.resolve().then((function(){return r.trigger("doAdd",o)})).then((function(){return r.trigger("afterAdd",o)})).then((function(){if(r.settings.get("settings.autoSubmit",!0))return r.submit(o)}))}))}))}},V.prototype.ChainedSelect_onBtnEditItemClick=function(e,t,n){var r=this;if(!e.classList.contains("disabled")){var i=e.parentNode.getAttribute("data-level");this.modalResult={result:!1};var o={level:i,validatorName:""};return this.trigger("beforeEdit",o).then((function(){if(r.modalResult.result)return r.validate(o).then((function(){if(r.validationResult.result)return Promise.resolve().then((function(){return r.trigger("doEdit",o)})).then((function(){return r.trigger("afterEdit",o)})).then((function(){if(r.settings.get("settings.autoSubmit",!0))return r.submit(o)}))}))}))}},V.prototype.onChainedSelect_onBtnRemoveItemClick=function(e,t,n){var r=this;if(!e.classList.contains("disabled")){var i=e.parentNode.getAttribute("data-level");this.modalResult={result:!1};var o={level:i,validatorName:""};return this.trigger("beforeRemove",o).then((function(){if(r.modalResult.result)return r.validate(o).then((function(){if(r.validationResult.result)return Promise.resolve().then((function(){return r.trigger("doRemove",o)})).then((function(){return r.trigger("afterRemove",o)})).then((function(){if(r.settings.get("settings.autoSubmit",!0))return r.submit(o)}))}))}))}},V.prototype.ChainedSelect_onBeforeAdd=function(e,t,n){var r=this;return new Promise((function(e,t){var n=window.prompt("アイテム名を入力してください","");n&&(r.modalResult.text=n,r.modalResult.value=n,r.modalResult.result=!0),e()}))},V.prototype.ChainedSelect_onDoAdd=function(e,t,n){return this.newItem(t.detail.level,this.modalResult.text,this.modalResult.value)},V.prototype.ChainedSelect_onBeforeEdit=function(e,n,r){var i=this,o=parseInt(t.Util.safeGet(n.detail,"level",1)),a=this.getSelect(o);return new Promise((function(e,t){var n=window.prompt("アイテム名を入力してください","");n&&(i.modalResult.old={text:a.options[a.selectedIndex].text,value:a.value},i.modalResult.new={text:n,value:n},i.modalResult.result=!0),e()}))},V.prototype.ChainedSelect_onDoEdit=function(e,t,n){this.editItem(t.detail.level,this.modalResult.new.text,this.modalResult.new.value)},V.prototype.ChainedSelect_onBeforeRemove=function(e,n,r){var i=this;return new Promise((function(e,r){if(window.confirm("削除しますか？")){var o=parseInt(t.Util.safeGet(n.detail,"level",1)),a=i.getSelect(o);i.modalResult.text=a.options[a.selectedIndex].text,i.modalResult.value=a.value,i.modalResult.result=!0}e()}))},V.prototype.ChainedSelect_onDoRemove=function(e,t,n){return this.removeItem(t.detail.level)},V.prototype.getSelect=function(e){return this.querySelector(":scope [data-level='"+e+"'] "+this.rootNodes.select)},V.prototype.assignItems=function(e,n){var r=this.querySelector(":scope [data-level='"+e+"'] > select");if(t.Util.assert(r,"ChainedSelect.editItem(): select not found. name="+this.name+", level="+e),n=n||{},Array.isArray(n))for(var i=function(e){var i=document.createElement("option");n[e],i.value=t.Util.safeGet(n[e],"value",n[e]),i.text=t.Util.safeGet(n[e],"text",n[e]);var o=t.Util.safeGet(n[e],"css");o&&Object.keys(o).forEach((function(e){i.css[e]=o[e]})),r.add(i)},o=0;o<n.length;o++)i(o);else Object.keys(n).forEach((function(e){var i=document.createElement("option");i.value=t.Util.safeGet(n[e],"value",e),i.text=t.Util.safeGet(n[e],"text",e);var o=t.Util.safeGet(n[e],"css");o&&Object.keys(o).forEach((function(e){i.css[e]=o[e]})),r.add(i)}));r.value="",this._initElement("select",e,!0),this._initElement("newitem",e,!0)},V.prototype.selectItem=function(e,n){var r=this,i=this.querySelector(":scope .item[data-level='"+e+"'] select");return t.Util.assert(i,"ChainedSelect.editItem(): select not found. name="+this.name+", level="+e),i.value=n,this._initElement("edititem",e,!0),this._initElement("removeitem",e,!0),this.clear({fromLevel:parseInt(e)+1,toLevel:this.length}),Promise.resolve().then((function(){if(e++,r.querySelector(":scope .item[data-level='"+e+"'] select"))return r._initElement("newitem",e),r.refresh({level:e,value:n})}))},V.prototype.newItem=function(e,n,r){var i=this.querySelector(":scope .item[data-level='"+e+"'] select");t.Util.assert(i,"ChainedSelect.editItem(): select not found. name="+this.name+", level="+e);var o=i.selectedIndex,a=document.createElement("option");a.value=r||n,a.text=n,i.add(a),i.selectedIndex=o},V.prototype.editItem=function(e,n,r){var i=this.querySelector(":scope .item[data-level='"+e+"'] select");t.Util.assert(i,"ChainedSelect.editItem(): select not found. name="+this.name+", level="+e),i.options[i.selectedIndex].text=n,i.options[i.selectedIndex].value=r||n},V.prototype.removeItem=function(e){var n=this.querySelector(":scope .item[data-level='"+e+"'] select");t.Util.assert(n,"ChainedSelect.removeItem(): select not found. name="+this.name+", level="+e),n.remove(n.selectedIndex),n.value="",this._initElement("edititem",e),this._initElement("removeitem",e),this.clear({fromLevel:parseInt(e)+1,toLevel:this.length})},V.prototype._initElement=function(e,t,n){e=this.rootNodes[e],n?(this.querySelector(":scope .item[data-level='"+t+"'] "+e).disabled=!1,this.querySelector(":scope .item[data-level='"+t+"'] "+e).classList.remove("disabled")):(this.querySelector(":scope .item[data-level='"+t+"'] "+e).disabled=!0,this.querySelector(":scope .item[data-level='"+t+"'] "+e).classList.add("disabled"))},t.ClassUtil.inherit(D,t.Component),D.prototype._getSettings=function(){return{settings:{autoTransform:!1,name:"BmTabindex"},events:{"tab-indices":{rootNode:"[data-tabindex]",handlers:{click:["TabIndex_onTabIndexClick"]}}}}},D.prototype.TabIndex_onTabIndexClick=function(e,t,n){e.classList.contains("active")||this.switchIndex(e.getAttribute("data-tabindex"))},D.prototype.switchIndex=function(e){this.querySelector(":scope [data-tabindex].active").classList.remove("active"),this.querySelector(":scope [data-tabindex='"+e+"']").classList.add("active");var t=document.querySelector(this.getAttribute("data-pair"));t&&t.switchContent(e)},D.prototype.getActiveIndex=function(){return this.querySelector(":scope .active")},customElements.define("bm-tabindex",D),t.ClassUtil.inherit(F,t.Component),F.prototype._getSettings=function(){return{settings:{autoTransform:!1,name:"BmTabcontent"}}},F.prototype.switchContent=function(e){this.querySelector(":scope > .active").classList.remove("active"),this.querySelector(":scope > [data-tabindex='"+e+"']").classList.add("active"),this.querySelector(":scope > [data-tabindex='"+e+"']").focus()},F.prototype.getActiveContent=function(){return this.querySelector(":scope .active")},customElements.define("bm-tabcontent",F),t.ClassUtil.inherit(M,t.Component),M.prototype.start=function(e){var n=this,r={settings:{name:"TagLoader"}};return e=e?t.Util.deepMerge(r,e):r,t.Component.prototype.start.call(this,e).then((function(){"loading"!==document.readyState?t.LoaderOrganizer.load(document.body,n.settings):document.addEventListener("DOMContentLoaded",(function(){t.LoaderOrganizer.load(document.body,n.settings)}))}))},customElements.define("bm-tagloader",M),t.ClassUtil.inherit(H,t.Component),H.prototype._getSettings=function(){return{settings:{name:"SettingServer",autoSetup:!1}}},customElements.define("bm-setting",H),t.ClassUtil.inherit(q,t.Component),q.prototype._getSettings=function(){return{settings:{autoClear:!1,autoFill:!1,autoTransform:!1,name:"PreferenceServer"},events:{this:{handlers:{beforeStart:["PreferenceServer_onBeforeStart"],doFetch:["PreferenceServer_onDoFetch"],beforeSubmit:["PreferenceServer_onBeforeSubmit"]}}},forms:{settings:{autoValidate:!1,autoCollect:!1}}}},q.prototype.PreferenceServer_onBeforeStart=function(e,r,i){this._defaults=new t.ChainableStore,this._store=new n({chain:this._defaults,filter:this._filter,async:!0})},q.prototype.PreferenceServer_onDoFetch=function(e,t,n){var r=this;return this.settings.get("defaults.preferences")&&(this._defaults.items=this.settings.get("defaults.preferences")),this.resources.preferences.get().then((function(e){r._store.merge(e),r.items=r._store.items}))},q.prototype.PreferenceServer_onBeforeSubmit=function(e,t,n){var r;(r=this._store).set.apply(r,["",t.detail.items,t.detail.options].concat(t.detail.args)),t.detail.items=this._store.items},q.prototype.subscribe=function(e,t){this._store.subscribe(e.name+"_"+e.uniqueId,this._triggerEvent.bind(e),t)},q.prototype.get=function(e,t){return this._store.get(e,t)},q.prototype.set=function(e,t){for(var n=[],r=arguments.length-2;r-- >0;)n[r]=arguments[r+2];return this.submit({items:e,options:t,args:n})},q.prototype._triggerEvent=function(e,n){var r=this.settings.get("preferences.settings.eventName","doSetup"),i=t.Util.safeGet(n,"sender");return this.trigger(r,{sender:i,items:e})},q.prototype._filter=function(e,t){var n=!1,r=t.options.targets;if("*"===r)n=!0;else{r=Array.isArray(r)?r:[r];for(var i=0;i<r.length;i++)if(e[r[i]]){n=!0;break}}return n},customElements.define("bm-preference",q),window.BITSMIST.v1.ObservableStore=n,window.BITSMIST.v1.BindableStore=o,t.OrganizerOrganizer.register(a),t.OrganizerOrganizer.register(s),t.OrganizerOrganizer.register(c),t.OrganizerOrganizer.register(l),t.OrganizerOrganizer.register(u),t.OrganizerOrganizer.register(d),t.OrganizerOrganizer.register(f),t.OrganizerOrganizer.register(p),t.OrganizerOrganizer.register(h),t.OrganizerOrganizer.register(g),t.OrganizerOrganizer.register(m),t.OrganizerOrganizer.register(_),t.OrganizerOrganizer.register(v),t.OrganizerOrganizer.register(R),window.BITSMIST.v1.Plugin=E,window.BITSMIST.v1.CookieResourceHandler=A,window.BITSMIST.v1.ApiResourceHandler=I,window.BITSMIST.v1.ObjectResourceHandler=U,window.BITSMIST.v1.LinkedResourceHandler=P,window.BITSMIST.v1.WebstorageResourceHandler=N,window.BITSMIST.v1.ValidationHandler=T,window.BITSMIST.v1.HTML5FormValidationHandler=x,window.BITSMIST.v1.ObjectValidationHandler=L,window.BITSMIST.v1.FormatterUtil=r,window.BITSMIST.v1.ChainedSelect=V,window.BITSMIST.v1.BmTabindex=D,window.BITSMIST.v1.BmTabcontent=F}();

!function(){"use strict";var e=function(e){function t(t){e.call(this,Object.assign({notifyOnChange:!0,async:!1},t)),this._observers=[]}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.set=function(e,t,r){var n=[],o=e?this.get(e):this._items;if(o&&"object"==typeof o?this.__deepMerge(o,t,n):this.get(e)!=t&&(BITSMIST.v1.Util.safeSet(this._items,e,t),n.push(e)),BITSMIST.v1.Util.safeGet(r,"notifyOnChange",BITSMIST.v1.Util.safeGet(this._options,"notifyOnChange"))&&n.length>0)return this.notify(n)},t.prototype.replace=function(e,t){if(this._items={},this.__deepMerge(this._items,e),BITSMIST.v1.Util.safeGet(t,"notifyOnChange",BITSMIST.v1.Util.safeGet(this._options,"notifyOnChange")))return this.notify("*")},t.prototype.subscribe=function(e,t,r){BITSMIST.v1.Util.assert("function"==typeof t,"ObservableStore.subscribe(): Notification handler is not a function. id="+e,TypeError),this._observers.push({id:e,handler:t,options:r})},t.prototype.unsubscribe=function(e){for(var t=0;t<this._observers.length;t++)if(this._obvservers[t].id==e){this._observers.splice(t,1);break}},t.prototype.notify=function(e){for(var t,r,n=[],o=arguments.length-1;o-- >0;)n[o]=arguments[o+1];return BITSMIST.v1.Util.safeGet(this._options,"async",!1)?(t=this).notifyAsync.apply(t,[e].concat(n)):(r=this).notifySync.apply(r,[e].concat(n))},t.prototype.notifySync=function(e){for(var t=this,r=[],n=arguments.length-1;n-- >0;)r[n]=arguments[n+1];for(var o=Promise.resolve(),i=function(n){o=o.then((function(){var o,i;if((o=t)._filter.apply(o,[e,t._observers[n]].concat(r)))return(i=t._observers[n]).handler.apply(i,[e].concat(r))}))},s=0;s<t._observers.length;s++)i(s);return o},t.prototype.notifyAsync=function(e){for(var t,r,n=[],o=arguments.length-1;o-- >0;)n[o]=arguments[o+1];for(var i=0;i<this._observers.length;i++)(t=this)._filter.apply(t,[e,this._observers[i].options].concat(n))&&(r=this._observers[i]).handler.apply(r,[e].concat(n));return Promise.resolve()},t.prototype.mute=function(){this._options.notifyOnChange=!1},t.prototype.unmute=function(){this._options.notifyOnChange=!0},t.prototype.__deepMerge=function(e,t,r){return r=r||[],BITSMIST.v1.Util.assert(e&&"object"==typeof e&&t&&"object"==typeof t,"ObservableStore.__deepMerge(): Parameters must be an object.",TypeError),Object.keys(t).forEach((function(n){Array.isArray(e[n])?(e[n]=e[n].concat(t[n]),r.push(n)):e.hasOwnProperty(n)&&e[n]&&"object"==typeof e[n]&&t[n]&&"object"==typeof t[n]&&!(e[n]instanceof HTMLElement)?Util.deepMerge(e[n],t[n]):e[n]!=t[n]&&(e[n]=t[n],r.push(n))})),e},t}(BITSMIST.v1.Store);function t(t){return function(t){function r(r){t.call(this,Object.assign({notifyOnChange:!0,async:!1},r)),Object.assign(this,e.prototype),this._observers=[]}return t&&(r.__proto__=t),r.prototype=Object.create(t&&t.prototype),r.prototype.constructor=r,r}(t)}function r(){}function n(){}r.format=function(e,t,n){var o=n;switch(t.toLowerCase()){case"yyyy/mm/dd":o=r.formatDate(t,o);break;case"price":o=r.formatPrice(t,o)}return o},r.formatPrice=function(e,t){return t?"¥"+String(parseInt(t)).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,"):""},r.formatNumber=function(e){return e?String(parseInt(e)).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,"):""},r.formatDate=function(e,t){var r="";return t&&8==t.length&&(r=t.substr(0,4)+"/"+t.substr(4,2)+"/"+t.substr(6,2)),r},r.deformat=function(e,t,n){var o=n;switch(t){case"yyyy/mm/dd":o=r.deformatDate(t,n);break;case"price":o=r.deformatPrice(t,n)}return o},r.deformatPrice=function(e,t){var r="";return t&&(r=t.replace(/,/g,"").replace(/\//g,"").replace(/\\/g,"").replace("¥","")),r},r.deformatDate=function(e,t){var r="";return t&&(r=t.replace(/,/g,"").replace(/\//g,"").replace(/\\/g,"")),r},r.getNow=function(e){e=e||"-";var t=new Date;return t.getFullYear()+e+("00"+(t.getMonth()+1)).slice(-2)+e+("00"+t.getDate()).slice(-2)+" "+("00"+t.getHours()).slice(-2)+":"+("00"+t.getMinutes()).slice(-2)+":"+("00"+t.getSeconds()).slice(-2)},r.getToday=function(e){e=void 0===e?"-":e;var t=new Date;return t.getFullYear()+e+("00"+(t.getMonth()+1)).slice(-2)+e+("00"+t.getDate()).slice(-2)},r.sanitize=function(e){return"string"==typeof e?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"):e},n.setFields=function(e,t,o){var i=BITSMIST.v1.Util.safeGet(o,"masters"),s=BITSMIST.v1.Util.safeGet(o,"triggerEvent"),a=e.querySelectorAll("[bm-bind]");Array.prototype.concat([e],Array.prototype.slice.call(a,0)).forEach((function(e){var o=e.getAttribute("bm-bind");if(o in t){var a=t[o]||"";if(e.hasAttribute("bm-bindtext")){var c=e.getAttribute("bm-bindtext").split("."),u=c[0],p=c[1]||"";a=n._getMasterValue(i,u,t[o],p)}if(e.hasAttribute("bm-format")&&(a=r.format("",e.getAttribute("bm-format"),a)),n.setValue(e,a),s){var l=document.createEvent("HTMLEvents");l.initEvent(s,!0,!0),e.dispatchEvent(l)}}}))},n.getFields=function(e){var t={},r=e.querySelectorAll("[bm-bind]");return(r=Array.prototype.slice.call(r,0)).forEach((function(e){var r=e.getAttribute("bm-bind"),o=n.getValue(e);if(e.hasAttribute("bm-format")&&(o=BITSMIST.v1.FormatterUtil.deformat("",e.getAttribute("bm-format"),o)),Array.isArray(t[r]))o&&t[r].push(o);else if(t[r]){if(o){var i=[];i.push(t[r]),i.push(o),t[r]=i}}else t[r]=o})),t},n.clearFields=function(e,t){t=t||"";var r=e.querySelectorAll(t+" input");(r=Array.prototype.slice.call(r,0)).forEach((function(e){switch(e.type.toLowerCase()){case"search":case"text":case"number":e.value="";break;case"checkbox":case"radio":e.checked=!1}})),r=e.querySelectorAll(t+" select"),(r=Array.prototype.slice.call(r,0)).forEach((function(e){e.selectedIndex=-1}))},n.setValue=function(e,t){void 0!==t&&null!=t||(t="");var r=e.getAttribute("bm-target");r?n._setValue_target(e,r,t):e.hasAttribute("value")?n._setValue_value(e,t):n._setValue_element(e,t)},n.build=function(e,t,r){switch(e.tagName.toLowerCase()){case"select":n._build_select(e,t,r)}},n.getValue=function(e){var t=void 0;switch(e.tagName.toLowerCase()){case"input":switch(e.type.toLowerCase()){case"radio":case"checkbox":e.checked&&(t=e.hasAttribute("value")?e.getAttribute("value"):e.checked);break;default:t=e.value}break;case"select":t=e.value;break;default:e.hasAttribute("selected")&&(t=e.getAttribute("value"))}return t},n.checkValidity=function(e){var t=[],r=e.querySelectorAll("input");return(r=Array.prototype.slice.call(r,0)).forEach((function(e){e.checkValidity()||t.push(e)})),t},n._build_select=function(e,t,r){if(e.options.length=0,"emptyItem"in r){var n="text"in r.emptyItem?r.emptyItem.text:"",o="value"in r.emptyItem?r.emptyItem.value:"",i=document.createElement("option");i.text=n,i.value=o,i.setAttribute("selected",""),e.appendChild(i)}Object.keys(t).forEach((function(n){var o=document.createElement("option");o.text=r.text?t[n][r.text]:n,o.value=r.value?t[n][r.value]:n,e.appendChild(o)})),"defaultValue"in r&&(e.value=r.defaultValue)},n._build_radio=function(e,t,r){Object.keys(r.items).forEach((function(e){var t=document.createElement("label"),n=document.createElement("input");n.type="radio",n.id=key,n.name=key,n.value=e,n.setAttribute("bm-bind",key),n.setAttribute("bm-submit",""),t.appendChild(n),t.appendChild(document.createTextNode(r.items[e].title)),element.appendChild(t)}))},n._setValue_target=function(e,t,r){for(var n=t.split(","),o=0;o<n.length;o++){var i=n[o].toLowerCase();switch(i){case"text":e.innerText=r;break;case"html":e.innerHTML=r;break;case"outerhtml":r&&(e.outerHTML=r);break;case"href":case"src":case"rel":"http"!=r.substring(0,4)&&"/"!=r.substring(0,1)||e.setAttribute(i,r);break;default:var s=e.getAttribute(i);s=s?s+" "+r:r,e.setAttribute(i,s)}}},n._setValue_value=function(e,t){"input"==e.tagName.toLowerCase()&&"checkbox"==e.type.toLowerCase()||"input"==e.tagName.toLowerCase()&&"radio"==e.type.toLowerCase()?Array.isArray(t)?t.indexOf(e.getAttribute("value"))>-1&&(e.checked=!0):e.getAttribute("value")==t&&(e.checked=!0):e.setAttribute("value",t)},n._setValue_element=function(e,t){if("select"==e.tagName.toLowerCase())e.value=t;else if("input"==e.tagName.toLowerCase())switch(e.type.toLowerCase()){case"number":case"search":case"text":e.value=t;break;case"checkbox":e.checked=!!t;break;case"radio":e.value==t&&(e.checked=!0)}else e.innerText=t},n._getMasterValue=function(e,t,r,n){var o=r;if(e&&t in e){var i=e[t].getItem(r);i&&(o=i[n])}return o};var o=function(e){function t(t){e.call(this,t),this.filter=function(e,t){for(var r=[],n=arguments.length-2;n-- >0;)r[n]=arguments[n+2];var o=!1;return("*"==e||e.indexOf(t.id)>-1)&&(o=!0),o}}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.bindTo=function(e){var t=this,r=e.getAttribute("bm-bind");if(!!(!e.__bm_bindinfo||!e.__bm_bindinfo.bound)&&BITSMIST.v1.Util.safeGet(this._options,"2way",!0)){this.subscribe(r,(function(){n.setValue(e,t.get(r))}));var o=BITSMIST.v1.Util.safeGet(this._options,"eventName","change");e.addEventListener(o,function(){t.set(r,n.getValue(e),{notifyOnChange:!1})}.bind(this)),e.__bm_bindinfo={bound:!0}}},t}(e),i=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.globalInit=function(){t._observers=new BITSMIST.v1.ObservableStore({filter:t.__filter}),document.addEventListener("DOMContentLoaded",(function(){BITSMIST.v1.settings.get("organizers.ErrorOrganizer.settings.captureError",!0)&&t.__initErrorListeners()}))},t.organize=function(e,r,n){r.settings.get("errors")&&t._observers.subscribe(r.uniqueId,r.trigger.bind(r),{component:r})},t.__filter=function(e,t,r,n){for(var o=!1,i=t.component.settings.get("errors.targets"),s=0;s<i.length;s++)if(n.error.name==i[s]){o=!0;break}return o},t.__initErrorListeners=function(){window.addEventListener("unhandledrejection",(function(e){var r={};return e.reason?e.reason instanceof XMLHttpRequest?(r.message=e.reason.statusText,r.stack=e.reason.stack,r.object=e.reason):(r.message=e.reason.message,r.object=e.reason):r.message=e,r.type=e.type,r.name=t.__getErrorName(e),r.filename="",r.funcname="",r.lineno="",r.colno="",t.__handleException(r),!1})),window.addEventListener("error",(function(e,r,n,o){var i={type:"error"};return i.name=t.__getErrorName(e),i.message=e.message,i.file=e.filename,i.line=e.lineno,i.col=e.colno,e.error&&(i.stack=e.error.stack,i.object=e.error),t.__handleException(i),!1}))},t.__getErrorName=function(e){var t,r;if((r=e.reason instanceof XMLHttpRequest||e.reason?e.reason:e.error?e.error:e.message).name)t=r.name;else if(r instanceof TypeError)t="TypeError";else if(r instanceof XMLHttpRequest)t="AjaxError";else if(r instanceof EvalError)t="EvalError";else if(r instanceof RangeError)t="RangeError";else if(r instanceof ReferenceError)t="ReferenceError";else if(r instanceof SyntaxError)t="SyntaxError";else if(r instanceof URIError)t="URIError";else{var n=r.indexOf(":");n>-1&&(t=r.substring(0,n))}return t},t.__handleException=function(e){return t._observers.notifyAsync("error",t,{error:e})},t}(BITSMIST.v1.Organizer),s=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.organize=function(e,t,r){var n=[],o=r.files;return o&&Object.keys(o).forEach((function(e){n.push(BITSMIST.v1.AjaxUtil.loadScript(o[e].href))})),Promise.all(n)},t}(BITSMIST.v1.Organizer),a=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.init=function(e,t){e._plugins={}},t.organize=function(e,r,n){var o=r.settings.get("plugins");o&&Object.keys(o).forEach((function(e){t._addPlugin(r,e,o[e])}))},t._addPlugin=function(e,t,r){var n,o="className"in(r=Object.assign({},r))?r.className:t;return n=BITSMIST.v1.ClassUtil.createObject(o,e,r),e._plugins[t]=n,n},t}(BITSMIST.v1.Organizer),c=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.init=function(e,r){Object.defineProperty(e,"resources",{get:function(){return this._resources}}),e.addResource=function(e,r,n){return t._addResource(this,e,r)},e.switchResource=function(e){return t._switchResource(this,e)},e._resources={}},t.organize=function(e,r,n){var o=[];switch(e){case"beforeStart":case"afterSpecLoad":var i=n.resources;i&&Object.keys(i).forEach((function(e){var n=t._addResource(r,e,i[e]);if(n.options.get("autoLoad")){var s=n.options.get("autoLoad.id"),a=n.options.get("autoLoad.parameters");o.push(r.resources[e].get(s,a))}}));break;case"doFetch":o.push(t.doFetch(r,n));break;case"doSubmit":o.push(t.doSubmit(r,n))}return Promise.all(o)},t._addResource=function(e,t,r){var n;return r.handlerClassName&&(n=BITSMIST.v1.ClassUtil.createObject(r.handlerClassName,e,t,r),e._resources[t]=n),n},t._switchResource=function(e){this._defaultResource=this._resources[e]},t.doFetch=function(e,r){for(var n=[],o=t.__getTargetResources(e,r,"autoFetch"),i=0;i<o.length;i++){var s=o[i],a=BITSMIST.v1.Util.safeGet(r,"id",e.resources[s].target.id),c=BITSMIST.v1.Util.safeGet(r,"parameters",e.resources[s].target.parameters);n.push(e.resources[s].get(a,c))}return Promise.all(n)},t.doSubmit=function(e,r){var n=[],o={},i=t.__getTargetResources(e,r,"autoSubmit");e.querySelectorAll("[bm-submit]").forEach((function(t){var r=t.getAttribute("bm-bind");o[r]=e.item[r]}));for(var s=0;s<i.length;s++){var a=i[s],c=BITSMIST.v1.Util.safeGet(r,"method",e.resources[a].target.method||"put"),u=BITSMIST.v1.Util.safeGet(r,"id",e.resources[a].target.id),p=BITSMIST.v1.Util.safeGet(r,"parameters",e.resources[a].target.parameters);n.push(e.resources[a][c](u,o,p))}return Promise.all(n)},t.__getTargetResources=function(e,t,r){var n=BITSMIST.v1.Util.safeGet(t,r,e._settings.get("settings."+r,[]));return Array.isArray(n)||("string"==typeof n?n=[e.settings.get("settings."+r)]:!0===n&&e.settings.get("settings.resourceName")&&(n=[e.settings.get("settings.resourceName")])),n},t}(BITSMIST.v1.Organizer),u=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(t(BITSMIST.v1.ChainableStore)),p=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.globalInit=function(){t._defaults=new BITSMIST.v1.ChainableStore,t._store=new u({chain:t._defaults,filter:t._filter,async:!0}),t.__loaded={},t.__loaded.promise=new Promise((function(e,r){t.__loaded.resolve=e,t.__loaded.reject=r}))},t.init=function(e,r){t._store.subscribe(e.name+"_"+e.uniqueId,t._triggerEvent.bind(e),{targets:BITSMIST.v1.Util.safeGet(r,"preferences.targets")})},t.organize=function(e,r,n){var o,i=Promise.resolve();return r.settings.get("preferences.defaults")&&(t._defaults.items=r.settings.get("preferences.defaults")),r.settings.get("preferences.settings.load")&&(i=r.resources.preferences.get().then((function(e){t._store.merge(e),t.__loaded.resolve()}))),i.then((function(){var e=r.settings.get("system.preferenceTimeout",1e4);return o=setTimeout((function(){throw new ReferenceError("Time out waiting for loading preferences. name="+r.name)}),e),t.__loaded.promise})).then((function(){clearTimeout(o)}))},t._triggerEvent=function(e){var r=this.settings.get("preferences.settings.eventName","doSetup");return this.trigger(r,t,{keys:e})},t._filter=function(e,t){var r=!1,n=t.targets;if("*"==n)r=!0;else{n=Array.isArray(n)?n:[n],e=Array.isArray(e)?e:[e];for(var o=0;o<n.length;o++)if(e.indexOf(n[o])>-1){r=!0;break}}return r},t}(BITSMIST.v1.Organizer),l=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.organize=function(e,r,n){var o=n.elements;o&&Object.keys(o).forEach((function(e){r.addEventHandler(e,{handler:t.onDoOrganize,options:{attrs:o[e]}})}))},t.onDoOrganize=function(e,r,n){var o=n.component,i=n.options.attrs;Object.keys(i).forEach((function(e){t.__initAttr(o,e,i[e])}))},t.__getTargetElements=function(e,t,r){return r.rootNode?"this"==r.rootNode||r.rootNode==e.tagName.toLowerCase()?[e]:e.querySelectorAll(r.rootNode):"this"==t||t==e.tagName.toLowerCase()?[e]:e.querySelectorAll("#"+t)},t.__initAttr=function(e,r,o){if(o)for(var i=t.__getTargetElements(e,r,o),s=function(t){Object.keys(o).forEach((function(r){switch(r){case"build":var s=o[r].resourceName;n.build(i[t],e.resources[s].items,o[r]);break;case"attribute":Object.keys(o[r]).forEach((function(e){i[t].setAttribute(e,o[r][e])}));break;case"style":Object.keys(o[r]).forEach((function(e){i[t].style[e]=o[r][e]}));break;case"property":Object.keys(o[r]).forEach((function(e){i[t][e]=o[r][e]}));break;case"autoFocus":i[t].focus()}}))},a=0;a<i.length;a++)s(a)},t}(BITSMIST.v1.Organizer),f=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.init=function(e,r){Object.defineProperty(e,"binds",{get:function(){return this._binds},set:function(e){t.update(this,e)}}),e.bindData=function(e){return t._bindData(this,e)},e.update=function(e){return t._update(this,e)},e._binds=new o},t.organize=function(e,r,n){switch(e){case"afterAppend":t._bindData(r);break;case"afterFetch":var o=n.bindings;o&&t.setResource(r,o)}},t.setResource=function(e,t){var r=t.resourceName;e._binds.replace(e.resources[r]._item)},t.update=function(e,r){e.binds.items=r,t._bindData(e)},t._bindData=function(e,t){(t=t||e).querySelectorAll("[bm-bind]").forEach((function(t){e.binds.bindTo(t)}))},t}(BITSMIST.v1.Organizer),h=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.init=function(e,t){e.__isComposing=!1},t.organize=function(e,r,n){var o=n.keys;if(o){var i=t.__getActions(o);r.addEventListener("keydown",(function(e){t.onKeyDown.call(this,e,r)})),r.addEventListener("keyup",(function(e){t.onKeyUp.call(this,e,r,o,i)})),Object.keys(o).forEach((function(e){t.__initButtons(r,e,o[e])}))}},t.onKeyDown=function(e,t){t.__isComposing=229==e.keyCode},t.onKeyUp=function(e,r,n,o){if(!r.__isComposing){var i=e.key?e.key:t.__getKeyfromKeyCode(e.keyCode);switch(i){case"Esc":i="Escape";break;case"Down":i="ArrowDown";break;case"Up":i="ArrowUp";break;case"Left":i="ArrowLeft";break;case"Right":i="ArrowRight"}o[i=i.toLowerCase()]&&o[i].handler.call(this,e,r,o[i].option)}},t._defaultSubmit=function(e,t,r){t.submit().then((function(){t.__cancelSubmit||(t._isModal&&(t._modalResult.result=!0),r&&r.autoClose&&t.close())}))},t._defaultCancel=function(e,t,r){t.close()},t._defaultClear=function(e,t,r){var n;this.hasAttribute("bm-cleartarget")&&(n=this.getAttribute("bm-cleartarget")),t.clear(n)},t.__getKeyfromKeyCode=function(e){var t;switch(e){case 13:t="Enter";break;default:t=String.fromCharCode(e)}return t},t.__initButtons=function(e,r,n){if(n&&n.rootNode){var o=n.handler?n.handler:t.__getDefaultHandler(r),i=e.querySelectorAll(n.rootNode);(i=Array.prototype.slice.call(i,0)).forEach((function(t){t.addEventListener("click",(function(t){o.call(this,t,e,n)}))}))}},t.__getActions=function(e){var r={};return Object.keys(e).forEach((function(n){for(var o=Array.isArray(e[n].key)?e[n].key:[e[n].key],i=0;i<o.length;i++)r[o[i]]={},r[o[i]].type=n,r[o[i]].handler=e[n].handler?e[n].handler:t.__getDefaultHandler(n),r[o[i]].option=e[n]})),r},t.__getDefaultHandler=function(e){var r;switch(e){case"submit":r=t._defaultSubmit;break;case"clear":r=t._defaultClear;break;case"cancel":r=t._defaultCancel}return r},t}(BITSMIST.v1.Organizer),g=function(e,t){var r=this;this._component=e,this._options=new BITSMIST.v1.Store({items:Object.assign({},this._getOptions(),t)}),this._options.set("name",this._options.get("name",this.constructor.name));var n=this._options.get("events",{});if(Object.keys(n).forEach((function(t){e.addEventHandler(t,n[t],null,r)})),this._options.get("expose")){var o=this;Object.defineProperty(e.__proto__,this._options.get("expose"),{get:function(){return o}})}},d={name:{configurable:!0},component:{configurable:!0}};d.name.get=function(){return this._options.get("name")},d.component.get=function(){return this._component},d.component.set=function(e){this._component=e},g.prototype._getOptions=function(){return{}},Object.defineProperties(g.prototype,d);var _=function(e,t,r){this._name=t,this._component=e,this._options=new BITSMIST.v1.Store({items:Object.assign({},r)}),this._data,this._items=[],this._item={},this._target={},this._currentIndex=0},m={name:{configurable:!0},target:{configurable:!0},data:{configurable:!0},items:{configurable:!0},item:{configurable:!0},options:{configurable:!0}};m.name.get=function(){return this._name},m.name.set=function(e){this._name=e},m.target.get=function(){return this._target},m.data.get=function(){return this._data},m.data.set=function(e){this._data=e,this._items=this.__reshapeItems(e),this._item=Array.isArray(this._items)?this._items[this._currentIndex]:this._items},m.items.get=function(){return this._items},m.item.get=function(){return this._item},m.options.get=function(){return this._options},_.prototype.get=function(e,t){var r=this;return Promise.resolve().then((function(){return r._get(e,t)})).then((function(e){return r.data=e,r._data}))},_.prototype.delete=function(e,t){var r=this;return Promise.resolve().then((function(){return r._delete(e,t)}))},_.prototype.post=function(e,t,r){var n=this;return t=this.__reshapeData(t),Promise.resolve().then((function(){return n._post(e,t,r)}))},_.prototype.put=function(e,t,r){var n=this;return t=this.__reshapeData(t),Promise.resolve().then((function(){return n._put(e,t,r)}))},_.prototype.getText=function(e){var t=e,r=this._options.get("fieldOptions.text");return this._items&&e in this._items&&(t=this._items[e][r]),t},_.prototype.getItem=function(e){var t;return this._items&&e in this._items&&(t=this._items[e]),t},_.prototype._get=function(e,t){},_.prototype._delete=function(e,t){},_.prototype._post=function(e,t,r){},_.prototype._put=function(e,t,r){},_.prototype.__reshapeItems=function(e){var t=this._options.get("fieldOptions.items"),r=t?BITSMIST.v1.Util.safeGet(e,t):e;this._options.get("reshapeOptions.get.reshape")&&(r=this._options.get("reshapeOptions.get.reshaper",this.__reshaper_get.bind(this))(r));return r},_.prototype.__reshapeData=function(e){if(this._options.get("reshapeOptions.put.reshape")){var t=this._options.get("reshapeOptions.put.reshaper",(function(){return e}));e=t(e)}return e},_.prototype.__reshaper_get=function(e){var t=this._options.get("fieldOptions.id");return e.reduce((function(e,r){return e[r[t]]=r,e}),{})},Object.defineProperties(_.prototype,m);var v=function(e){function t(t,r,n){e.call(this,t,r,n),this._cookieName=BITSMIST.v1.Util.safeGet(n,"cookieOptions.name","preferences")}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype._get=function(e,t){return this.__getCookie(this._cookieName)},t.prototype._put=function(e,t,r){this.__setCookie(this._cookieName,t)},t.prototype.__getCookie=function(e){var t=document.cookie.split(";").reduce((function(e,t){var r=t.split("="),n=r[0],o=r[1];return n&&(e[n.trim()]=o?decodeURIComponent(o.trim()):void 0),e}),{});return t[e]?JSON.parse(t[e]):{}},t.prototype.__setCookie=function(e,t){var r=e+"="+encodeURIComponent(JSON.stringify(t))+"; ",n=this._options.get("cookieOptions");r+=Object.keys(n).reduce((function(e,t){return e+=t+"="+n[t]+"; "}),""),document.cookie=r},t}(_),y=function(e){function t(t,r,n){e.call(this,t,r,n)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype._get=function(e,t){var r=this,n="GET",o=this._getOption("headers",n),i=this._getOption("options",n),s=this._getOption("url",n),a=s.dataType,c=this._buildApiUrl(this._name,e,t,s);return BITSMIST.v1.AjaxUtil.ajaxRequest({url:c,method:n,headers:o,options:i}).then((function(e){return r._convertResponseData(e.responseText,a)}))},t.prototype._delete=function(e,t){var r="DELETE",n=this._getOption("headers",r),o=this._getOption("options",r),i=this._getOption("url",r);i.dataType;var s=this._buildApiUrl(this._name,e,t,i);return BITSMIST.v1.AjaxUtil.ajaxRequest({url:s,method:r,headers:n,options:o})},t.prototype._post=function(e,t,r){var n="POST",o=this._getOption("headers",n),i=this._getOption("options",n),s=this._getOption("url",n),a=s.dataType,c=this._buildApiUrl(this._name,e,r,s);return BITSMIST.v1.AjaxUtil.ajaxRequest({url:c,method:n,headers:o,options:i,data:this._convertRequestData(t,a)})},t.prototype._put=function(e,t,r){var n="PUT",o=this._getOption("headers",n),i=this._getOption("options",n),s=this._getOption("url",n),a=s.dataType,c=this._buildApiUrl(this._name,e,r,s);return BITSMIST.v1.AjaxUtil.ajaxRequest({url:c,method:n,headers:o,options:i,data:this._convertRequestData(t,a)})},t.prototype._convertRequestData=function(e,t){var r;switch(t){case"json":default:r=JSON.stringify(e)}return r},t.prototype._convertResponseData=function(e,t){var r;switch(t){case"json":default:r=JSON.parse(e)}return r},t.prototype._getOption=function(e,t){var r=this._options.get("handlerOptions",{}),n=e in r&&"COMMON"in r[e]?r[e].COMMON:{},o=e in r&&t in r[e]?r[e][t]:{};return Object.assign(n,o)},t.prototype._buildApiUrl=function(e,t,r,n){var o=n.baseUrl||this._component.settings.get("system.apiBaseUrl",""),i=n.scheme||"",s=n.host||"",a=n.dataType||"",c=n.version||"";return(n.format||"").replace("@scheme@",i).replace("@host@",s).replace("@baseUrl@",o).replace("@resource@",e).replace("@id@",t).replace("@dataType@",a).replace("@query@",this._buildUrlQuery(r)).replace("@version@",c)},t.prototype._buildUrlQuery=function(e){var t="";return e&&(t=Object.keys(e).reduce((function(t,r){return Array.isArray(e[r])?t+=encodeURIComponent(r)+"="+encodeURIComponent(e[r].join())+"&":e[r]&&(t+=encodeURIComponent(r)+"="+encodeURIComponent(e[r])+"&"),t}),"")),t?"?"+t.slice(0,-1):""},t}(_),b=function(e){function t(t,r,n){e.call(this,t,r,n),n.items&&(this.data=n.items)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype._get=function(e,t){return this._data},t.prototype._put=function(e,t,r){this.data=t},t}(_),S=function(e){function t(t,r,n){e.call(this,t,r,Object.assign({autoLoad:!0},n)),this._ref}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={target:{configurable:!0},data:{configurable:!0},items:{configurable:!0},item:{configurable:!0}};return r.target.get=function(){return this._ref.target},r.data.get=function(){return this._ref.data},r.data.set=function(e){this._ref.data=e},r.items.get=function(){return this._ref.items},r.item.get=function(){return this._ref.item},t.prototype.get=function(e,t){var r=this,n=this._options.get("handlerOptions"),o=n.rootNode,i=n.resourceName,s=n.state,a={rootNode:o};return s&&(a.state=s),BITSMIST.v1.StateOrganizer.waitFor([a]).then((function(){r._ref=document.querySelector(o).resources[i]}))},t.prototype.getText=function(e){return this._ref.getText(e)},t.prototype.getItem=function(e){return this._ref.getItem(e)},Object.defineProperties(t.prototype,r),t}(_);function T(e){return Reflect.construct(BITSMIST.v1.Pad,[e],this.constructor)}function I(){return Reflect.construct(BITSMIST.v1.Pad,[],this.constructor)}function O(e){return Reflect.construct(BITSMIST.v1.Pad,[e],this.constructor)}BITSMIST.v1.ClassUtil.inherit(T,BITSMIST.v1.Pad),Object.defineProperty(T.prototype,"item",{get:function(){return this._item},set:function(e){this._item=e}}),T.prototype.start=function(e){return this._item={},this.__cancelSubmit=!1,e=Object.assign({},e,{settings:{autoClear:!0}}),BITSMIST.v1.Pad.prototype.start.call(this,e)},T.prototype.build=function(e,t,r){n.build(e,t,r)},T.prototype.clear=function(e){return n.clearFields(this,e)},T.prototype.fetch=function(e){var t=this;return BITSMIST.v1.Pad.prototype.fetch.call(this,e).then((function(){var e=t.settings.get("settings.resourceName");e&&t.resources&&t.resources[e]&&(t._item=t.resources[e]._item)}))},T.prototype.fill=function(e){var t=this,r=(e=Object.assign({},e)).sender?e.sender:this,o="rootNode"in e?this.querySelector(e.rootNode):this;return BITSMIST.v1.Util.safeGet(e,"autoClear",this._settings.get("settings.autoClear"))&&this.clear(),Promise.resolve().then((function(){return t.trigger("beforeFill",r,{options:e})})).then((function(){return n.setFields(o,t._item,{masters:t.resources,triggerEvent:"change"}),t.trigger("afterFill",r,{options:e})}))},T.prototype.validate=function(e){var t,r=this,o=(e=Object.assign({},e)).sender?e.sender:this;return Promise.resolve().then((function(){return r.trigger("beforeValidate",o)})).then((function(){BITSMIST.v1.Util.safeGet(e,"autoValidate",r._settings.get("settings.autoCheckValidate"))&&(t=n.checkValidity(r)).length>0&&(r.__cancelSubmit=!0)})).then((function(){return r.trigger("doValidate",o)})).then((function(){return r.trigger("afterValidate",o,{invalids:t})})).then((function(){if(BITSMIST.v1.Util.safeGet(e,"autoReportValidity",r._settings.get("settings.autoReportValidity"))){var t=r.querySelector("form");t&&t.reportValidity&&t.reportValidity()}})).then((function(){return r.trigger("doReportValidate",o,{invalids:t})}))},T.prototype.submit=function(e){var t=this,r=(e=Object.assign({},e)).sender?e.sender:this;return this.__cancelSubmit=!1,this._item=n.getFields(this),Promise.resolve().then((function(){if(BITSMIST.v1.Util.safeGet(e,"autoValidate",t._settings.get("settings.autoValidate")))return t.validate(e)})).then((function(){if(!t.__cancelSubmit)return Promise.resolve().then((function(){return t.trigger("beforeSubmit",r,{item:t._item})})).then((function(){return t.callOrganizers("doSubmit",e)})).then((function(){return t.trigger("doSubmit",r,{item:t._item})})).then((function(){return t.trigger("afterSubmit",r,{item:t._item})}))}))},BITSMIST.v1.ClassUtil.inherit(I,BITSMIST.v1.Pad),Object.defineProperty(I.prototype,"rows",{get:function(){return this._rows}}),Object.defineProperty(I.prototype,"items",{get:function(){return this._items},set:function(e){this._items=e}}),I.prototype.start=function(e){return this._items=[],this._activeRowTemplateName="",this._listRootNode,this._rows,e=Object.assign({},e,{settings:{autoClear:!0}}),BITSMIST.v1.Pad.prototype.start.call(this,e)},I.prototype.switchTemplate=function(e,t){var r=this;return BITSMIST.v1.Pad.prototype.switchTemplate.call(this,e,t).then((function(){return r.switchRowTemplate(r.settings.get("settings.rowTemplateName"))}))},I.prototype.switchRowTemplate=function(e,t){var r=this,n=(t=Object.assign({},t)).sender?t.sender:this;return this._isActiveRowTemplate(e)?Promise.resolve():Promise.resolve().then((function(){return r.addTemplate(e)})).then((function(){r._activeRowTemplateName=e})).then((function(){return r.callOrganizers("afterRowAppend",r._settings.items)})).then((function(){return r.trigger("afterRowAppend",n,{options:t})})).then((function(){}))},I.prototype.clear=function(){this._listRootNode.innerHTML=""},I.prototype.fetch=function(e){var t=this;return BITSMIST.v1.Pad.prototype.fetch.call(this,e).then((function(){var e=t.settings.get("settings.resourceName");e&&t.resources&&t.resources[e]&&(t.items=t.resources[e]._items)}))},I.prototype.fill=function(e){var t=this,r=(e=Object.assign({},e)).sender?e.sender:this,n=BITSMIST.v1.Util.safeGet(e,"async",this._settings.get("settings.async",!0))?this._buildAsync:this._buildSync,o=document.createDocumentFragment();return this._listRootNode=this.querySelector(this._settings.get("settings.listRootNode")),this._rows=[],Promise.resolve().then((function(){return t.trigger("beforeFill",r,{options:e})})).then((function(){return n.call(t,o,t._items)})).then((function(){BITSMIST.v1.Util.safeGet(e,"autoClear",t._settings.get("settings.autoClear"))&&t.clear()})).then((function(){t._listRootNode.appendChild(o)})).then((function(){return t.trigger("afterFill",r,{options:e})}))},I.prototype._isActiveRowTemplate=function(e){var t=!1;return this._activeRowTemplateName==e&&(t=!0),t},I.prototype._buildSync=function(e,t){for(var r=this,n=Promise.resolve(),o=this._settings.get("rowevents"),i=this._templates[this._activeRowTemplateName].html,s=function(s){n=n.then((function(){return r.__appendRowSync(e,s,t[s],i,o)}))},a=0;a<t.length;a++)s(a);return n},I.prototype._buildAsync=function(e,t){for(var r=this._settings.get("rowevents"),n=this._templates[this._activeRowTemplateName].html,o=0;o<t.length;o++)this.__appendRowAsync(e,o,t[o],n,r)},I.prototype.__appendRowSync=function(e,t,r,o,i){var s=this,a=document.createElement("div");a.innerHTML=o;var c=a.firstElementChild;return e.appendChild(c),this._rows.push(c),i&&Object.keys(i).forEach((function(e){s.initEvents(e,i[e],c)})),Promise.resolve().then((function(){return s.trigger("beforeFillRow",s,{item:r,no:t,element:c})})).then((function(){n.setFields(c,r,{masters:s.resources})})).then((function(){return s.trigger("afterFillRow",s,{item:r,no:t,element:c})}))},I.prototype.__appendRowAsync=function(e,t,r,o,i){var s=this,a=document.createElement("div");a.innerHTML=o;var c=a.firstElementChild;e.appendChild(c),this._rows.push(c),i&&Object.keys(i).forEach((function(e){s.initEvents(e,i[e],c)})),this.triggerAsync("beforeFillRow",this,{item:r,no:t,element:c}),n.setFields(c,r,{masters:this.resources}),this.triggerAsync("afterFillRow",this,{item:r,no:t,element:c})},BITSMIST.v1.ClassUtil.inherit(O,BITSMIST.v1.Component),Object.defineProperty(O.prototype,"items",{get:function(){return p._store.items}}),O.prototype.get=function(e,t){return p._store.get(e,t)},O.prototype.set=function(e,t,r){if(p._store.set(e,t,r),BITSMIST.v1.Util.safeGet(r,"autoSave",this.settings.get("preferences.settings.autoSave")))return this.resources.preferences.put("",p._store.localItems)},customElements.define("bm-preference",O),window.BITSMIST=window.BITSMIST||{},window.BITSMIST.v1=window.BITSMIST.v1||{},window.BITSMIST.v1.ObservableStore=e,window.BITSMIST.v1.ObservableStoreMixin=t,window.BITSMIST.v1.BindableStore=o,BITSMIST.v1.OrganizerOrganizer.organizers.set("ErrorOrganizer",{object:i,targetWords:"errors",targetEvents:["beforeStart"],order:100}),BITSMIST.v1.OrganizerOrganizer.organizers.set("FileOrganizer",{object:s,targetWords:"files",targetEvents:["afterSpecLoad"],order:200}),BITSMIST.v1.OrganizerOrganizer.organizers.set("PluginOrganizer",{object:a,targetWords:"plugins",targetEvents:["beforeStart"],order:1100}),BITSMIST.v1.OrganizerOrganizer.organizers.set("ResourceOrganizer",{object:c,targetWords:"resources",targetEvents:["beforeStart","afterSpecLoad","doFetch","doSubmit"],order:1300}),BITSMIST.v1.OrganizerOrganizer.organizers.set("PreferenceOrganizer",{object:p,targetWords:"preferences",targetEvents:["beforeStart"],order:1400}),BITSMIST.v1.OrganizerOrganizer.organizers.set("ElementOrganizer",{object:l,targetWords:"elements",targetEvents:["beforeStart"],order:2100}),BITSMIST.v1.OrganizerOrganizer.organizers.set("DatabindingOrganizer",{object:f,targetWords:"data",targetEvents:["afterAppend"],order:2100}),BITSMIST.v1.OrganizerOrganizer.organizers.set("KeyOrganizer",{object:h,targetWords:"keys",targetEvents:["afterAppend"],order:2100}),window.BITSMIST.v1.Plugin=g,window.BITSMIST.v1.CookieResourceHandler=v,window.BITSMIST.v1.ApiResourceHandler=y,window.BITSMIST.v1.ObjectResourceHandler=b,window.BITSMIST.v1.LinkedResourceHandler=S,window.BITSMIST.v1.Form=T,window.BITSMIST.v1.List=I,window.BITSMIST.v1.FormatterUtil=r}();

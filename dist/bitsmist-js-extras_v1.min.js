!function(){"use strict";var t=function(t){function e(e){t.call(this,Object.assign({notifyOnChange:!0,async:!1},e)),this._observers=[]}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.set=function(t,e){var r=[],n=t?this.get(t):this._items;"object"==typeof n?this.__deepMerge(n,e,r):this.get(t)!=e&&(BITSMIST.v1.Util.safeSet(this._items,t,e),r.push(t)),BITSMIST.v1.Util.safeGet(this._options,"notifyOnChange")&&r.length>0&&this.notify(r)},e.prototype.subscribe=function(t,e,r){BITSMIST.v1.Util.assert("function"==typeof e,"ObservableStore.subscribe(): Notification handler is not a function. id="+t,TypeError),this._observers.push({id:t,handler:e,options:r})},e.prototype.unsubscribe=function(t){for(var e=0;e<this._observers.length;e++)if(this._obvservers[e].id==t){this._observers.splice(e,1);break}},e.prototype.notify=function(t){for(var e,r,n=[],o=arguments.length-1;o-- >0;)n[o]=arguments[o+1];return BITSMIST.v1.Util.safeGet(this._options,"async",!1)?(e=this).notifyAsync.apply(e,[t].concat(n)):(r=this).notifySync.apply(r,[t].concat(n))},e.prototype.notifySync=function(t){for(var e=this,r=[],n=arguments.length-1;n-- >0;)r[n]=arguments[n+1];for(var o=Promise.resolve(),i=function(n){o=o.then((function(){var o,i;if((o=e)._filter.apply(o,[t,e._observers[n].options].concat(r)))return(i=e._observers[n]).handler.apply(i,[t].concat(r))}))},s=0;s<e._observers.length;s++)i(s);return o},e.prototype.notifyAsync=function(t){for(var e,r,n=[],o=arguments.length-1;o-- >0;)n[o]=arguments[o+1];for(var i=0;i<this._observers.length;i++)(e=this)._filter.apply(e,[t,this._observers[i].options].concat(n))&&(r=this._observers[i]).handler.apply(r,[t].concat(n));return Promise.resolve()},e.prototype.mute=function(){this._options.notifyOnChange=!1},e.prototype.unmute=function(){this._options.notifyOnChange=!0},e.prototype.__deepMerge=function(t,e,r){return r=r||[],BITSMIST.v1.Util.assert(t&&"object"==typeof t&&e&&"object"==typeof e,"ObservableStore.__deepMerge(): Parameters must be an object.",TypeError),Object.keys(e).forEach((function(n){Array.isArray(t[n])?(t[n]=t[n].concat(e[n]),r.push(n)):t.hasOwnProperty(n)&&t[n]&&"object"==typeof t[n]&&e[n]&&"object"==typeof e[n]&&!(t[n]instanceof HTMLElement)?Util.deepMerge(t[n],e[n]):t[n]!=e[n]&&(t[n]=e[n],r.push(n))})),t},e}(BITSMIST.v1.Store),e=function(e){return function(e){function r(r){e.call(this,Object.assign({notifyOnChange:!0,async:!1},r)),Object.assign(this,t.prototype),this._observers=[]}return e&&(r.__proto__=e),r.prototype=Object.create(e&&e.prototype),r.prototype.constructor=r,r}(e)},r=function(){};r.setElementValue=function(t,e){null!==e&&null!=e||(e="");var r=e,n=t.getAttribute("bm-bindtarget");if(n)for(var o=n.split(","),i=0;i<o.length;i++){var s=o[i].toLowerCase();switch(s){case"text":t.innerText=e;break;case"html":t.innerHTML=e;break;case"href":case"src":case"rel":"http"!=e.substring(0,4)&&"/"!=e.substring(0,1)||t.setAttribute(s,e);break;default:var a=t.getAttribute(s);a=a?a+" "+e:r,t.setAttribute(s,a)}}else if(t.hasAttribute("value"))("input"==t.tagName.toLowerCase()&&"checkbox"==t.type.toLowerCase()||"input"==t.tagName.toLowerCase()&&"radio"==t.type.toLowerCase())&&(Array.isArray(e)?e.indexOf(t.getAttribute("value"))>-1&&(t.checked=!0):t.getAttribute("value")==e&&(t.checked=!0));else if("select"==t.tagName.toLowerCase())t.value=e;else if("fieldset"==t.tagName.toLowerCase());else if("input"==t.tagName.toLowerCase())switch(t.type.toLowerCase()){case"number":case"search":case"text":t.value=e;break;case"checkbox":t.checked=!!e;break;case"radio":t.value==e&&(t.checked=!0)}else t.innerText=e;var c=document.createEvent("HTMLEvents");c.initEvent("change",!0,!0),t.dispatchEvent(c)},r.getElementValue=function(t){var e=void 0;switch(t.tagName.toLowerCase()){case"input":switch(t.type.toLowerCase()){case"radio":case"checkbox":t.checked&&(e=t.hasAttribute("value")?t.getAttribute("value"):t.checked);break;default:e=t.value}break;case"select":e=t.value;break;default:t.hasAttribute("selected")&&(e=t.getAttribute("value"))}return e},r.build=function(t,e){if("select"==t.tagName.toLowerCase()){if(t.options.length=0,"emptyItem"in e){var r="text"in e.emptyItem?e.emptyItem.text:"",n="value"in e.emptyItem?e.emptyItem.value:"",o=document.createElement("option");o.text=r,o.value=n,o.setAttribute("selected",""),t.appendChild(o)}Object.keys(e.items).forEach((function(r){var n=document.createElement("option");n.text=e.items[r].title,n.value=r,t.appendChild(n)}))}else Object.keys(e.items).forEach((function(r){var n=document.createElement("label"),o=document.createElement("input");o.type="radio",o.id=key,o.name=key,o.value=r,o.setAttribute("bm-bind",key),n.appendChild(o),n.appendChild(document.createTextNode(e.items[r].title)),t.appendChild(n)}))};var n=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.bindTo=function(t){var e=this,n=t.getAttribute("bm-bind");if(r.setElementValue(t,this.get(n)),!!(!t.__bm_bindinfo||!t.__bm_bindinfo.bound)&&BITSMIST.v1.Util.safeGet(this._options,"2way",!0)){this.subscribe(n,(function(){r.setElementValue(t,e.get(n))}));var o=BITSMIST.v1.Util.safeGet(this._options,"eventName","change");t.addEventListener(o,function(){e.set(n,r.getElementValue(t))}.bind(this)),t.__bm_bindinfo={bound:!0}}},e}(t),o=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.globalInit=function(){e._observers=new BITSMIST.v1.ObservableStore({filter:e.__filter}),document.addEventListener("DOMContentLoaded",(function(){BITSMIST.v1.settings.get("organizers.ErrorOrganizer.settings.captureError",!0)&&e.__initErrorListeners()}))},e.organize=function(t,r,n){return r.settings.get("errors")&&e._observers.subscribe(r.uniqueId,r.trigger.bind(r),{component:r}),n},e.__filter=function(t,e,r,n){for(var o=!1,i=e.component.settings.get("errors.targets"),s=0;s<i.length;s++)if(n.error.name==i[s]){o=!0;break}return o},e.__initErrorListeners=function(){window.addEventListener("unhandledrejection",(function(t){var r={};return t.reason?t.reason instanceof XMLHttpRequest?(r.message=t.reason.statusText,r.stack=t.reason.stack,r.object=t.reason):(r.message=t.reason.message,r.object=t.reason):r.message=t,r.type=t.type,r.name=e.__getErrorName(t),r.filename="",r.funcname="",r.lineno="",r.colno="",e.__handleException(r),!1})),window.addEventListener("error",(function(t,r,n,o){var i={type:"error"};return i.name=e.__getErrorName(t),i.message=t.message,i.file=t.filename,i.line=t.lineno,i.col=t.colno,t.error&&(i.stack=t.error.stack,i.object=t.error),e.__handleException(i),!1}))},e.__getErrorName=function(t){var e,r;if((r=t.reason instanceof XMLHttpRequest||t.reason?t.reason:t.error?t.error:t.message).name)e=r.name;else if(r instanceof TypeError)e="TypeError";else if(r instanceof XMLHttpRequest)e="AjaxError";else if(r instanceof EvalError)e="EvalError";else if(r instanceof RangeError)e="RangeError";else if(r instanceof ReferenceError)e="ReferenceError";else if(r instanceof SyntaxError)e="SyntaxError";else if(r instanceof URIError)e="URIError";else{var n=r.indexOf(":");n>-1&&(e=r.substring(0,n))}return e},e.__handleException=function(t){return e._observers.notifyAsync("error",e,{error:t})},e}(BITSMIST.v1.Organizer),i=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.organize=function(t,e,r){var n=[],o=r.files;return o&&Object.keys(o).forEach((function(t){n.push(BITSMIST.v1.AjaxUtil.loadScript(o[t].href))})),Promise.all(n).then((function(){return r}))},e}(BITSMIST.v1.Organizer),s=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.init=function(t,e,r){e._plugins={}},e.organize=function(t,r,n){var o=r.settings.get("plugins");return o&&Object.keys(o).forEach((function(t){e._addPlugin(r,t,o[t])})),n},e._addPlugin=function(t,e,r){var n,o="className"in(r=Object.assign({},r))?r.className:e;return n=BITSMIST.v1.ClassUtil.createObject(o,t,r),t._plugins[e]=n,n},e}(BITSMIST.v1.Organizer),a=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(e(BITSMIST.v1.ChainableStore)),c=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.globalInit=function(){e._defaults=new BITSMIST.v1.ChainableStore,e._store=new a({chain:e._defaults,filter:e._filter,async:!0}),e.__loaded={},e.__loaded.promise=new Promise((function(t,r){e.__loaded.resolve=t,e.__loaded.reject=r}))},e.init=function(t,r,n){e._store.subscribe(r.name+"_"+r.uniqueId,e._triggerEvent.bind(r),{targets:BITSMIST.v1.Util.safeGet(n,"preferences.targets")})},e.organize=function(t,r,n){var o,i=Promise.resolve();return r.settings.get("preferences.defaults")&&(e._defaults.items=r.settings.get("preferences.defaults")),r.settings.get("preferences.settings.load")&&(i=e.load(r).then((function(t){e._store.merge(t),e.__loaded.resolve()}))),i.then((function(){var t=r.settings.get("system.preferenceTimeout",1e4);return o=setTimeout((function(){throw new ReferenceError("Time out waiting for loading preferences. name="+r.name)}),t),e.__loaded.promise})).then((function(){return clearTimeout(o),n}))},e.load=function(t,e){var r=e&&e.sender?e.sender:t;return t.trigger("doLoadStore",r)},e.save=function(t,r){var n=r&&r.sender?r.sender:t;return t.trigger("doSaveStore",n,{data:e._store.items})},e._triggerEvent=function(t){var r=this.settings.get("preferences.settings.eventName","doSetup");return this.trigger(r,e,{keys:t})},e._filter=function(t,e){var r=!1,n=e.targets;if("*"==n)r=!0;else{n=Array.isArray(n)?n:[n],t=Array.isArray(t)?t:[t];for(var o=0;o<n.length;o++)if(t.indexOf(n[o])>-1){r=!0;break}}return r},e}(BITSMIST.v1.Organizer),u=function(t,e){this._name=t,this._options=e,this._data,this._parameters={}};u.prototype.get=function(t,e){var r=this,n="GET",o=this._getOption("headers",n),i=this._getOption("options",n),s=this._getOption("url",n),a=s.dataType,c=this._buildApiUrl(this._name,t,e,s);return BITSMIST.v1.AjaxUtil.ajaxRequest({url:c,method:n,headers:o,options:i}).then((function(t){return r._convertResponseData(t.responseText,a)}))},u.prototype.delete=function(t,e){var r=this,n="DELETE",o=this._getOption("headers",n),i=this._getOption("options",n),s=this._getOption("url",n),a=s.dataType,c=this._buildApiUrl(this._name,t,e,s);return BITSMIST.v1.AjaxUtil.ajaxRequest({url:c,method:n,headers:o,options:i}).then((function(t){return r._convertResponseData(t.responseText,a)}))},u.prototype.insert=function(t,e,r){var n=this,o="POST",i=this._getOption("headers",o),s=this._getOption("options",o),a=this._getOption("url",o),c=a.dataType,u=this._buildApiUrl(this._name,t,r,a);return BITSMIST.v1.AjaxUtil.ajaxRequest({url:u,method:o,headers:i,options:s,data:this._convertRequestData(e,c)}).then((function(t){return n._convertResponseData(t.responseText,c)}))},u.prototype.update=function(t,e,r){var n=this,o="PUT",i=this._getOption("headers",o),s=this._getOption("options",o),a=this._getOption("url",o),c=a.dataType,u=this._buildApiUrl(this._name,t,r,a);return BITSMIST.v1.AjaxUtil.ajaxRequest({url:u,method:o,headers:i,options:s,data:this._convertRequestData(e,c)}).then((function(t){return n._convertResponseData(t.responseText,c)}))},u.prototype._convertRequestData=function(t,e){var r;switch(e){case"json":default:r=JSON.stringify(t)}return r},u.prototype._convertResponseData=function(t,e){var r;switch(e){case"json":default:r=JSON.parse(t)}return r},u.prototype._getOption=function(t,e){var r="settings"in this._options?this._options.settings:{},n=t in r&&"COMMON"in r[t]?r[t].COMMON:{},o=t in r&&e in r[t]?r[t][e]:{};return Object.assign(n,o)},u.prototype._buildApiUrl=function(t,e,r,n){var o=n.baseUrl,i=n.scheme,s=n.host,a=n.dataType,c=n.version;return(n.format?n.format:"@baseUrl@@query@").replace("@scheme@",i).replace("@host@",s).replace("@baseUrl@",o).replace("@resource@",t).replace("@id@",e).replace("@dataType@",a).replace("@query@",this._buildUrlQuery(r)).replace("@version@",c)},u.prototype._buildUrlQuery=function(t){var e="";return t&&(e=Object.keys(t).reduce((function(e,r){return Array.isArray(t[r])?e+=encodeURIComponent(r)+"="+encodeURIComponent(t[r].join())+"&":t[r]&&(e+=encodeURIComponent(r)+"="+encodeURIComponent(t[r])+"&"),e}),"")),e?"?"+e.slice(0,-1):""};var p=function(t){function e(e,r){if(t.call(this,e,r),this._items,"items"in r){var n;if("object"==typeof r.items)n=r.items;else{var o=window;r.items.split(".").forEach((function(t){if(!(o=o[t]))throw new ReferenceError("Master not found. Master="+r.items)})),n=o}this._items=this.__reshapeItems(n)}}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var r={items:{configurable:!0}};return r.items.get=function(){return this._items},e.prototype.load=function(){var t=this;return this.get("list").then((function(e){t._items=t.__reshapeItems(e.data)}))},e.prototype.getValue=function(t){var e=t,r=this._options.title;return this._items&&t in this._items&&(e=this._items[t][r]),e},e.prototype.getItem=function(t){var e;return this._items&&t in this._items&&(e=this._items[t]),e},e.prototype.filter=function(t){var e=this;return Object.keys(this._items).reduce((function(r,n){return t(e._items[n])&&(r[n]=e._items[n]),r}),{})},e.prototype.__reshapeItems=function(t){var e=this._options.id,r=this._options.title;return t.reduce((function(t,n){var o=n[e];return t[o]=n,t[o].title=n[r],t}),{})},Object.defineProperties(e.prototype,r),e}(u),l=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.init=function(t,e,r){Object.defineProperty(e,"masters",{get:function(){return this._masters}}),e._masters={}},e.organize=function(t,e,r){var n=this,o=[],i=r.masters;if(i){var s=e.settings.get("ajaxUtil",{});s.url.COMMON.baseUrl=e.settings.get("system.apiBaseUrl",""),Object.keys(i).forEach((function(t){o.push(n._initMaster(e,t,i[t],s))}))}return Promise.all(o).then((function(){return r}))},e._initMaster=function(t,e,r,n){if(t._masters[e]=new p(e,Object.assign({settings:n},r)),r.autoLoad)return t._masters[e].load()},e}(BITSMIST.v1.Organizer),f=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.organize=function(t,r,n){var o=n.elements;return o&&Object.keys(o).forEach((function(t){r.addEventHandler(t,{handler:e.onDoOrganize,options:{attrs:o[t]}})})),n},e.onDoOrganize=function(t,r,n){var o=n.component,i=n.options.attrs;Object.keys(i).forEach((function(t){e.__initAttr(o,t,i[t])}))},e.__getTargetElements=function(t,e,r){return r.rootNode?"this"==r.rootNode||r.rootNode==t.tagName.toLowerCase()?[t]:t.querySelectorAll(r.rootNode):"this"==e||e==t.tagName.toLowerCase()?[t]:t.querySelectorAll("#"+e)},e.__initAttr=function(t,r,n){if(n)for(var o=e.__getTargetElements(t,r,n),i=function(t){Object.keys(n).forEach((function(e){switch(e){case"attribute":Object.keys(n[e]).forEach((function(r){o[t].setAttribute(r,n[e][r])}));break;case"style":Object.keys(n[e]).forEach((function(r){o[t].style[r]=n[e][r]}));break;case"property":Object.keys(n[e]).forEach((function(r){o[t][r]=n[e][r]}));break;case"autoFocus":o[t].focus()}}))},s=0;s<o.length;s++)i(s)},e}(BITSMIST.v1.Organizer),d=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.init=function(t,r,o){Object.defineProperty(r,"binds",{get:function(){return this._binds},set:function(t){e.update(this,t)}}),r.bindData=function(t){return e._bindData(this,t)},r._binds=new n},e.organize=function(t,r,n){var o=n.binds;return e.update(r,o),n},e.update=function(t,r){t.binds.items=r,e._bindData(t)},e._bindData=function(t,e){(e=e||t).querySelectorAll("[bm-bind]").forEach((function(e){t.binds.bindTo(e)}))},e}(BITSMIST.v1.Organizer),h=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.init=function(t,e,r){e.__isComposing=!1},e.organize=function(t,r,n){var o=n.keys;if(o){var i=e.__getActions(o);r.addEventListener("keydown",(function(t){e.onKeyDown.call(this,t,r,o,i)})),r.addEventListener("keypress",(function(t){e.onKeyPress.call(this,t,r,o,i)})),r.addEventListener("compositionstart",(function(t){e.onCompositionStart.call(this,t,r,o)})),r.addEventListener("compositionend",(function(t){e.onCompositionEnd.call(this,t,r,o)})),Object.keys(o).forEach((function(t){e.__initButtons(r,t,o[t])}))}return n},e.onKeyDown=function(t,r,n,o){var i=t.key?t.key:e.__getKeyfromKeyCode(t.keyCode);switch(i="esc"==(i=i.toLowerCase())?"escape":i){case"escape":e.onKeyPress(t,r,n,o)}},e.onKeyPress=function(t,r,n,o){if(!r.__isComposing&&!t.isComposing&&229!=t.keyCode){var i=t.key?t.key:e.__getKeyfromKeyCode(t.keyCode);o[i="esc"==(i=i.toLowerCase())?"escape":i]&&o[i].handler.call(this,t,r,o[i].option)}},e.onCompositionStart=function(t,e,r){e.__isComposing=!0},e.onCompositionEnd=function(t,e,r){e.__isComposing=!1},e._defaultSubmit=function(t,e,r){e.submit().then((function(){e.__cancelSubmit||(e._isModal&&(e._modalResult.result=!0),r&&r.autoClose&&e.close())}))},e._defaultCancel=function(t,e,r){e.close()},e._defaultClear=function(t,e,r){var n;r&&r.target&&(n=this.getAttribute(r.target)),e.clear(e,n)},e.__getKeyfromKeyCode=function(t){var e;switch(t){case 13:e="Enter";break;default:e=String.fromCharCode(t)}return e},e.__initButtons=function(t,r,n){if(n&&n.rootNode){var o=n.handler?n.handler:e.__getDefaultHandler(r),i=t.querySelectorAll(n.rootNode);(i=Array.prototype.slice.call(i,0)).forEach((function(e){e.addEventListener("click",(function(e){o.call(this,e,t,n)}))}))}},e.__getActions=function(t){var r={};return Object.keys(t).forEach((function(n){for(var o=Array.isArray(t[n].key)?t[n].key:[t[n].key],i=0;i<o.length;i++)r[o[i]]={},r[o[i]].type=n,r[o[i]].handler=t[n].handler?t[n].handler:e.__getDefaultHandler(n),r[o[i]].option=t[n]})),r},e.__getDefaultHandler=function(t){var r;switch(t){case"submit":r=e._defaultSubmit;break;case"clear":r=e._defaultClear;break;case"cancel":r=e._defaultCancel}return r},e}(BITSMIST.v1.Organizer),g=function(t,e){var r=this;this._component=t,this._options=new BITSMIST.v1.Store({items:Object.assign({},this._getOptions(),e)}),this._options.set("name",this._options.get("name",this.constructor.name));var n=this._options.get("events",{});if(Object.keys(n).forEach((function(e){t.addEventHandler(e,n[e],null,r)})),this._options.get("expose")){var o=this;Object.defineProperty(t.__proto__,this._options.get("expose"),{get:function(){return o}})}},_={name:{configurable:!0},component:{configurable:!0}};_.name.get=function(){return this._options.get("name")},_.component.get=function(){return this._component},_.component.set=function(t){this._component=t},g.prototype._getOptions=function(){return{}},Object.defineProperties(g.prototype,_);var m=function(t){function e(e,r){t.call(this,e,r),this._cookieName=this._options.get("cookieOptions.name","preferences")}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.onDoLoadStore=function(t,e,r){return this.__getCookie(this._cookieName)},e.prototype.onDoSaveStore=function(t,e,r){this.__setCookie(this._cookieName,e.detail.data)},e.prototype._getOptions=function(){return{events:{doLoadStore:this.onDoLoadStore,doSaveStore:this.onDoSaveStore}}},e.prototype.__getCookie=function(t){var e=document.cookie.split(";").reduce((function(t,e){var r=e.split("="),n=r[0],o=r[1];return n&&(t[n.trim()]=o?decodeURIComponent(o.trim()):void 0),t}),{});return e[t]?JSON.parse(e[t]):{}},e.prototype.__setCookie=function(t,e){var r=t+"="+encodeURIComponent(JSON.stringify(e))+"; ",n=this._options.get("cookieOptions",{});r+=Object.keys(n).reduce((function(t,e){return t+=e+"="+n[e]+"; "}),""),document.cookie=r},e}(g),y=function(t){function e(e,r){var n=this;t.call(this,e,r),this._options.set("settings",this._component.settings.get("ajaxUtil","")),this._options.set("settings.url.COMMON.baseUrl",this._component.settings.get("system.apiBaseUrl","")),this._resources={},this._defaultResourceName;var o=this._options.get("resources",[]);Object.keys(o).forEach((function(t){var e=o[t];n.addResource(e,{settings:n._options.get("settings",{})})})),this.switchResource(o[0])}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.addResource=function(t,e){this._resources[t]=new u(t,Object.assign({settings:e.settings})),this[t]=this._resources[t]},e.prototype.switchResource=function(t){this._defaultResourceName=t},e.prototype.onDoFetch=function(t,e,r){var n=this,o=BITSMIST.v1.Util.safeGet(e.detail.target,"id"),i=BITSMIST.v1.Util.safeGet(e.detail.target,"parameters");if(BITSMIST.v1.Util.safeGet(e.detail.options,"autoLoad",this._options.get("autoLoad")))return this._resources[this._defaultResourceName].get(o,i).then((function(t){n._component.data=t,"items"in n._component?n._component.items=n._options.get("itemsGetter",(function(t){return t.data}))(t):"item"in n._component&&(n._component.item=n._options.get("itemGetter",(function(t){return t.data[0]}))(t))}))},e.prototype.onDoSubmit=function(t,e,r){var n=this,o=BITSMIST.v1.Util.safeGet(e.detail.target,"id");BITSMIST.v1.Util.safeGet(e.detail.target,"parameters");var i=BITSMIST.v1.Util.safeGet(e.detail,"items"),s=[],a={};r.component.querySelectorAll("[bm-bind]").forEach((function(t){t.hasAttribute("bm-submit")&&(a[t.getAttribute("bm-bind")]=!0)}));for(var c=function(t){var e={};Object.keys(i[t]).forEach((function(r){a[r]&&(e[r]=i[t][r])})),s.push(e)},u=0;u<i.length;u++)c(u);return Promise.resolve().then((function(){return o?n._resources[n._defaultResourceName].update(o,{items:s}):n._resources[n._defaultResourceName].insert(o,{items:s})}))},e.prototype._getOptions=function(){return{events:{doFetch:this.onDoFetch,doSubmit:this.onDoSubmit}}},e}(g);function v(){}function b(){}function S(t){return Reflect.construct(BITSMIST.v1.Pad,[t],this.constructor)}function T(){return Reflect.construct(BITSMIST.v1.Pad,[],this.constructor)}v.format=function(t,e,r){var n=r;switch(e.toLowerCase()){case"yyyy/mm/dd":n=v.formatDate(e,n);break;case"price":n=v.formatPrice(e,n)}return n},v.formatPrice=function(t,e){return e?"¥"+String(parseInt(e)).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,"):""},v.formatNumber=function(t){return t?String(parseInt(t)).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,"):""},v.formatDate=function(t,e){var r="";return e&&8==e.length&&(r=e.substr(0,4)+"/"+e.substr(4,2)+"/"+e.substr(6,2)),r},v.deformat=function(t,e,r){var n=r;switch(e){case"yyyy/mm/dd":n=v.deformatDate(e,r);break;case"price":n=v.deformatPrice(e,r)}return n},v.deformatPrice=function(t,e){var r="";return e&&(r=e.replace(/,/g,"").replace(/\//g,"").replace(/\\/g,"").replace("¥","")),r},v.deformatDate=function(t,e){var r="";return e&&(r=e.replace(/,/g,"").replace(/\//g,"").replace(/\\/g,"")),r},v.getNow=function(t){t=t||"-";var e=new Date;return e.getFullYear()+t+("00"+(e.getMonth()+1)).slice(-2)+t+("00"+e.getDate()).slice(-2)+" "+("00"+e.getHours()).slice(-2)+":"+("00"+e.getMinutes()).slice(-2)+":"+("00"+e.getSeconds()).slice(-2)},v.getToday=function(t){t=void 0===t?"-":t;var e=new Date;return e.getFullYear()+t+("00"+(e.getMonth()+1)).slice(-2)+t+("00"+e.getDate()).slice(-2)},v.sanitize=function(t){return"string"==typeof t?t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"):t},b.setFields=function(t,e,r){var n=this,o=t.querySelectorAll("[bm-bind]");Array.prototype.concat([t],Array.prototype.slice.call(o,0)).forEach((function(t){var o=t.getAttribute("bm-bind");if(o in e)if(t.hasAttribute("bm-master")){var i=t.getAttribute("bm-master"),s=n.getMasterValue(r,i,e[o]);n.setValue(t,s)}else n.setValue(t,e[o])}))},b.getFields=function(t,e){var r=this,n={};e=e||"";var o=t.querySelectorAll(e+" [bm-submit]");return(o=Array.prototype.slice.call(o,0)).forEach((function(t){var e=t.getAttribute("bm-bind"),o=r.getValue(t);if(Array.isArray(n[e]))o&&n[e].push(o);else if(n[e]){if(o){var i=[];i.push(n[e]),i.push(o),n[e]=i}}else n[e]=o})),n},b.clearFields=function(t,e){e=e||"";var r=t.querySelectorAll(e+" input");(r=Array.prototype.slice.call(r,0)).forEach((function(t){switch(t.type.toLowerCase()){case"search":case"text":case"number":t.value="";break;case"checkbox":case"radio":t.checked=!1}})),r=t.querySelectorAll(e+" select"),(r=Array.prototype.slice.call(r,0)).forEach((function(t){t.selectedIndex=-1}))},b.buildFields=function(t,e,r){var n=t.querySelectorAll("[bm-bind='"+e+"']");(n=Array.prototype.slice.call(n,0)).forEach((function(t){if("select"==t.tagName.toLowerCase()){if(t.options.length=0,"emptyItem"in r){var e="text"in r.emptyItem?r.emptyItem.text:"",n="value"in r.emptyItem?r.emptyItem.value:"",o=document.createElement("option");o.text=e,o.value=n,o.setAttribute("selected",""),t.appendChild(o)}Object.keys(r.items).forEach((function(e){var n=document.createElement("option");n.text=r.items[e].title,n.value=e,t.appendChild(n)}))}else Object.keys(r.items).forEach((function(e){var n=document.createElement("label"),o=document.createElement("input");o.type="radio",o.id=key,o.name=key,o.value=e,o.setAttribute("bm-bind",key),o.setAttribute("bm-submit",""),n.appendChild(o),n.appendChild(document.createTextNode(r.items[e].title)),t.appendChild(n)}))}))},b.getMasterValue=function(t,e,r){var n=r;return t&&e in t&&(n=t[e].getValue(r)),n},b.setValue=function(t,e){null!==e&&null!=e||(e=""),t.hasAttribute("bm-format")&&(e=v.format("",t.getAttribute("bm-format"),e));var r=v.sanitize(e),n=t.getAttribute("bm-target");if(n)for(var o=n.split(","),i=0;i<o.length;i++){var s=o[i].toLowerCase();switch(s){case"html":t.innerHTML=e;break;case"href":case"src":case"rel":"http"!=e.substring(0,4)&&"/"!=e.substring(0,1)||t.setAttribute(s,e);break;default:var a=t.getAttribute(s);a=a?a+" "+e:r,t.setAttribute(s,a)}}else if(t.hasAttribute("value"))"input"==t.tagName.toLowerCase()&&"checkbox"==t.type.toLowerCase()||"input"==t.tagName.toLowerCase()&&"radio"==t.type.toLowerCase()?Array.isArray(e)?e.indexOf(t.getAttribute("value"))>-1&&(t.checked=!0):t.getAttribute("value")==e&&(t.checked=!0):t.setAttribute("value",v.sanitize(e));else if("select"==t.tagName.toLowerCase())t.value=e;else if("fieldset"==t.tagName.toLowerCase());else if("input"==t.tagName.toLowerCase())switch(t.type.toLowerCase()){case"number":case"search":case"text":t.value=e;break;case"checkbox":t.checked=!!e;break;case"radio":t.value==e&&(t.checked=!0)}else t.innerText=e;var c=document.createEvent("HTMLEvents");c.initEvent("change",!0,!0),t.dispatchEvent(c)},b.getValue=function(t){var e=void 0;switch(t.tagName.toLowerCase()){case"input":switch(t.type.toLowerCase()){case"radio":case"checkbox":t.checked&&(e=t.hasAttribute("value")?t.getAttribute("value"):t.checked);break;default:e=t.value}break;case"select":e=t.value;break;default:t.hasAttribute("selected")&&(e=t.getAttribute("value"))}return t.hasAttribute("bm-format")&&(e=BITSMIST.v1.FormatterUtil.deformat("",t.getAttribute("bm-format"),e)),e},b.reportValidity=function(t){var e=!0,r=t.querySelectorAll("input");return(r=Array.prototype.slice.call(r,0)).forEach((function(t){switch(t.getAttribute("type")){case"number":(t.validity&&0==t.validity.valid||isNaN(t.value))&&(t.style.border="solid 3px red",e=!1)}})),e},BITSMIST.v1.ClassUtil.inherit(S,BITSMIST.v1.Pad),Object.defineProperty(S.prototype,"item",{get:function(){return this._item},set:function(t){this._item=t}}),Object.defineProperty(S.prototype,"data",{get:function(){return this._data},set:function(t){this._data=t}}),S.prototype.start=function(t){return this._id,this._parameters,this._item={},this.__cancelSubmit=!1,this._target={},t=Object.assign({},t,{settings:{autoClear:!0}}),BITSMIST.v1.Pad.prototype.start.call(this,t)},S.prototype.build=function(t){var e=this;Object.keys(t).forEach((function(r){b.buildFields(e,r,t[r])}))},S.prototype.fill=function(t){var e=this,r=(t=Object.assign({},t)).sender?t.sender:this,n="target"in t?this.querySelector(t.target):this;return this._target.id="id"in t?t.id:this._target.id,this._target.parameters="parameters"in t?t.parameters:this._target.parameters,BITSMIST.v1.Util.safeGet(t,"settings.autoClear",this._settings.get("settings.autoClear"))&&this.clear(n),Promise.resolve().then((function(){if(BITSMIST.v1.Util.safeGet(t,"autoLoad",!0))return Promise.resolve().then((function(){return e.trigger("doTarget",r,{target:e._target,options:t})})).then((function(){return e.trigger("beforeFetch",r,{target:e._target,options:t})})).then((function(){return e.trigger("doFetch",r,{target:e._target,options:t})})).then((function(){return e.trigger("afterFetch",r,{target:e._target,options:t})}))})).then((function(){return e.trigger("beforeFill",r)})).then((function(){return b.setFields(n,e._item,e.masters),e.trigger("afterFill",r)}))},S.prototype.clear=function(t,e){return t=t||this,b.clearFields(t,e)},S.prototype.validate=function(t){var e=this,r=(t=Object.assign({},t)).sender?t.sender:this;return Promise.resolve().then((function(){return e.trigger("beforeValidate",r)})).then((function(){var n=!0,o=e.querySelector("form");return BITSMIST.v1.Util.safeGet(t,"autoValidate",e._settings.get("settings.autoValidate"))&&(n=o&&o.reportValidity?o.reportValidity():b.reportValidity(e)),n||(e.__cancelSubmit=!0),e.trigger("afterValidate",r)}))},S.prototype.submit=function(t){var e=this,r=(t=Object.assign({},t)).sender?t.sender:this;delete t.sender,this.__cancelSubmit=!1,this._item=this.getFields();var n=BITSMIST.v1.Util.safeGet(t,"itemGetter",this.settings.get("settings.itemGetter",(function(t){return[t]})));return Promise.resolve().then((function(){return e.validate()})).then((function(){return e.trigger("beforeSubmit",r)})).then((function(){if(!e.__cancelSubmit){var t=n(e._item);return e.trigger("doSubmit",r,{target:e._target,items:t})}})).then((function(){var t=n(e._item);return e.trigger("afterSubmit",r,{target:e._target,items:t})}))},S.prototype.getFields=function(){return b.getFields(this)},BITSMIST.v1.ClassUtil.inherit(T,BITSMIST.v1.Pad),Object.defineProperty(T.prototype,"row",{get:function(){return this._row}}),Object.defineProperty(T.prototype,"items",{get:function(){return this._items},set:function(t){this._items=t}}),Object.defineProperty(T.prototype,"data",{get:function(){return this._data},set:function(t){this._data=t}}),T.prototype.onListAfterAppend=function(t,e,r){this._listRootNode=this.querySelector(this._settings.get("settings.listRootNode"));var n=this._settings.get("components")[this._settings.get("settings.row")].className?this._settings.get("components")[this._settings.get("row")].className:this._settings.get("settings.row");return this._row=BITSMIST.v1.ClassUtil.createObject(n),this._row._parent=this,this._row.start()},T.prototype.start=function(t){return this._id,this._parameters,this._target={},this._data,this._items,this._listRootNode,this._row,this._rows,t=Object.assign({},t,{events:{this:{handlers:{afterAppend:[{handler:this.onListAfterAppend}]}}}}),BITSMIST.v1.Pad.prototype.start.call(this,t)},T.prototype.clear=function(){this._listRootNode.innerHTML=""},T.prototype.fill=function(t){var e=this,r=(t=Object.assign({},t)).sender?t.sender:this,n=BITSMIST.v1.Util.safeGet(t,"async",this._settings.get("settings.async",!0))?this._buildAsync:this._buildSync,o=document.createDocumentFragment();return this._rows=[],this._target.id="id"in t?t.id:this._target.id,this._target.parameters="parameters"in t?t.parameters:this._target.parameters,Promise.resolve().then((function(){if(BITSMIST.v1.Util.safeGet(t,"autoLoad",!0))return Promise.resolve().then((function(){return e.trigger("doTarget",e,{target:e._target,options:t})})).then((function(){return e.trigger("beforeFetch",r,{target:e._target,options:t})})).then((function(){return e.trigger("doFetch",r,{target:e._target,options:t})})).then((function(){return e.trigger("afterFetch",r,{target:e._target,options:t})}))})).then((function(){return e.trigger("beforeFill",r)})).then((function(){if(e._items)return n.call(e,o)})).then((function(){BITSMIST.v1.Util.safeGet(t,"autoClear",e._settings.get("settings.autoClear"))&&e.clear()})).then((function(){e._listRootNode.appendChild(o)})).then((function(){return e.trigger("afterFill",r)}))},T.prototype._buildSync=function(t){for(var e=this,r=Promise.resolve(),n=this._row.settings.get("rowevents"),o=this._row._templates[this._row.settings.get("settings.templateName")].html,i=function(i){r=r.then((function(){return e.__appendRowSync(t,i,e._items[i],o,n)}))},s=0;s<e._items.length;s++)i(s);return r},T.prototype._buildAsync=function(t){for(var e=this._row.settings.get("rowevents"),r=this._row._templates[this._row.settings.get("settings.templateName")].html,n=0;n<this._items.length;n++)this.__appendRowAsync(t,n,this._items[n],r,e)},T.prototype.__appendRowSync=function(t,e,r,n,o){var i=this,s=document.createElement("div");s.innerHTML=n;var a=s.firstElementChild;return t.appendChild(a),this._rows.push(a),o&&Object.keys(o).forEach((function(t){i._row.initEvents(t,o[t],a)})),Promise.resolve().then((function(){return i._row.trigger("beforeFillRow",i,{item:r,no:e,element:a})})).then((function(){b.setFields(a,r,i.masters)})).then((function(){return i._row.trigger("afterFillRow",i,{item:r,no:e,element:a})}))},T.prototype.__appendRowAsync=function(t,e,r,n,o){var i=this,s=document.createElement("div");s.innerHTML=n;var a=s.firstElementChild;t.appendChild(a),this._rows.push(a),o&&Object.keys(o).forEach((function(t){i._row.initEvents(t,o[t],a)})),this._row.triggerAsync("beforeFillRow",this,{item:r,no:e,element:a}),b.setFields(a,r,this.masters),this.row.triggerAsync("afterFillRow",this,{item:r,no:e,element:a})};var I=function(t){function e(e,r){t.call(this,"authentications",r)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.authenticate=function(t,e,r){var n=this;return new Promise((function(o,i){n.get("list",{user:t,password:e}).then((function(t){t.result.resultCount>0?r&&"redirect"in r&&(location.href=decodeURI(r.redirect)):i("login failed")}))}))},e}(u);function O(t){return Reflect.construct(BITSMIST.v1.Pad,[t],this.constructor)}BITSMIST.v1.ClassUtil.inherit(O,BITSMIST.v1.Component),Object.defineProperty(O.prototype,"items",{get:function(){return c._store.items}}),O.prototype.get=function(t,e){return c._store.get(t,e)},O.prototype.set=function(t,e,r){c._store.set(t,e),BITSMIST.v1.Util.safeGet(r,"autoSave",this.settings.get("preferences.settings.autoSave"))&&c.save(this)},O.prototype.load=function(t){return c.load(this,t)},O.prototype.save=function(){return c.save(this,options)},customElements.define("bm-preference",O),window.BITSMIST=window.BITSMIST||{},window.BITSMIST.v1=window.BITSMIST.v1||{},window.BITSMIST.v1.ObservableStore=t,window.BITSMIST.v1.ObservableStoreMixin=e,window.BITSMIST.v1.BindableStore=n,BITSMIST.v1.OrganizerOrganizer.organizers.set("ErrorOrganizer",{object:o,targetWords:"errors",targetEvents:["beforeStart"],order:100}),BITSMIST.v1.OrganizerOrganizer.organizers.set("FileOrganizer",{object:i,targetWords:"files",targetEvents:["afterSpecLoad"],order:200}),BITSMIST.v1.OrganizerOrganizer.organizers.set("PluginOrganizer",{object:s,targetWords:"plugins",targetEvents:["beforeStart"],order:1100}),BITSMIST.v1.OrganizerOrganizer.organizers.set("PreferenceOrganizer",{object:c,targetWords:"preferences",targetEvents:["beforeStart"],order:1200}),BITSMIST.v1.OrganizerOrganizer.organizers.set("MasterOrganizer",{object:l,targetWords:"masters",targetEvents:["beforeStart","afterSpecLoad"],order:1300}),BITSMIST.v1.OrganizerOrganizer.organizers.set("ElementOrganizer",{object:f,targetWords:"elements",targetEvents:["beforeStart"],order:2100}),BITSMIST.v1.OrganizerOrganizer.organizers.set("DatabindingOrganizer",{object:d,targetWords:"data",targetEvents:["afterAppend"],order:2100}),BITSMIST.v1.OrganizerOrganizer.organizers.set("KeyOrganizer",{object:h,targetWords:"keys",targetEvents:["afterAppend"],order:2100}),window.BITSMIST.v1.Plugin=g,window.BITSMIST.v1.CookieStoreHandler=m,window.BITSMIST.v1.ResourceHandler=y,window.BITSMIST.v1.Form=S,window.BITSMIST.v1.List=T,window.BITSMIST.v1.AuthenticationUtil=I,window.BITSMIST.v1.FormatterUtil=v,window.BITSMIST.v1.MasterUtil=p,window.BITSMIST.v1.ResourceUtil=u}();

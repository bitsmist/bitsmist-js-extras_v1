!function(){"use strict";function e(t){t=Object.assign({},t,{name:"ErrorManager",autoSetup:!1});t=Reflect.construct(BITSMIST.v1.Component,[t],this.constructor);return t._observers=new BITSMIST.v1.Store,t.addEventHandler(t,"afterStart",t.onAfterStart),t}function r(t){t=Object.assign({},t,{name:"PreferenceManager",autoSetup:!1});var e=Reflect.construct(BITSMIST.v1.Component,[t],this.constructor);e._observers=new BITSMIST.v1.Store({filter:e.__isTarget.bind(e)});t=Object.assign({},t.defaults);return e._preferences=new BITSMIST.v1.Store({items:t}),BITSMIST.v1.Globals.preferences.items=e._preferences._items,e.addEventHandler(e,"afterStart",e.onAfterStart),e.addEventHandler(e,"beforeSetup",e.onBeforeSetup),e}function n(t){t=Object.assign({},t,{name:"SettingManager",autoSetup:!1});t=Reflect.construct(BITSMIST.v1.Component,[t],this.constructor);return BITSMIST.v1.Globals.settings.items=t._settings.items,t}function t(t){t=Object.assign({},t,{name:"App",autoSetup:!1});t=Reflect.construct(BITSMIST.v1.Component,[t],this.constructor);return t._preferenceManager=new r(t._settings.get("preferences")),t._errorManager=new e,t._settingManager=new n(t._settings.get("globals")),t.addEventHandler(t,"afterStart",t.onAfterStart),t}function o(t){t=Object.assign({},t,{name:"Router",autoSetup:!1});t=Reflect.construct(BITSMIST.v1.Component,[t],this.constructor);return t._routes=t._routes||[],t._specs=t._specs||{},t.addEventHandler(t,"afterStart",t.onAfterStart),t}function i(){}function s(t,e){void 0===e&&(e={});for(var n=function(t){for(var e=[],r=0;r<t.length;){var n=t[r];if("*"!==n&&"+"!==n&&"?"!==n)if("\\"!==n)if("{"!==n)if("}"!==n)if(":"!==n)if("("!==n)e.push({type:"CHAR",index:r,value:t[r++]});else{var o=1,i="";if("?"===t[a=r+1])throw new TypeError('Pattern cannot start with "?" at '+a);for(;a<t.length;)if("\\"!==t[a]){if(")"===t[a]){if(0===--o){a++;break}}else if("("===t[a]&&(o++,"?"!==t[a+1]))throw new TypeError("Capturing groups are not allowed at "+a);i+=t[a++]}else i+=t[a++]+t[a++];if(o)throw new TypeError("Unbalanced pattern at "+r);if(!i)throw new TypeError("Missing pattern at "+r);e.push({type:"PATTERN",index:r,value:i}),r=a}else{for(var s="",a=r+1;a<t.length;){var c=t.charCodeAt(a);if(!(48<=c&&c<=57||65<=c&&c<=90||97<=c&&c<=122||95===c))break;s+=t[a++]}if(!s)throw new TypeError("Missing parameter name at "+r);e.push({type:"NAME",index:r,value:s}),r=a}else e.push({type:"CLOSE",index:r,value:t[r++]});else e.push({type:"OPEN",index:r,value:t[r++]});else e.push({type:"ESCAPED_CHAR",index:r++,value:t[r++]});else e.push({type:"MODIFIER",index:r,value:t[r++]})}return e.push({type:"END",index:r,value:""}),e}(t),t=e.prefixes,r=void 0===t?"./":t,o="[^"+_(e.delimiter||"/#?")+"]+?",i=[],s=0,a=0,c="",u=function(t){if(a<n.length&&n[a].type===t)return n[a++].value},p=function(t){var e=u(t);if(void 0!==e)return e;var r=n[a],e=r.type,r=r.index;throw new TypeError("Unexpected "+e+" at "+r+", expected "+t)},l=function(){for(var t,e="";t=u("CHAR")||u("ESCAPED_CHAR");)e+=t;return e};a<n.length;){var f,h=u("CHAR"),d=u("NAME"),m=u("PATTERN");d||m?(f=h||"",-1===r.indexOf(f)&&(c+=f,f=""),c&&(i.push(c),c=""),i.push({name:d||s++,prefix:f,suffix:"",pattern:m||o,modifier:u("MODIFIER")||""})):(d=h||u("ESCAPED_CHAR"))?c+=d:(c&&(i.push(c),c=""),u("OPEN")?(f=l(),m=u("NAME")||"",h=u("PATTERN")||"",d=l(),p("CLOSE"),i.push({name:m||(h?s++:""),pattern:m&&!h?o:h,prefix:f,suffix:d,modifier:u("MODIFIER")||""})):p("END"))}return i}function _(t){return t.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function g(t){return t&&t.sensitive?"":"i"}function a(t,e,r){return function(t,e,r){void 0===r&&(r={});for(var n=r.strict,o=void 0!==n&&n,i=r.start,s=void 0===i||i,a=r.end,n=void 0===a||a,i=r.encode,c=void 0===i?function(t){return t}:i,a="["+_(r.endsWith||"")+"]|$",i="["+_(r.delimiter||"/#?")+"]",u=s?"^":"",p=0,l=t;p<l.length;p++){var f,h,d,m=l[p];"string"==typeof m?u+=_(c(m)):(f=_(c(m.prefix)),h=_(c(m.suffix)),m.pattern?(e&&e.push(m),f||h?"+"===m.modifier||"*"===m.modifier?(d="*"===m.modifier?"?":"",u+="(?:"+f+"((?:"+m.pattern+")(?:"+h+f+"(?:"+m.pattern+"))*)"+h+")"+d):u+="(?:"+f+"("+m.pattern+")"+h+")"+m.modifier:u+="("+m.pattern+")"+m.modifier):u+="(?:"+f+h+")"+m.modifier)}n?(o||(u+=i+"?"),u+=r.endsWith?"(?="+a+")":"$"):(t=t[t.length-1],t="string"==typeof t?-1<i.indexOf(t[t.length-1]):void 0===t,o||(u+="(?:"+i+"(?="+a+"))?"),t||(u+="(?="+i+"|"+a+")"));return new RegExp(u,g(r))}(s(t,r),e,r)}function c(t,e,r){return t instanceof RegExp?function(t,e){if(!e)return t;for(var r=/\((?:\?<(.*?)>)?(?!\?)/g,n=0,o=r.exec(t.source);o;)e.push({name:o[1]||n++,prefix:"",suffix:"",modifier:"",pattern:""}),o=r.exec(t.source);return t}(t,e):Array.isArray(t)?(o=e,i=r,n=(n=t).map(function(t){return c(t,o,i).source}),new RegExp("(?:"+n.join("|")+")",g(i))):a(t,e,r);var n,o,i}function u(){}function p(){}function l(e,t){var r=this;this._component=e,this._options=new BITSMIST.v1.Store({items:Object.assign({},this._getOptions(),t)}),this._options.set("name",this._options.get("name",this.constructor.name));var n,o=this._options.get("events",{});Object.keys(o).forEach(function(t){e.addEventHandler(e,t,o[t],null,r)}),this._options.get("expose")&&(n=this,Object.defineProperty(e.__proto__,this._options.get("expose"),{get:function(){return n}}))}function f(t){this.target.push("NoRouteError")}BITSMIST.v1.ClassUtil.inherit(e,BITSMIST.v1.Component),customElements.define("bm-error",e),e.prototype.onAfterStart=function(t,e,r){this.__initErrorListeners()},e.prototype.register=function(t,e){this._observers.set(t.uniqueId,{object:t,targets:e})},e.prototype.__isTarget=function(t,e,r){for(var n=!1,o=0;o<e.length;o++)e[o]&&r.name==e[o]&&(n=!0);return n},e.prototype.__initErrorListeners=function(){var i=this;window.addEventListener("unhandledrejection",function(t){var e={};return t.reason?(e.message=t.reason instanceof XMLHttpRequest?t.reason.statusText:t.reason.message,e.stack=t.reason.stack,e.object=t.reason):e.message=t,e.type=t.type,e.name=i.__getErrorName(t),e.filename="",e.funcname="",e.lineno="",e.colno="",i.__handleException(e),!1}),window.addEventListener("error",function(t,e,r,n){var o={type:"error"};return o.name=i.__getErrorName(t),o.message=t.message,o.file=t.filename,o.line=t.lineno,o.col=t.colno,t.error&&(o.stack=t.error.stack,o.object=t.error),i.__handleException(o),!1})},e.prototype.__getErrorName=function(t){var e,r=t.reason||t.error||t.message;return r.name?e=r.name:r instanceof TypeError?e="TypeError":r instanceof XMLHttpRequest?e="AjaxError":r instanceof EvalError?e="EvalError":r instanceof RangeError?e="RangeError":r instanceof ReferenceError?e="ReferenceError":r instanceof SyntaxError?e="SyntaxError":r instanceof URIError?e="URIError":-1<(t=r.indexOf(":"))&&(e=r.substring(0,t)),e},e.prototype.__handleException=function(t){return this._observers.notifySync("handle",t,{error:t})},BITSMIST.v1.ClassUtil.inherit(r,BITSMIST.v1.Component),customElements.define("bm-preference",r),Object.defineProperty(r.prototype,"items",{get:function(){return this._preferences.items}}),r.prototype.onAfterStart=function(t,e,r){var n=this;return Promise.resolve().then(function(){return n.load()}).then(function(t){return n._preferences.merge(t)})},r.prototype.onBeforeSetup=function(t,e,r){e=e.detail;return this._observers.notifySync("setup",e,e)},r.prototype.get=function(t,e){return this._preferences.get(t,e)},r.prototype.set=function(t,e){this._preferences.set(t,e)},r.prototype.setup=function(t){var e=this;(t=Object.assign({},t)).sender;return BITSMIST.v1.Component.prototype.setup.call(this,t).then(function(){t.newPreferences&&(e._preferences.merge(t.newPreferences),e.save())})},r.prototype.register=function(t,e){this._observers.set(t.uniqueId,{object:t,targets:e})},r.prototype.deregister=function(t){this._observers.remove(t.uniqueId)},r.prototype.load=function(t){t=t&&t.sender?t.sender:this;return this.trigger("doLoadStore",t)},r.prototype.save=function(t){t=t&&t.sender?t.sender:this;return this.trigger("doSaveStore",t,{data:this._preferences.items})},r.prototype.__isTarget=function(t,e){for(var r=!1,n=e.targets,o=0;o<n.length;o++)if(t.newPreferences.hasOwnProperty(n[o])){r=!0;break}return r},BITSMIST.v1.ClassUtil.inherit(n,BITSMIST.v1.Component),customElements.define("bm-setting",n),n.prototype.get=function(t,e){return this._settings.get(t,e)},n.prototype.set=function(t,e){this._settings.set(t,e)},BITSMIST.v1.ClassUtil.inherit(t,BITSMIST.v1.Component),customElements.define("bm-app",t),Object.defineProperty(t.prototype,"globalPreferences",{get:function(){return this._preferenceManager}}),Object.defineProperty(t.prototype,"globalSettings",{get:function(){return this._settingManager}}),Object.defineProperty(t.prototype,"components",{get:function(){return this._components}}),t.prototype.onAfterStart=function(t,e,r){this._settingManager.start(),this._preferenceManager.start(),this._errorManager.start()},BITSMIST.v1.ClassUtil.inherit(o,BITSMIST.v1.Component),customElements.define("bm-router",o),Object.defineProperty(o.prototype,"routeInfo",{get:function(){return this._routeInfo}}),o.prototype.onAfterStart=function(t,e,r){var n=this;history.replaceState(this.__getDefaultState("connect"),null,null),this._routeInfo=this.__loadRouteInfo(window.location.href),this.__initPopState();var o=this.getAttribute("data-specpath")||"";return o&&this._settings.set("system.specPath",o),Promise.resolve().then(function(){return n.__initSpec(n._routeInfo.specName)}).then(function(){return n.trigger("afterSpecLoad",n,{spec:n._specs[n._routeInfo.specName]})})},o.prototype.buildUrl=function(t){var e;return t.url?e=t.url:(e=t.path||this._routeInfo.path,e+=t.query?"?"+t.query:"",e+=t.queryParameters?this.buildUrlQuery(t.queryParameters):""),e},o.prototype.buildUrlQuery=function(r){var t="";return r&&(t=Object.keys(r).reduce(function(t,e){return Array.isArray(r[e])?t+=encodeURIComponent(e)+"="+encodeURIComponent(r[e].join())+"&":r[e]&&(t+=encodeURIComponent(e)+"="+encodeURIComponent(r[e])+"&"),t},"")),t?"?"+t.slice(0,-1):""},o.prototype.loadParameters=function(){var t,e,r={};if(-1<window.location.href.indexOf("?"))for(var n=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),o=0;o<n.length;o++)e=(t=n[o].split("="))[1]&&t[1].split("#")[0],r[t[0]]=decodeURIComponent(e);return r},o.prototype.openRoute=function(t,e){e=Object.assign({},e),this._open(t,e)},o.prototype.jumpRoute=function(t,e){t=this.buildUrl(t);this._jump(t)},o.prototype.refreshRoute=function(t,e){return this._refresh(t,e)},o.prototype.updateRoute=function(t,e){return this._update(t,e)},o.prototype.replaceRoute=function(t){history.replaceState(this.__getDefaultState("replaceRoute"),null,this.buildUrl(t)),this._routeInfo=this.__loadRouteInfo(window.location.href)},o.prototype._open=function(t,e){var r=this;(e=Object.assign({},e)).pushState=void 0===e.pushState||e.pushState;var n=this.buildUrl(t),o=Object.assign({},this._routeInfo),i=this.__loadRouteInfo(n);this._routeInfo=this.__loadRouteInfo(n),!e.jump&&i.name&&o.name==i.name?Promise.resolve().then(function(){e.pushState&&history.pushState(r.__getDefaultState("_open.pushState"),null,n)}).then(function(){return o.specName!=i.specName?r._update(i,e):r._refresh(t,e)}).then(function(){t.dispUrl&&history.replaceState(r.__getDefaultState("_open.dispUrl"),null,t.dispUrl)}):this._jump(n)},o.prototype._jump=function(t){window.location.href=t},o.prototype._refresh=function(t,e){var r=this._routeInfo.componentName;if(this._components[r])return this._components[r].refresh({sender:this,pushState:!1})},o.prototype._update=function(t,e){var r=this;return Promise.resolve().then(function(){return BITSMIST.v1.Globals.organizers.notify("clear","*",r)}).then(function(){return r.__initSpec(t.specName)}).then(function(){return r.trigger("afterSpecLoad",r,{spec:r._specs[t.specName]})})},o.prototype.__loadRouteInfo=function(t){for(var e,r,n={},o=new URL(t,window.location.href),i={},s=this._routes.length-1;0<=s;s--)if(!this._routes[s].origin||this._routes[s].origin&&o.origin==this._routes[s].origin){var a=this._routes[s].path?this._routes[s].re.exec(o.pathname):[];if(a){e=this._routes[s].name,l=this._routes[s].specName||"",r=this._routes[s].componentName;for(var c=0;c<a.length-1;c++){i[this._routes[s].keys[c].name]=a[c+1];var u=this._routes[s].keys[c].name,p=a[c+1],l=l.replace("{{:"+u+"}}",p)}break}}return n.name=e,n.specName=l,n.componentName=r,n.url=o.href,n.path=o.pathname,n.query=o.search,n.parsedUrl=o,n.routeParameters=i,n.queryParameters=this.loadParameters(),n},o.prototype.__initPopState=function(){var r=this;window.history&&window.history.pushState&&window.addEventListener("popstate",function(t){var e;t.state&&(t=r._routeInfo.componentName,r._components&&r._components[t]&&(e=r._components[t].trigger("beforePopState",r)),Promise.all([e]).then(function(){r.openRoute(r.__loadRouteInfo(window.location.href),{pushState:!1})}).then(function(){var t=r._routeInfo.componentName;r._components&&r._components[t]&&r._components[t].trigger("afterPopState",r)}))})},o.prototype.__initSpec=function(e){var r=this;if(e)return Promise.resolve().then(function(){if(!r._specs[e])return r.loadSpec(e,r._settings.get("system.specPath")).then(function(t){r._specs[e]=t})}).then(function(){return BITSMIST.v1.Globals.organizers.notify("organize","afterSpecLoad",r,r._specs[e])})},o.prototype.__getDefaultState=function(t){return t+":"+window.location.href},i.organize=function(e,t){e._plugins||(e._plugins={});var r=t.plugins;return r&&Object.keys(r).forEach(function(t){i.addPlugin(e,t,r[t])}),Promise.resolve()},i.isTarget=function(t){return"afterInitComponent"!=t&&"afterStart"!=t?!1:!0},i.addPlugin=function(t,e,r){var n="className"in(r=Object.assign({},r))?r.className:e,o=BITSMIST.v1.ClassUtil.createObject(n,t,r);return t._plugins[e]=o},u.organize=function(e,t){e._routes=e._routes||[],e._specs=e._specs||{};var r=t.routes;if(r)for(var n=0;n<r.length;n++)u.addRoute(e,r[n]);var o=t.specs;return o&&Object.keys(o).forEach(function(t){e._specs[t]=o[t]}),Promise.resolve()},u.isTarget=function(t){return"afterInitComponent"!=t&&"afterStart"!=t&&"afterSpecLoad"!=t?!1:!0},u.addRoute=function(t,e,r){var n=[],n={origin:e.origin,name:e.name,path:e.path,keys:n,specName:e.specName,componentName:e.componentName,re:c(e.path,n)};r?t._routes.unshift(n):t._routes.push(n)},p.organize=function(t,e){return p.addRouteHandler(t),Promise.resolve()},p.isTarget=function(t){return"afterAppend"==t?!0:!1},p.addRouteHandler=function(t){t.querySelectorAll("[data-routepath]").forEach(function(o){t.addEventHandler(o,"click",function(t,e,r){var n={path:o.getAttribute("data-routepath")};document.querySelector("bm-router").openRoute(n)})})},(A={name:{configurable:!0},component:{configurable:!0}}).name.get=function(){return this._options.get("name")},A.component.get=function(){return this._component},A.component.set=function(t){this._component=t},l.prototype._getOptions=function(){return{}},Object.defineProperties(l.prototype,A);var h=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype.onAfterError=function(t,e,r){return this.handle(e.detail.error)},e.prototype.handle=function(t){var e,o=this;"AjaxError"==t.name&&(e=t.object.status,Object.keys(this._options.handlers.statusCode).forEach(function(n){e==n&&Object.keys(o._options.handlers.statusCode[n]).forEach(function(t){var e,r=o._options.handlers.statusCode[n][t];"route"===t&&("appName"in r||(r.appName=""),e=r.routeInfo,Object.keys(e.queryParameters).forEach(function(t){e.queryParameters[t]=e.queryParameters[t].replace("@url@",location.href)}),document.querySelector("bm-router").openRoute(e,{jump:!0}))})}))},e.prototype._getOptions=function(){return{events:{afterError:{handler:this.onAfterError}}}},e}(l);function d(t){this._options=t||{}}function m(t,e){this._name=t,this._options=e,this._data,this._parameters={}}f.prototype.handle=function(t){if(this.container.loader.loadParameters()._redirected_by_norouteerrorhandler)throw new Error("Page not found");var e={resourceName:this.options.route.resourceName,commandName:this.options.route.commandName,parameters:this.options.route.parameters};e.parameters._redirected_by_norouteerrorhandler=!0,this.container.router.openRoute(e,{})},d.prototype.get=function(t){var e=document.cookie.split(";").reduce(function(t,e){var r=e.split("="),e=r[0],r=r[1];return e&&(t[e.trim()]=r?decodeURIComponent(r.trim()):void 0),t},{});return e[t]?JSON.parse(e[t]):{}},d.prototype.set=function(t,e,r){e=t+"="+encodeURIComponent(JSON.stringify(e))+"; ";r=r||{},this._options&&(r=Object.assign(this._options,r)),e+=Object.keys(r).reduce(function(t,e){return t+=e+"="+r[e]+"; "},""),document.cookie=e};var y=function(r){function t(t,e){r.call(this,t,e),this._cookie=new d(this._options.get("cookieOptions")),this._cookieName=this._options.get("cookieOptions.name","preferences")}return r&&(t.__proto__=r),((t.prototype=Object.create(r&&r.prototype)).constructor=t).prototype.onDoLoadStore=function(t,e,r){return this._cookie.get(this._cookieName)},t.prototype.onDoSaveStore=function(t,e,r){this._cookie.set(this._cookieName,e.detail.data)},t.prototype._getOptions=function(){return{events:{doLoadStore:this.onDoLoadStore,doSaveStore:this.onDoSaveStore}}},t}(l);m.prototype.get=function(t,e){var r=this,n="GET",o=this._getOption("headers",n),i=this._getOption("options",n),s=this._getOption("url",n),a=s.dataType,s=this._buildApiUrl(this._name,t,e,s);return BITSMIST.v1.AjaxUtil.ajaxRequest({url:s,method:n,headers:o,options:i}).then(function(t){return r._convertResponseData(t.responseText,a)})},m.prototype.delete=function(t,e){var r=this,n="DELETE",o=this._getOption("headers",n),i=this._getOption("options",n),s=this._getOption("url",n),a=s.dataType,s=this._buildApiUrl(this._name,t,e,s);return BITSMIST.v1.AjaxUtil.ajaxRequest({url:s,method:n,headers:o,options:i}).then(function(t){return r._convertResponseData(t.responseText,a)})},m.prototype.insert=function(t,e,r){var n=this,o="POST",i=this._getOption("headers",o),s=this._getOption("options",o),a=this._getOption("url",o),c=a.dataType,a=this._buildApiUrl(this._name,t,r,a);return BITSMIST.v1.AjaxUtil.ajaxRequest({url:a,method:o,headers:i,options:s,data:this._convertRequestData(e,c)}).then(function(t){return n._convertResponseData(t.responseText,c)})},m.prototype.update=function(t,e,r){var n=this,o="PUT",i=this._getOption("headers",o),s=this._getOption("options",o),a=this._getOption("url",o),c=a.dataType,a=this._buildApiUrl(this._name,t,r,a);return BITSMIST.v1.AjaxUtil.ajaxRequest({url:a,method:o,headers:i,options:s,data:this._convertRequestData(e,c)}).then(function(t){return n._convertResponseData(t.responseText,c)})},m.prototype._convertRequestData=function(t,e){return JSON.stringify(t)},m.prototype._convertResponseData=function(t,e){return JSON.parse(t)},m.prototype._getOption=function(t,e){var r="settings"in this._options?this._options.settings:{},n=t in r&&"COMMON"in r[t]?r[t].COMMON:{},e=t in r&&e in r[t]?r[t][e]:{};return Object.assign(n,e)},m.prototype._buildApiUrl=function(t,e,r,n){var o=n.baseUrl,i=n.scheme,s=n.host,a=n.dataType,c=n.version;return(n.format||"@baseUrl@@query@").replace("@scheme@",i).replace("@host@",s).replace("@baseUrl@",o).replace("@resource@",t).replace("@id@",e).replace("@dataType@",a).replace("@query@",this._buildUrlQuery(r)).replace("@version@",c)},m.prototype._buildUrlQuery=function(r){var t="";return r&&(t=Object.keys(r).reduce(function(t,e){return Array.isArray(r[e])?t+=encodeURIComponent(e)+"="+encodeURIComponent(r[e].join())+"&":r[e]&&(t+=encodeURIComponent(e)+"="+encodeURIComponent(r[e])+"&"),t},"")),t?"?"+t.slice(0,-1):""};var v=function(n){function t(t,e){var r;n.call(this,t,e),this._items,"items"in e&&(t="object"==typeof e.items?e.items:(r=window,e.items.split(".").forEach(function(t){if(!(r=r[t]))throw new ReferenceError("Master not found. Master="+e.items)}),r),this._items=this.__reshapeItems(t))}n&&(t.__proto__=n),(t.prototype=Object.create(n&&n.prototype)).constructor=t;var e={items:{configurable:!0}};return e.items.get=function(){return this._items},t.prototype.load=function(){var e=this;return this.get("list").then(function(t){e._items=e.__reshapeItems(t.data)})},t.prototype.getValue=function(t){var e=t,r=this._options.title;return this._items&&t in this._items&&(e=this._items[t][r]),e},t.prototype.getItem=function(t){var e;return this._items&&t in this._items&&(e=this._items[t]),e},t.prototype.filter=function(r){var n=this;return Object.keys(this._items).reduce(function(t,e){return r(n._items[e])&&(t[e]=n._items[e]),t},{})},t.prototype.__reshapeItems=function(t){var n=this._options.id,o=this._options.title;return t.reduce(function(t,e){var r=e[n];return t[r]=e,t[r].title=e[o],t},{})},Object.defineProperties(t.prototype,e),t}(m),S=function(r){function t(t,e){r.call(this,t,e),this._masters={}}return r&&(t.__proto__=r),((t.prototype=Object.create(r&&r.prototype)).constructor=t).prototype.onAfterStart=function(t,e,r){return this.__initMasters(this._component.settings.get("masters"))},t.prototype.onAfterSpecLoad=function(t,e,r){return this.__initMasters(BITSMIST.v1.Util.safeGet(e.detail,"spec.masters"))},t.prototype.__initMasters=function(e){var r,n=this,o=[];return e&&((r=this._component.settings.get("ajaxUtil",{})).url.COMMON.baseUrl=this._component.settings.get("system.apiBaseUrl",""),Object.keys(e).forEach(function(t){n._masters[t]=new v(t,Object.assign({settings:r},e[t])),e[t].autoLoad?o.push(n._masters[t].load().then(function(){n[t]=n._masters[t]})):n[t]=n._masters[t]})),Promise.all(o)},t.prototype._getOptions=function(){return{events:{afterStart:this.onAfterStart,afterSpecLoad:this.onAfterSpecLoad}}},t}(l),b=function(o){function t(t,e){var r=this;o.call(this,t,e),this._options.set("settings",this._component.settings.get("ajaxUtil","")),this._options.set("settings.url.COMMON.baseUrl",this._component.settings.get("system.apiBaseUrl","")),this._resources={},this._defaultResourceName;var n=this._options.get("resources",[]);Object.keys(n).forEach(function(t){t=n[t];r.addResource(t,{settings:r._options.get("settings",{})})}),this.switchResource(n[0])}return o&&(t.__proto__=o),((t.prototype=Object.create(o&&o.prototype)).constructor=t).prototype.addResource=function(t,e){this._resources[t]=new m(t,Object.assign({settings:e.settings})),this[t]=this._resources[t]},t.prototype.switchResource=function(t){this._defaultResourceName=t},t.prototype.onDoFetch=function(t,e,r){var n=this,o=BITSMIST.v1.Util.safeGet(e.detail.target,"id"),i=BITSMIST.v1.Util.safeGet(e.detail.target,"parameters");if(BITSMIST.v1.Util.safeGet(e.detail.options,"autoLoad",this._options.get("autoLoad")))return this._resources[this._defaultResourceName].get(o,i).then(function(t){n._component.data=t,"items"in n._component?n._component.items=n._options.get("itemsGetter",function(t){return t.data})(t):"item"in n._component&&(n._component.item=n._options.get("itemGetter",function(t){return t.data[0]})(t))})},t.prototype.onDoSubmit=function(t,e,r){var n=this,o=BITSMIST.v1.Util.safeGet(e.detail.target,"id"),i=(BITSMIST.v1.Util.safeGet(e.detail.target,"parameters"),BITSMIST.v1.Util.safeGet(e.detail,"items"));return Promise.resolve().then(function(){return o?n._resources[n._defaultResourceName].update(o,{items:i}):n._resources[n._defaultResourceName].insert(o,{items:i})})},t.prototype._getOptions=function(){return{events:{doFetch:this.onDoFetch,doSubmit:this.onDoSubmit}}},t}(l);function I(){}function T(){}function w(t){t=Reflect.construct(BITSMIST.v1.Pad,[t],this.constructor);return t._id,t._parameters,t._item={},t.__cancelSubmit=!1,t._target={},t}function E(t){t=Reflect.construct(BITSMIST.v1.Pad,[t],this.constructor);return t._id,t._parameters,t._target={},t._data,t._items,t._listRootNode,t._row,t._rows,t.addEventHandler(t,"afterAppend",t.onListAfterAppend),t}I.format=function(t,e,r){var n=r;switch(e.toLowerCase()){case"yyyy/mm/dd":n=I.formatDate(e,n);break;case"price":n=I.formatPrice(e,n)}return n},I.formatPrice=function(t,e){return e?"¥"+String(parseInt(e)).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,"):""},I.formatNumber=function(t){return t?String(parseInt(t)).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,"):""},I.formatDate=function(t,e){var r="";return e&&8==e.length&&(r=e.substr(0,4)+"/"+e.substr(4,2)+"/"+e.substr(6,2)),r},I.deformat=function(t,e,r){var n=r;switch(e){case"yyyy/mm/dd":n=I.deformatDate(e,r);break;case"price":n=I.deformatPrice(e,r)}return n},I.deformatPrice=function(t,e){var r="";return e&&(r=e.replace(/,/g,"").replace(/\//g,"").replace(/\\/g,"").replace("¥","")),r},I.deformatDate=function(t,e){var r="";return e&&(r=e.replace(/,/g,"").replace(/\//g,"").replace(/\\/g,"")),r},I.getNow=function(t){t=t||"-";var e=new Date;return e.getFullYear()+t+("00"+(e.getMonth()+1)).slice(-2)+t+("00"+e.getDate()).slice(-2)+" "+("00"+e.getHours()).slice(-2)+":"+("00"+e.getMinutes()).slice(-2)+":"+("00"+e.getSeconds()).slice(-2)},I.getToday=function(t){t=void 0===t?"-":t;var e=new Date;return e.getFullYear()+t+("00"+(e.getMonth()+1)).slice(-2)+t+("00"+e.getDate()).slice(-2)},I.sanitize=function(t){return"string"==typeof t?t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"):t},T.setFields=function(t,n,o){var i=this,e=t.querySelectorAll("[data-bm-field]");Array.prototype.concat([t],Array.prototype.slice.call(e,0)).forEach(function(t){var e,r=t.getAttribute("data-bm-field");r in n&&(t.hasAttribute("data-bm-master")?(e=t.getAttribute("data-bm-master"),e=i.getMasterValue(o,e,n[r]),i.setValue(t,e)):i.setValue(t,n[r]))})},T.getFields=function(t,e){var n=this,o={};e=e||"";e=t.querySelectorAll(e+" [data-bm-formitem]");return(e=Array.prototype.slice.call(e,0)).forEach(function(t){var e=t.getAttribute("data-bm-field"),r=n.getValue(t);Array.isArray(o[e])?r&&o[e].push(r):o[e]?r&&((t=[]).push(o[e]),t.push(r),o[e]=t):o[e]=r}),o},T.clearFields=function(t,e){e=e||"";var r=t.querySelectorAll(e+" input");(r=Array.prototype.slice.call(r,0)).forEach(function(t){switch(t.type.toLowerCase()){case"search":case"text":case"number":t.value="";break;case"checkbox":case"radio":t.checked=!1}}),r=t.querySelectorAll(e+" select"),(r=Array.prototype.slice.call(r,0)).forEach(function(t){t.selectedIndex=-1})},T.buildFields=function(t,e,o){e=t.querySelectorAll("[data-bm-field='"+e+"']");(e=Array.prototype.slice.call(e,0)).forEach(function(n){var t,e,r;"select"==n.tagName.toLowerCase()?(n.options.length=0,"emptyItem"in o&&(t="text"in o.emptyItem?o.emptyItem.text:"",e="value"in o.emptyItem?o.emptyItem.value:"",(r=document.createElement("option")).text=t,r.value=e,r.setAttribute("selected",""),n.appendChild(r)),Object.keys(o.items).forEach(function(t){var e=document.createElement("option");e.text=o.items[t].title,e.value=t,n.appendChild(e)})):Object.keys(o.items).forEach(function(t){var e=document.createElement("label"),r=document.createElement("input");r.type="radio",r.id=key,r.name=key,r.value=t,r.setAttribute("data-bm-field",key),r.setAttribute("data-bm-formitem",""),e.appendChild(r),e.appendChild(document.createTextNode(o.items[t].title)),n.appendChild(e)})})},T.getMasterValue=function(t,e,r){var n=r;return t&&e in t&&(n=t[e].getValue(r)),n},T.setValue=function(t,e){null!==e&&null!=e||(e=""),t.hasAttribute("data-bm-format")&&(e=I.format("",t.getAttribute("data-bm-format"),e));var r=I.sanitize(e),n=t.getAttribute("data-bm-target");if(n)for(var o=n.split(","),i=0;i<o.length;i++){var s=o[i].toLowerCase();switch(s){case"html":t.innerHTML=e;break;case"href":case"src":case"rel":"http"!=e.substring(0,4)&&"/"!=e.substring(0,1)||t.setAttribute(s,e);break;default:var a=(a=t.getAttribute(s))?a+" "+e:r;t.setAttribute(s,a)}}else if(t.hasAttribute("value"))"input"==t.tagName.toLowerCase()&&"checkbox"==t.type.toLowerCase()||"input"==t.tagName.toLowerCase()&&"radio"==t.type.toLowerCase()?Array.isArray(e)?-1<e.indexOf(t.getAttribute("value"))&&(t.checked=!0):t.getAttribute("value")==e&&(t.checked=!0):t.setAttribute("value",I.sanitize(e));else if("select"==t.tagName.toLowerCase())t.value=e;else if("fieldset"!=t.tagName.toLowerCase())if("input"==t.tagName.toLowerCase())switch(t.type.toLowerCase()){case"number":case"search":case"text":t.value=e;break;case"checkbox":t.checked=!!e;break;case"radio":t.value==e&&(t.checked=!0)}else t.innerText=e;n=document.createEvent("HTMLEvents");n.initEvent("change",!0,!0),t.dispatchEvent(n)},T.getValue=function(t){var e=void 0;switch(t.tagName.toLowerCase()){case"input":switch(t.type.toLowerCase()){case"radio":case"checkbox":t.checked&&(e=t.hasAttribute("value")?t.getAttribute("value"):t.checked);break;default:e=t.value}break;case"select":e=t.value;break;default:t.hasAttribute("selected")&&(e=t.getAttribute("value"))}return t.hasAttribute("data-bm-format")&&(e=BITSMIST.v1.FormatterUtil.deformat("",t.getAttribute("data-bm-format"),e)),e},T.reportValidity=function(t){var e=!0,t=t.querySelectorAll("input");return(t=Array.prototype.slice.call(t,0)).forEach(function(t){"number"===t.getAttribute("type")&&(t.validity&&0==t.validity.valid||isNaN(t.value))&&(t.style.border="solid 3px red",e=!1)}),e},BITSMIST.v1.ClassUtil.inherit(w,BITSMIST.v1.Pad),Object.defineProperty(w.prototype,"item",{get:function(){return this._item},set:function(t){this._item=t}}),Object.defineProperty(w.prototype,"data",{get:function(){return this._data},set:function(t){this._data=t}}),w.prototype.build=function(e){var r=this;Object.keys(e).forEach(function(t){T.buildFields(r,t,e[t])})},w.prototype.fill=function(t){var e=this,r=(t=Object.assign({},this.settings.items,t)).sender||this;return this._target.id=("id"in t?t:this._target).id,this._target.parameters=("parameters"in t?t:this._target).parameters,t.autoClear&&this.clear(),Promise.resolve().then(function(){return e.trigger("doTarget",r)}).then(function(){return e.trigger("beforeFetch",r,{target:e._target,options:t})}).then(function(){return e.trigger("doFetch",r,{target:e._target,options:t})}).then(function(){return e.trigger("afterFetch",r,{target:e._target,options:t})}).then(function(){return e.trigger("beforeFill",r)}).then(function(){return T.setFields(e,e._item,e.masters),e.trigger("afterFill",r)})},w.prototype.clear=function(t){return T.clearFields(this,t)},w.prototype.validate=function(t){var r=this,n=(t=Object.assign({},t)).sender||this;return Promise.resolve().then(function(){return r.trigger("beforeValidate",n)}).then(function(){var t=!0,e=r.querySelector("form");return r.settings.get("autoValidate")&&(t=e&&e.reportValidity?e.reportValidity():T.reportValidity(r)),t||(r.__cancelSubmit=!0),r.trigger("afterValidate",n)})},w.prototype.submit=function(t){var e=this,r=(t=Object.assign({},t)).sender||this;return delete t.sender,this.__cancelSubmit=!1,this._item=this.getFields(),Promise.resolve().then(function(){return e.validate()}).then(function(){return e.trigger("beforeSubmit",r)}).then(function(){if(!e.__cancelSubmit){var t=e.settings.get("itemGetter",function(t){return[t]})(e._item);return e.trigger("doSubmit",r,{target:e._target,items:t})}}).then(function(){var t=e.settings.get("itemGetter",function(t){return[t]})(e._item);return e.trigger("afterSubmit",r,{target:e._target,items:t})})},w.prototype.getFields=function(){return T.getFields(this)},BITSMIST.v1.ClassUtil.inherit(E,BITSMIST.v1.Pad),Object.defineProperty(E.prototype,"row",{get:function(){return this._row}}),Object.defineProperty(E.prototype,"items",{get:function(){return this._items},set:function(t){this._items=t}}),Object.defineProperty(E.prototype,"data",{get:function(){return this._data},set:function(t){this._data=t}}),E.prototype.onListAfterAppend=function(t,e,r){this._listRootNode=this.querySelector(this._settings.get("listRootNode"));var n=this._settings.get("components")[this._settings.get("row")].className?this._settings.get("components")[this._settings.get("row")].className:this._settings.get("row");return this._row=BITSMIST.v1.ClassUtil.createObject(n),(this._row._parent=this)._row.start()},E.prototype.clear=function(){this._listRootNode.innerHTML=""},E.prototype.fill=function(t){var e=this,r=(t=Object.assign({},this.settings.items,t)).sender||this,n=this._settings.get("async")?this._buildAsync:this._buildSync,o=document.createDocumentFragment();return this._rows=[],this._target.id=("id"in t?t:this._target).id,this._target.parameters=("parameters"in t?t:this._target).parameters,Promise.resolve().then(function(){return e.trigger("doTarget",e)}).then(function(){return e.trigger("beforeFetch",r,{target:e._target,options:t})}).then(function(){return e.trigger("doFetch",r,{target:e._target,options:t})}).then(function(){return e.trigger("afterFetch",r,{target:e._target,options:t})}).then(function(){return e.trigger("beforeFill",r)}).then(function(){if(e._items)return n.call(e,o)}).then(function(){t.autoClear&&e.clear()}).then(function(){e._listRootNode.appendChild(o)}).then(function(){return e.trigger("afterFill",r)})},E.prototype._buildSync=function(t){for(var e=0;e<this._items.length;e++)this.__appendRowSync(t,e,this._items[e])},E.prototype._buildAsync=function(e){for(var r=this,n=Promise.resolve(),t=0;t<r._items.length;t++)!function(t){n=n.then(function(){return r.__appendRowAsync(e,t,r._items[t])})}(t);return n},E.prototype.__appendRowAsync=function(t,e,r){var n=this,o=this._row.clone();t.appendChild(o),this._rows.push(o);t=this._row.getEventHandler(this._row.settings.get("events.click"));return t&&this._row.addEventHandler(o,"click",t,{item:r,no:e,element:o}),Object.keys(this._row.settings.get("elements",{})).forEach(function(t){n._row.setHtmlEventHandlers(t,{item:ttem,no:e,element:o},o)}),Promise.resolve().then(function(){return n._row.trigger("beforeFillRow",n,{item:r,no:e,element:o})}).then(function(){T.setFields(o,r,n.masters)}).then(function(){return n._row.trigger("afterFillRow",n,{item:r,no:e,element:o})})},E.prototype.__appendRowSync=function(t,e,r){var n=this,o=this._row.clone();t.appendChild(o),this._rows.push(o);t=this._row.getEventHandler(this._row.settings.get("events.click"));t&&this._row.addEventHandler(o,"click",t,{item:r,no:e,element:o}),Object.keys(this._row.settings.get("elements",{})).forEach(function(t){n._row.setHtmlEventHandlers(t,{item:r,no:e,element:o},o)}),this._row.triggerSync("beforeFillRow",this,{item:r,no:e,element:o}),T.setFields(o,r,this.masters),this.row.triggerSync("afterFillRow",this,{item:r,no:e,element:o})};var M=function(r){function t(t,e){r.call(this,t,e),this.__isComposing=!1}return r&&(t.__proto__=r),((t.prototype=Object.create(r&&r.prototype)).constructor=t).prototype.onAfterAppend=function(t,e,r){var n=this._options.get("features.defaultKeys");n&&(this._component.addEventHandler(this._component,"keydown",this.onKeyDown,n,this),this._component.addEventHandler(this._component,"keypress",this.onKeyPress,n,this),this._component.addEventHandler(this._component,"compositionstart",this.onCompositionStart,n,this),this._component.addEventHandler(this._component,"compositionend",this.onCompositionEnd,n,this));n=this._options.get("features.defaultButtons");n&&(this.__initElements(n.submit,this.onDefaultSubmit),this.__initElements(n.cancel,this.onDefaultCancel),this.__initElements(n.clear,this.onDefaultClear))},t.prototype.onKeyDown=function(t,e,r){var n=e.key||this.__getKeyfromKeyCode(e.keyCode);"escape"===(n="esc"==(n=n.toLowerCase())?"escape":n)&&this.onKeyPress(t,e,r)},t.prototype.onKeyPress=function(t,e,r){var n;this.__isComposing||229==e.keyCode||(n="esc"==(n=(n=e.key||this.__getKeyfromKeyCode(e.keyCode)).toLowerCase())?"escape":n,r.options.submit&&n==r.options.submit.key?this.onDefaultSubmit(t,e,{options:r.options.submit}):r.options.cancel&&n==r.options.cancel.key?this.onDefaultCancel(t,e,{options:r.options.cancel}):r.options.clear&&n==r.options.clear.key&&this.onDefaultClear(t,e,{options:r.options.clear}))},t.prototype.onCompositionStart=function(t,e,r){this.__isComposing=!0},t.prototype.onCompositionEnd=function(t,e,r){this.__isComposing=!1},t.prototype.onDefaultSubmit=function(t,e,r){var n=this;this._component.submit().then(function(){n._component.__cancelSubmit||(n._component._isModal&&(n._component._modalResult.result=!0),r&&r.options.autoClose&&n._component.close())})},t.prototype.onDefaultCancel=function(t,e,r){this._component.close()},t.prototype.onDefaultClear=function(t,e,r){var n;r&&r.options.target&&(n=t.getAttribute(r.options.target)),this._component.clear(n)},t.prototype.__getKeyfromKeyCode=function(t){t=13===t?"Enter":String.fromCharCode(t);return t},t.prototype.__initElements=function(e,r){var t,n=this;e&&(t=this._component.querySelectorAll(e.rootNode),(t=Array.prototype.slice.call(t,0)).forEach(function(t){n._component.addEventHandler(t,"click",r,e,n)}))},t.prototype._getOptions=function(){return{events:{afterAppend:this.onAfterAppend}}},t}(l),A=function(r){function t(t,e){r.call(this,"authentications",e)}return r&&(t.__proto__=r),((t.prototype=Object.create(r&&r.prototype)).constructor=t).prototype.authenticate=function(r,n,o){var i=this;return new Promise(function(t,e){i.get("list",{user:r,password:n}).then(function(t){0<t.result.resultCount?o&&"redirect"in o&&(location.href=decodeURI(o.redirect)):e("login failed")})})},t}(m);window.BITSMIST=window.BITSMIST||{},window.BITSMIST.v1=window.BITSMIST.v1||{},window.BITSMIST.v1.App=t,window.BITSMIST.v1.Router=o,window.BITSMIST.v1.SettingManager=n,window.BITSMIST.v1.PreferenceManager=r,window.BITSMIST.v1.ErrorManager=e,BITSMIST.v1.Globals.organizers.set("PluginOrganizer",{object:i,targets:"plugins"}),BITSMIST.v1.Globals.organizers.set("RouteOrganizer",{object:u,targets:"routes"}),BITSMIST.v1.Globals.organizers.set("RouteHandlerOrganizer",{object:p,targets:""}),window.BITSMIST.v1.Plugin=l,window.BITSMIST.v1.AjaxErrorHandler=h,window.BITSMIST.v1.NoRouteErrorHandler=f,window.BITSMIST.v1.CookieStoreHandler=y,window.BITSMIST.v1.MasterHandler=S,window.BITSMIST.v1.ResourceHandler=b,window.BITSMIST.v1.Form=w,window.BITSMIST.v1.List=E,window.BITSMIST.v1.DefaultkeyHandler=M,window.BITSMIST.v1.AuthenticationUtil=A,window.BITSMIST.v1.FormatterUtil=I,window.BITSMIST.v1.MasterUtil=v,window.BITSMIST.v1.ResourceUtil=m}();

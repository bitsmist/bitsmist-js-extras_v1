!function(){"use strict";if(!window.BITSMIST||!window.BITSMIST.v1||!window.BITSMIST.v1.Component)throw new ReferenceError("Bitsmist Core Library does not exist.");var t=window.BITSMIST.v1;class r extends t.ChainableStore{constructor(e){super(Object.assign({notifyOnChange:!0,async:!1},e)),this._filter,this._observers=[],this.filter=t.Util.safeGet(this._options,"filter",(()=>!0))}get filter(){return this._filter}set filter(e){t.Util.assert("function"==typeof e,`Store.filter(setter): Filter is not a function. filter=${e}`,TypeError),this._filter=e}set(e,r,i,...s){let n={},a=e?this.get(e):this._items;if(a&&"object"==typeof a?this.__deepMerge(a,r,n):this.get(e)!==r&&(t.Util.safeSet(this._items,e,r),n[e]=r),t.Util.safeGet(i,"notifyOnChange",t.Util.safeGet(this._options,"notifyOnChange"))&&Object.keys(n).length>0)return this.notify(n,...s)}replace(e,r,...i){if(this._items={},this.__deepMerge(this._items,e),t.Util.safeGet(r,"notifyOnChange",t.Util.safeGet(this._options,"notifyOnChange")))return this.notify("*",...i)}subscribe(e,r,i){t.Util.assert("function"==typeof r,`ObservableStore.subscribe(): Notification handler is not a function. id=${e}`,TypeError),this._observers.push({id:e,handler:r,options:i})}unsubscribe(e){for(let t=0;t<this._observers.length;t++)if(this._obvservers[t].id===e){this._observers.splice(t,1);break}}notify(e,...r){return t.Util.safeGet(this._options,"async",!1)?this.notifyAsync(e,...r):this.notifySync(e,...r)}notifySync(e,...t){let r=Promise.resolve();for(let i=0;i<this._observers.length;i++)r=r.then((()=>{if(this._filter(e,this._observers[i],...t))return this._observers[i].handler(e,...t)}));return r}notifyAsync(e,...t){for(let r=0;r<this._observers.length;r++)this._filter(e,this._observers[r],...t)&&this._observers[r].handler(e,...t);return Promise.resolve()}mute(){this._options.notifyOnChange=!1}unmute(){this._options.notifyOnChange=!0}__deepMerge(e,r,i){return i=i||{},t.Util.assert(e&&"object"==typeof e&&r&&"object"==typeof r,"ObservableStore.__deepMerge(): Parameters must be an object.",TypeError),Object.keys(r).forEach((t=>{Array.isArray(e[t])?(e[t]=e[t].concat(r[t]),i[t]=e[t]):e.hasOwnProperty(t)&&e[t]&&"object"==typeof e[t]&&r[t]&&"object"==typeof r[t]&&!(e[t]instanceof HTMLElement)?Util.deepMerge(e[t],r[t]):e[t]!==r[t]&&(e[t]=r[t],i[t]=e[t])})),e}}function i(){}function s(){}i.format=function(e,t,r){let s=r;switch(t.toLowerCase()){case"yyyy/mm/dd":s=i.formatDate(t,s);break;case"price":s=i.formatPrice(t,s)}return s},i.formatPrice=function(e,t){return t?"¥"+String(parseInt(t)).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,"):""},i.formatNumber=function(e){return e?String(parseInt(e)).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,"):""},i.formatDate=function(e,t){var r="";return t&&8===t.length&&(r=t.substr(0,4)+"/"+t.substr(4,2)+"/"+t.substr(6,2)),r},i.deformat=function(e,t,r){let s=r;switch(t){case"yyyy/mm/dd":s=i.deformatDate(t,r);break;case"price":s=i.deformatPrice(t,r)}return s},i.deformatPrice=function(e,t){var r="";return t&&(r=t.replace(/,/g,"").replace(/\//g,"").replace(/\\/g,"").replace("¥","")),r},i.deformatDate=function(e,t){var r="";return t&&(r=t.replace(/,/g,"").replace(/\//g,"").replace(/\\/g,"")),r},i.getNow=function(e){e=e||"-";var t=new Date;return t.getFullYear()+e+("00"+(t.getMonth()+1)).slice(-2)+e+("00"+t.getDate()).slice(-2)+" "+("00"+t.getHours()).slice(-2)+":"+("00"+t.getMinutes()).slice(-2)+":"+("00"+t.getSeconds()).slice(-2)},i.getToday=function(e){e=void 0===e?"-":e;var t=new Date;return t.getFullYear()+e+("00"+(t.getMonth()+1)).slice(-2)+e+("00"+t.getDate()).slice(-2)},i.sanitize=function(e){return"string"==typeof e?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"):e},s.showConditionalElements=function(e,r){t.Util.scopedSelectorAll(e,"[bm-visible]").forEach((e=>{let i=e.getAttribute("bm-visible");t.Util.safeEval(i,r,r)?e.style.removeProperty("display"):e.style.display="none"}))},s.hideConditionalElements=function(e){t.Util.scopedSelectorAll(e,"[bm-visible]").forEach((e=>{e.style.display="none"}))},s.setFields=function(e,r,n){let a=t.Util.safeGet(n,"masters"),o=t.Util.safeGet(n,"triggerEvent"),l=t.Util.scopedSelectorAll(e,"[bm-bind]");l.push(e),l.forEach((e=>{let n=e.getAttribute("bm-bind");if(n in r){let l=t.Util.safeGet(r,n,"");if(e.hasAttribute("bm-bindtext")){let t=e.getAttribute("bm-bindtext").split("."),i=t[0],o=t[1]||"";l=s._getMasterValue(a,i,r[n],o)}if(e.hasAttribute("bm-format")&&(l=i.format("",e.getAttribute("bm-format"),l)),s.setValue(e,l),o){let t=document.createEvent("HTMLEvents");t.initEvent(o,!0,!0),e.dispatchEvent(t)}}}))},s.getFields=function(e){let r={},i=t.Util.scopedSelectorAll(e,"[bm-bind]");return i.push(e),i.forEach((e=>{let i=e.getAttribute("bm-bind"),n=s.getValue(e);if(e.hasAttribute("bm-format")&&(n=t.FormatterUtil.deformat("",e.getAttribute("bm-format"),n)),Array.isArray(r[i]))n&&r[i].push(n);else if(r[i]){if(n){let e=[];e.push(r[i]),e.push(n),r[i]=e}}else r[i]=n})),r},s.clearFields=function(e,r){r=r||"";let i=t.Util.scopedSelectorAll(e,r+" input");i.forEach((e=>{switch(e.type.toLowerCase()){case"search":case"text":case"number":e.value="";break;case"checkbox":case"radio":e.checked=!1}})),i=e.querySelectorAll(r+" select"),i=Array.prototype.slice.call(i,0),i.forEach((e=>{e.selectedIndex=-1}))},s.setValue=function(e,t){null==t&&(t="");let r=e.getAttribute("bm-bindtarget");r?s._setValue_target(e,r,t):e.hasAttribute("value")?s._setValue_value(e,t):s._setValue_element(e,t)},s.build=function(e,t,r){if("select"===e.tagName.toLowerCase())s._build_select(e,t,r)},s.getValue=function(e){let t;switch(e.tagName.toLowerCase()){case"input":switch(e.type.toLowerCase()){case"radio":case"checkbox":e.checked&&(t=e.hasAttribute("value")?e.getAttribute("value"):e.checked);break;default:t=e.value}break;case"select":t=e.value;break;default:e.hasAttribute("selected")&&(t=e.getAttribute("value"))}return t},s._build_select=function(e,t,r){if(r=r||{},e.options.length=0,"emptyItem"in r){let t="text"in r.emptyItem?r.emptyItem.text:"",i="value"in r.emptyItem?r.emptyItem.value:"",s=document.createElement("option");s.text=t,s.value=i,s.setAttribute("selected",""),e.appendChild(s)}Object.keys(t).forEach((i=>{let s=document.createElement("option");s.text=r.text?t[i][r.text]:i,s.value=r.value?t[i][r.value]:i,e.appendChild(s)})),"defaultValue"in r&&(e.value=r.defaultValue)},s._build_radio=function(e,t,r){Object.keys(r.items).forEach((e=>{let t=document.createElement("label"),i=document.createElement("input");i.type="radio",i.id=key,i.name=key,i.value=e,i.setAttribute("bm-bind",key),i.setAttribute("bm-submit",""),t.appendChild(i),t.appendChild(document.createTextNode(r.items[e].title)),element.appendChild(t)}))},s._setValue_target=function(e,t,r){let i=t.split(",");for(let t=0;t<i.length;t++){let s=i[t].toLowerCase();switch(s){case"text":e.innerText=r;break;case"html":e.innerHTML=r;break;case"outerhtml":r&&(e.outerHTML=r);break;case"href":case"src":case"rel":"http"!==r.substring(0,4)&&"/"!==r.substring(0,1)||e.setAttribute(s,r);break;default:let t=e.getAttribute(s);t=t?t+" "+r:r,e.setAttribute(s,t)}}},s._setValue_value=function(e,t){"input"===e.tagName.toLowerCase()&&"checkbox"===e.type.toLowerCase()||"input"===e.tagName.toLowerCase()&&"radio"===e.type.toLowerCase()?Array.isArray(t)?t.indexOf(e.getAttribute("value"))>-1&&(e.checked=!0):e.getAttribute("value")===t&&(e.checked=!0):e.setAttribute("value",t)},s._setValue_element=function(e,t){if("select"===e.tagName.toLowerCase())e.value=t;else if("input"===e.tagName.toLowerCase())switch(e.type.toLowerCase()){case"number":case"search":case"text":e.value=t;break;case"checkbox":e.checked=!!t;break;case"radio":e.value===t&&(e.checked=!0)}else e.innerText=t},s._getMasterValue=function(e,t,r,i){let s=r;if(e&&t in e){let n=e[t].getItem(r);n&&(s=n[i])}return s};class n extends r{constructor(e){super(e),this.filter=(e,t,...r)=>{let i=!1;return("*"===e||e.indexOf(t.id)>-1)&&(i=!0),i}}bindTo(e){let r=e.getAttribute("bm-bind");if(!!(!e.__bm_bindinfo||!e.__bm_bindinfo.bound)&&t.Util.safeGet(this._options,"2way",!0)){this.subscribe(r,(()=>{s.setValue(e,this.get(r))}));let i=t.Util.safeGet(this._options,"eventName","change");e.addEventListener(i,(()=>{this.set(r,s.getValue(e),{notifyOnChange:!1})}).bind(this)),e.__bm_bindinfo={bound:!0}}}}class a extends t.Organizer{static get name(){return"FileOrganizer"}static FileOrganizer_onDoOrganize(e,r,i){let s=[];return this._enumSettings(r.detail.settings.files,((e,r)=>{s.push(t.AjaxUtil.loadScript(r.href))})),Promise.all(s)}static getInfo(){return{sections:"files",order:110}}static init(e,t){this._addOrganizerHandler(e,"doOrganize",a.FileOrganizer_onDoOrganize)}}class o extends t.Organizer{static get name(){return"ErrorOrganizer"}static getInfo(){return{sections:"errors",order:120}}static globalInit(){o._observers=new t.ObservableStore({filter:o.__filter}),document.addEventListener("DOMContentLoaded",(()=>{t.settings.get("organizers.ErrorOrganizer.settings.captureError",!0)&&o.__initErrorListeners()}))}static init(e,r){t.Util.safeGet(r,"settings.errors")&&o._observers.subscribe(e.uniqueId,e.trigger.bind(e),{component:e})}static __filter(e,t,...r){let i=!1,s=t.options.component.settings.get("errors.targets"),n=r[0].error;for(let e=0;e<s.length;e++)if(n.name===s[e]||"*"===s[e]){i=!0;break}return i}static __initErrorListeners(){window.addEventListener("unhandledrejection",(e=>{let t={};try{e.reason?e.reason instanceof XMLHttpRequest?(t.message=e.reason.statusText,t.stack=e.reason.stack,t.object=e.reason):(t.message=e.reason.message,t.object=e.reason):t.message=e,t.type=e.type,t.name=o.__getErrorName(e),t.filename="",t.funcname="",t.lineno="",t.colno="",o.__handleException(t)}catch(t){}return!1})),window.addEventListener("error",((e,t,r,i)=>{let s={};try{s.type="error",s.name=o.__getErrorName(e),s.message=e.message,s.file=e.filename,s.line=e.lineno,s.col=e.colno,e.error&&(s.stack=e.error.stack,s.object=e.error),o.__handleException(s)}catch(s){}return!1}))}static __getErrorName(e){let t,r;if(r=e.reason instanceof XMLHttpRequest||e.reason?e.reason:e.error?e.error:e.message,r.name)t=r.name;else if(r instanceof TypeError)t="TypeError";else if(r instanceof XMLHttpRequest)t="AjaxError";else if(r instanceof EvalError)t="EvalError";else if(r instanceof RangeError)t="RangeError";else if(r instanceof ReferenceError)t="ReferenceError";else if(r instanceof SyntaxError)t="SyntaxError";else if(r instanceof URIError)t="URIError";else{let e=r.indexOf(":");e>-1&&(t=r.substring(0,e))}return t}static __handleException(e){return o._observers.notifyAsync("error",{sender:o,error:e})}}class l extends t.Organizer{static get name(){return"ElementOrganizer"}static ElementOrganizer_onDoOrganize(e,t,r){let i=l.getInfo().order;this._enumSettings(t.detail.settings.elements,((e,t)=>{this.addEventHandler(e,{handler:l.ElementOrganizer_onDoProcess,order:i,options:{attrs:t}})}))}static ElementOrganizer_onDoProcess(e,t,r){let i=r.options.attrs,s=[];return Object.keys(i).forEach((e=>{s=s.concat(l.__initElements(this,t,e,i[e]))})),Promise.all(s)}static getInfo(){return{sections:"elements",order:220}}static init(e,t){e._overlay,e._overlayPromise=Promise.resolve(),this._addOrganizerHandler(e,"doOrganize",l.ElementOrganizer_onDoOrganize)}static __getTargetElements(e,t,r){let i;return i=r.rootNode?"this"===r.rootNode||r.rootNode===e.tagName.toLowerCase()?[e]:e.rootElement.querySelectorAll(r.rootNode):"this"===t||t===e.tagName.toLowerCase()?[e]:e.rootElement.querySelectorAll("#"+t),i}static __initElements(e,t,r,i){let n=[],a=l.__getTargetElements(e,r,i);for(let o=0;o<a.length;o++){let c=a[o];Object.keys(i).forEach((t=>{switch(t){case"scroll":a[o].scrollTo(i[t]);break;case"showLoader":l.__showOverlay(e,i[t]),c=e._overlay;break;case"hideLoader":l.__hideOverlay(e,i[t]),c=e._overlay;break;case"build":let r=i[t].resourceName;s.build(a[o],e.resources[r].items,i[t]);break;case"attribute":l.__setAttributes(a[o],i[t]);break;case"class":l.__setClasses(a[o],i[t]);break;case"style":Object.keys(i[t]).forEach((e=>{a[o].style[e]=i[t][e]}));break;case"property":Object.keys(i[t]).forEach((e=>{a[o][e]=i[t][e]}));break;case"autoFocus":a[o].focus()}})),i.waitFor&&n.push(l.__waitFor(e,t,r,i,c))}return n}static __waitFor(e,r,i,s,n){let a=!1;switch(s.waitFor){case"transition":a="0s"!==window.getComputedStyle(n).getPropertyValue("transition-duration");break;case"animation":a="none"!==window.getComputedStyle(n).getPropertyValue("animation-name")}return t.Util.warn(a,`ElementOrganizer.__initAttr(): Element not in ${s.waitFor}. name=${e.name}, eventName=${r.type}, elementName=${i}`),new Promise(((a,o)=>{let l=setTimeout((()=>{o(`ElementOrganizer.__initAttr(): Timed out waiting for ${s.waitFor}. name=${e.name}, eventName=${r.type}, elementName=${i}`)}),t.settings.get("system.waitForTimeout",1e4));n.addEventListener(s.waitFor+"end",(()=>{clearTimeout(l),a()}),{once:!0})}))}static __setAttributes(e,t){Object.keys(t).forEach((r=>{switch(r){case"add":Object.keys(t[r]).forEach((i=>{e.setAttribute(i,t[r][i])}));break;case"remove":for(let i=0;i<t[r].length;i++)e.removeAttribute(t[r][i])}}))}static __setClasses(e,t){Object.keys(t).forEach((r=>{switch(r){case"add":e.classList.add(t[r]);break;case"remove":e.classList.remove(t[r]);break;case"replace":e.setAttribute("class",t[r])}}))}static __createOverlay(e,t){e._overlay||(e.insertAdjacentHTML("afterbegin",'<div class="overlay"></div>'),e._overlay=e.firstElementChild)}static __closeOnClick(e,t){e._overlay.addEventListener("click",(t=>{t.target===t.currentTarget&&"function"==typeof e.close&&e.close({reason:"cancel"})}),{once:!0})}static __getEffect(e){let t="";return"0s"!==window.getComputedStyle(e).getPropertyValue("transition-duration")?t="transition":"none"!==window.getComputedStyle(e).getPropertyValue("animation-name")&&(t="animation"),t}static __showOverlay(e,r){l.__createOverlay(e),t.Util.safeGet(r,"closeOnClick")&&l.__closeOnClick(e),window.getComputedStyle(e._overlay).getPropertyValue("visibility");let i=["show"].concat(t.Util.safeGet(r,"addClasses",[]));e._overlay.classList.add(...i),e._overlay.classList.remove(...t.Util.safeGet(r,"removeClasses",[]));let s=l.__getEffect(e._overlay);s?e._overlayPromise=new Promise(((t,r)=>{e._overlay.addEventListener(s+"end",(()=>{t()}),{once:!0})})):s=Promise.resolve()}static __hideOverlay(e,r){e._overlayPromise.then((()=>{window.getComputedStyle(e._overlay).getPropertyValue("visibility");let i=["show"].concat(t.Util.safeGet(r,"removeClasses",[]));e._overlay.classList.remove(...i),e._overlay.classList.add(...t.Util.safeGet(r,"addClasses",[]))}))}}class c extends t.Organizer{static get name(){return"ResourceOrganizer"}static ResourceOrganizer_onDoOrganize(e,t,r){let i=[];return this._enumSettings(t.detail.settings.resources,((e,t)=>{i.push(c._addResource(this,e,t))})),Promise.all(i)}static ResourceOrganizer_onDoFetch(e,r,i){let s=[];return Object.keys(this._resources).forEach((e=>{let i=this._resources[e];i.options.get("autoFetch",!0)&&(i.target.id=t.Util.safeGet(r.detail,"id",i.target.id),i.target.parameters=t.Util.safeGet(r.detail,"parameters",i.target.parameters),s.push(i.get(i.target.id,i.target.parameters).then((()=>{let t=this.settings.get("resources."+e+".autoSetProperty");t&&(this[t]=i.items)}))))})),Promise.all(s)}static ResourceOrganizer_onDoSubmit(e,r,i){let s=[],n=t.Util.safeGet(r.detail,"items");return Object.keys(this._resources).forEach((e=>{let i=this._resources[e];if(i.options.get("autoSubmit",!0)){let a=t.Util.safeGet(r.detail,"method",i.target.method||"put"),o=t.Util.safeGet(r.detail,"id",i.target.id),l=t.Util.safeGet(r.detail,"parameters",i.target.parameters);s.push(this._resources[e][a](o,n,l))}})),Promise.all(s)}static getInfo(){return{sections:"resources",order:300}}static init(e,t){Object.defineProperty(e,"resources",{get(){return this._resources}}),e.addResource=function(e,t){return c._addResource(this,e,t)},e.switchResource=function(e){return c._switchResource(this,e)},e._resources={},this._addOrganizerHandler(e,"doOrganize",c.ResourceOrganizer_onDoOrganize),this._addOrganizerHandler(e,"doFetch",c.ResourceOrganizer_onDoFetch),this._addOrganizerHandler(e,"doSubmit",c.ResourceOrganizer_onDoSubmit)}static _addResource(e,r,i){t.Util.assert(i.handlerClassName,`ResourceOrganizer._addResource(): handler class name not specified. name=${e.name}, resourceName=${r}`);let s=t.ClassUtil.createObject(i.handlerClassName,e,r,i.handlerOptions);if(e._resources[r]=s,s.options.get("autoLoad")){let t=s.options.get("autoLoadOptions.id"),i=s.options.get("autoLoadOptions.parameters");return s.get(t,i).then((()=>{let t=e.settings.get("resources."+r+".autoSetProperty");t&&(e[t]=s.items)}))}}static _switchResource(e){this._defaultResource=this._resources[e]}}class d extends t.Organizer{static get name(){return"ValidationOrganizer"}static ValidationOrganizer_onDoOrganize(e,t,r){this._enumSettings(t.detail.settings.validators,((e,t)=>{d._addValidator(this,e,t)}))}static ValidationOrganizer_onDoValidate(e,r,i){let s=r.detail.validatorName;if(s){t.Util.assert(this._validators[s],`ValidationOrganizer.organize(): Validator not found. name=${this.name}, validatorName=${s}`);let e=t.Util.safeGet(r.detail,"items"),i=this.settings.get("validators."+s+".rules"),n=this.settings.get("validators."+s+".handlerOptions");this._validators[s].checkValidity(e,i,n)}}static ValidationOrganizer_onDoReportValidity(e,r,i){let s=r.detail.validatorName;if(s){t.Util.assert(this._validators[s],`ValidationOrganizer.organize(): Validator not found. name=${this.name}, validatorName=${s}`);let e=t.Util.safeGet(r.detail.settings,"items"),i=this.settings.get("validators."+s+".rules"),n=this.settings.get("validators."+s+".handlerOptions");this._validators[s].reportValidity(e,i,n)}}static getInfo(){return{sections:["validators"],order:310}}static init(e,t){Object.defineProperty(e,"validators",{get(){return this._validators}}),Object.defineProperty(e,"validationResult",{get(){return this._validationResult}}),e.addValidator=function(...e){return d._addValidator(this,...e)},e.validate=function(...e){return d._validate(this,...e)},e._validators={},e._validationResult={},this._addOrganizerHandler(e,"doOrganize",d.ValidationOrganizer_onDoOrganize),this._addOrganizerHandler(e,"doValidate",d.ValidationOrganizer_onDoValidate),this._addOrganizerHandler(e,"doReportValidity",d.ValidationOrganizer_onDoReportValidity)}static _addValidator(e,r,i){let s;return i.handlerClassName&&(s=t.ClassUtil.createObject(i.handlerClassName,e,r,i),e._validators[r]=s),s}static _validate(e,t){return t=t||{},e._validationResult={result:!0},Promise.resolve().then((()=>e.trigger("beforeValidate",t))).then((()=>e.trigger("doValidate",t))).then((()=>e.validationResult.result?e.trigger("doValidateSuccess",t):e.trigger("doValidateFail",t))).then((()=>e.trigger("afterValidate",t))).then((()=>{if(!e._validationResult.result)return e.trigger("doReportValidity",t)}))}}class u extends t.Organizer{static get name(){return"FormOrganizer"}static FormOrganizer_onAfterTransform(e,t,r){s.hideConditionalElements(this)}static FormOrganizer_onDoClear(e,r,i){let n=t.Util.safeGet(r.detail,"target","");s.clearFields(this,n),this._items={}}static FormOrganizer_onDoFill(e,r,i){let n=r.detail&&"rootNode"in r.detail?this.querySelector(r.detail.rootNode):this,a=t.Util.safeGet(r.detail,"items",this._items);s.setFields(n,a,{masters:this.resources,triggerEvent:"change"}),s.showConditionalElements(this,a)}static getInfo(){return{sections:"forms",order:310,depends:"ValidationOrganizer"}}static init(e,t){Object.defineProperty(e,"items",{get(){return this._items},set(e){this._items=e}}),Object.defineProperty(e,"cancelSubmit",{get(){return this._cancelSubmit}}),e.build=function(...e){return u._build(this,...e)},e.submit=function(...e){return u._submit(this,...e)},e._items={},e._cancelSubmit=!1,this._addOrganizerHandler(e,"afterTransform",u.FormOrganizer_onAfterTransform),this._addOrganizerHandler(e,"doClear",u.FormOrganizer_onDoClear),this._addOrganizerHandler(e,"doFill",u.FormOrganizer_onDoFill)}static _build(e,t,r,i){s.build(t,r,i)}static _submit(e,t){return t=t||{},e._cancelSubmit=!1,Promise.resolve().then((()=>{e.settings.get("forms.settings.autoCollect",!0)&&(t.items=u.__collectData(e))})).then((()=>{if(e.settings.get("forms.settings.autoValidate",!0))return t.validatorName=e.settings.get("forms.settings.validatorName"),e.validate(t).then((()=>{e.validationResult.result||(e._cancelSubmit=!0)}))})).then((()=>e.trigger("beforeSubmit",t).then((()=>{if(!e._cancelSubmit)return Promise.resolve().then((()=>e.trigger("doSubmit",t))).then((()=>(e.items=t.items,e.trigger("afterSubmit",t))))}))))}static __collectData(e,t){let r={},i=s.getFields(e),n=e.querySelectorAll("[bm-submit]");return n=Array.prototype.slice.call(n,0),n.forEach((e=>{let t=e.getAttribute("bm-bind");r[t]=i[t]})),r}}class h extends t.Organizer{static get name(){return"ListOrganizer"}static ListOrganizer_onAfterTransform(e,r,i){return this._listRootNode=this.querySelector(this.settings.get("lists.settings.listRootNode")),t.Util.assert(this._listRootNode,`List.fill(): List root node not found. name=${this.name}, listRootNode=${this.settings.get("settings.listRootNode")}`),this.transformRow(this.settings.get("lists.settings.rowTemplateName"))}static ListOrganizer_onBeforeFill(e,t,r){this._listRootNode.innerHTML=""}static ListOrganizer_onDoFill(e,r,i){this._rowElements=[];let s=t.Util.safeGet(r.detail.options,"async",this.settings.get("settings.async",!0))?h._buildAsync:h._buildSync,n=document.createDocumentFragment(),a=t.Util.safeGet(r.detail,"items",this._rows);return Promise.resolve().then((()=>s(this,n,a))).then((()=>{this._listRootNode.appendChild(n)}))}static getInfo(){return{sections:"lists",order:310}}static init(e,t){Object.defineProperty(e,"rows",{get(){return this._rows},set(e){this._rows=e}}),e.transformRow=function(...e){return h._transformRow(this,...e)},e._rows=[],e._activeRowTemplateName="",this._addOrganizerHandler(e,"afterTransform",h.ListOrganizer_onAfterTransform),this._addOrganizerHandler(e,"beforeFill",h.ListOrganizer_onBeforeFill),this._addOrganizerHandler(e,"doFill",h.ListOrganizer_onDoFill)}static _transformRow(e,t,r){return r=r||{},e._activeRowTemplateName===t?Promise.resolve():Promise.resolve().then((()=>e.loadTemplate(t))).then((()=>{e._activeRowTemplateName=t})).then((()=>e.trigger("afterRowTransform",r))).then((()=>{}))}static _buildSync(e,r,i){t.Util.assert(e._templates[e._activeRowTemplateName],`List._buildSync(): Row template not loaded yet. name=${e.name}, rowTemplateName=${e._activeRowTemplateName}`);let s=Promise.resolve(),n=e.settings.get("rowevents"),a=e.templates[e._activeRowTemplateName].html;for(let t=0;t<i.length;t++)s=s.then((()=>h._appendRowSync(e,r,t,i[t],a,n)));return s}static _buildAsync(e,r,i){t.Util.assert(e.templates[e._activeRowTemplateName],`List._buildAsync(): Row template not loaded yet. name=${e.name}, rowTemplateName=${e._activeRowTemplateName}`);let s=e.settings.get("rowevents"),n=e.templates[e._activeRowTemplateName].html;for(let t=0;t<i.length;t++)h._appendRowAsync(e,r,t,i[t],n,s)}static _createRow(e){let t=document.createElement("tbody");t.innerHTML=e;let r=t.firstElementChild;return r.setAttribute("bm-powered",""),r}static _appendRowSync(e,t,r,i,n,a){e.triggerAsync("beforeBuildRow",{item:i});let o=Promise.resolve();o=o.then((()=>{let o=h._createRow(n);return t.appendChild(o),e._rowElements.push(o),a&&Object.keys(a).forEach((t=>{e.initEvents(t,a[t],o)})),Promise.resolve().then((()=>e.trigger("beforeFillRow",{item:i,no:r,element:o}))).then((()=>{s.showConditionalElements(o,i),s.setFields(o,i,{masters:e.resources})})).then((()=>e.trigger("afterFillRow",{item:i,no:r,element:o})))}))}static _appendRowAsync(e,t,r,i,n,a){e.triggerAsync("beforeBuildRow",{item:i});let o=h._createRow(n);t.appendChild(o),e._rowElements.push(o),a&&Object.keys(a).forEach((t=>{e.initEvents(t,a[t],o)})),e.triggerAsync("beforeFillRow",{item:i,no:r,element:o}),s.showConditionalElements(o,i),s.setFields(o,i,{masters:e.resources}),e.triggerAsync("afterFillRow",{item:i,no:r,element:o})}}class g extends t.Organizer{static get name(){return"DatabindingOrganizer"}static getInfo(){return{sections:"binds",order:320}}static init(e,t){Object.defineProperty(e,"binds",{get(){return this._binds},set(e){g.update(this,e)}}),e.bindData=function(e){return g._bindData(this,e)},e.update=function(e){return g._update(this,e)},e._binds=new n}static organize(e,t,r){switch(e){case"afterTransform":g._bindData(t);break;case"afterFetch":let e=r.bindings;e&&g.setResource(t,e)}}static setResource(e,t){let r=t.resourceName;e._binds.replace(e.resources[r].item)}static update(e,t){e._binds.items=t,g._bindData(e)}static _bindData(e,t){let r=(t=t||e).querySelectorAll("[bm-bind]");r=Array.prototype.slice.call(r,0),r.forEach((t=>{e._binds.bindTo(t)}))}}class m extends t.Organizer{static get name(){return"PluginOrganizer"}static PluginOrganizer_onDoOrganize(e,t,r){this._enumSettings(t.detail.settings.plugins,((e,t)=>{m._addPlugin(this,e,t)}))}static getInfo(){return{sections:"plugins",order:800}}static init(e,t){e._plugins={},this._addOrganizerHandler(e,"doOrganize",m.PluginOrganizer_onDoOrganize)}static _addPlugin(e,r,i){let s="className"in(i=i||{})?i.className:r,n=null;return n=t.ClassUtil.createObject(s,e,i),e._plugins[r]=n,n}}class p extends t.Organizer{static get name(){return"KeyOrganizer"}static KeyOrganizer_onAfterTransform(e,t,r){let i=this.settings.get("keys");if(i){let e=p.__getActions(i);this.addEventListener("keydown",(function(e){p.KeyOrganizer_onKeyDown.call(this,e,this)})),this.addEventListener("keyup",(function(t){p.KeyOrganizer_onKeyUp.call(this,t,this,i,e)})),this._enumSettings(this.settings.get("keys"),((e,t)=>{p.__initButtons(this,e,t)}))}}static KeyOrganizer_onKeyDown(e,t){t.__isComposing=229===e.keyCode}static KeyOrganizer_onKeyUp(e,t,r,i){if(t.__isComposing)return;let s=e.key?e.key:p.__getKeyfromKeyCode(e.keyCode);switch(s){case"Esc":s="Escape";break;case"Down":s="ArrowDown";break;case"Up":s="ArrowUp";break;case"Left":s="ArrowLeft";break;case"Right":s="ArrowRight"}s=s.toLowerCase(),i[s]&&i[s].handler.call(this,e,t,i[s].option)}static getInfo(){return{sections:"keys",order:800}}static init(e,t){e.__isComposing=!1,this._addOrganizerHandler(e,"afterTransform",p.KeyOrganizer_onAfterTransform)}static _defaultSubmit(e,t,r){return t.submit().then((()=>{t.cancelSubmit||(t.isModal&&(t.modalResult.result=!0),r&&r.autoClose&&t.close({reason:"submit"}))}))}static _defaultCancel(e,t,r){return t.close({reason:"cancel"})}static _defaultClear(e,t,r){let i;return this.hasAttribute("bm-cleartarget")&&(i=this.getAttribute("bm-cleartarget")),t.clear({target:i})}static __getKeyfromKeyCode(e){let t;if(13===e)t="Enter";else t=String.fromCharCode(e);return t}static __initButtons(e,t,r){if(r&&r.rootNode){let i=r.handler?r.handler:p.__getDefaultHandler(t),s=e.querySelectorAll(r.rootNode);s=Array.prototype.slice.call(s,0),s.forEach((t=>{t.addEventListener("click",(function(t){i.call(this,t,e,r)}))}))}}static __getActions(e){let t={};return Object.keys(e).forEach((r=>{let i=Array.isArray(e[r].key)?e[r].key:[e[r].key];for(let s=0;s<i.length;s++)t[i[s]]={},t[i[s]].type=r,t[i[s]].handler=e[r].handler?e[r].handler:p.__getDefaultHandler(r),t[i[s]].option=e[r]})),t}static __getDefaultHandler(e){let t;switch(e){case"submit":t=p._defaultSubmit;break;case"clear":t=p._defaultClear;break;case"cancel":t=p._defaultCancel}return t}}class _ extends t.Organizer{static get name(){return"ChainOrganizer"}static onDoOrganize(e,t,r){let i=_.getInfo().order;this._enumSettings(t.detail.settings.chains,((e,t)=>{this.addEventHandler(e,{handler:_.onDoProcess,order:i,options:t})}))}static onDoProcess(e,r,i){let s=i.options,n=[],a=Promise.resolve();for(let e=0;e<s.length;e++){let i=s[e].method||"refresh",o=s[e].state||"ready",l=s[e].sync,c=document.querySelectorAll(s[e].rootNode);c=Array.prototype.slice.call(c,0),t.Util.assert(c.length>0,`ChainOrganizer.onDoOrganizer(): Node not found. name=${this.name}, eventName=${r.type}, rootNode=${s[e].rootNode}, method=${i}`),a=l?a.then((()=>_.__execTarget(this,c,i,o))):_.__execTarget(this,c,i,o),n.push(a)}return Promise.all(n)}static getInfo(){return{sections:"chains",order:800}}static init(e,t){this._addOrganizerHandler(e,"doOrganize",_.onDoOrganize)}static deinit(t,r){let i=e.details.setting.chains;i&&Object.keys(i).forEach((e=>{t.removeEventHandler(e,{handler:_.onDoOrganize,options:i[e]})}))}static __execTarget(e,t,r,i){let s=[];return t.forEach((t=>{let n=e.waitFor([{object:t,state:i}]).then((()=>t[r]({sender:e})));s.push(n)})),Promise.all(s)}}class f extends t.Organizer{static get name(){return"DialogOrganizer"}static DialogOrganizer_onAfterReady(e,t,r){if(this.settings.get("dialogs.settings.autoOpen"))return this.open()}static getInfo(){return{sections:"dialogs",order:800}}static init(e,t){Object.defineProperty(e,"modalResult",{get(){return this._modalResult}}),Object.defineProperty(e,"isModal",{get(){return this._isModal}}),e.open=function(e){return f._open(this,e)},e.openModal=function(e){return f._openModal(this,e)},e.close=function(e){return f._close(this,e)},e._isModal=!1,e._cancelClose,e._cancelOpen,e._modalResult,e._modalPromise,this._addOrganizerHandler(e,"afterReady",f.DialogOrganizer_onAfterReady),e.settings.set("settings.autoRefresh",!1),e.settings.set("settings.autoRefreshOnOpen",!0),e.settings.set("settings.autoSetup",!1),e.settings.set("settings.autoSetupOnOpen",!0)}static _open(e,r){return r=r||{},e.trigger("beforeOpen",r).then((()=>{if(!e._cancelOpen)return Promise.resolve().then((()=>{if(e.settings.get("dialogs.backdropOptions.show"))return f.__showBackdrop(e,e.settings.get("dialogs.backdropOptions"))})).then((()=>{if(t.Util.safeGet(r,"autoSetupOnOpen",e.settings.get("settings.autoSetupOnOpen")))return e.setup(r)})).then((()=>{if(t.Util.safeGet(r,"autoRefreshOnOpen",e.settings.get("settings.autoRefreshOnOpen")))return e.refresh(r)})).then((()=>e.trigger("doOpen",r))).then((()=>e.trigger("afterOpen",r)))}))}static _openModal(e,t){return new Promise(((r,i)=>(e._isModal=!0,e._modalResult={result:!1},e._modalPromise={resolve:r,reject:i},f._open(e,t))))}static _close(e,t){return t=t||{},e._cancelClose=!1,e.trigger("beforeClose",t).then((()=>{if(!e._cancelClose)return e.trigger("doClose",t).then((()=>{if(e.settings.get("dialogs.backdropOptions.show"))return f.__hideBackdrop(e,e.settings.get("dialogs.backdropOptions"))})).then((()=>(e._isModal&&e._modalPromise.resolve(e._modalResult),e.trigger("afterClose",t))))}))}static __createBackdrop(e,t){f._backdrop||(document.body.insertAdjacentHTML("afterbegin",'<div class="backdrop"></div>'),f._backdrop=document.body.firstElementChild)}static __showBackdrop(e,r){f.__createBackdrop(e);let i=new Promise(((i,s)=>{window.getComputedStyle(f._backdrop).getPropertyValue("visibility");let n=["show"].concat(e.settings.get("dialogs.backdropOptions.showOptions.addClasses",[]));f._backdrop.classList.add(...n),f._backdrop.classList.remove(...e.settings.get("dialogs.backdropOptions.showOptions.removeClasses",[]));let a=f.__getEffect();a?f._backdrop.addEventListener(a+"end",(()=>{t.Util.safeGet(r,"closeOnClick",!0)&&f.__closeOnClick(e),i()}),{once:!0}):(t.Util.safeGet(r,"closeOnClick",!0)&&f.__closeOnClick(e),i())}));if(t.Util.safeGet(r,"showOptions.sync",t.Util.safeGet(r,"sync")))return i}static __hideBackdrop(e,r){let i=new Promise(((t,r)=>{window.getComputedStyle(f._backdrop).getPropertyValue("visibility");let i=["show"].concat(e.settings.get("dialogs.backdropOptions.hideOptions.removeClasses",[]));f._backdrop.classList.remove(...i),f._backdrop.classList.add(...e.settings.get("dialogs.backdropOptions.hideOptions.addClasses",[]));let s=f.__getEffect();s?f._backdrop.addEventListener(s+"end",(()=>{t()}),{once:!0}):t()}));if(t.Util.safeGet(r,"hideOptions.sync",t.Util.safeGet(r,"sync")))return i}static __closeOnClick(e,t){f._backdrop.addEventListener("click",(t=>{t.target===t.currentTarget&&e.close({reason:"cancel"})}),{once:!0})}static __getEffect(){let e="";return"0s"!==window.getComputedStyle(f._backdrop).getPropertyValue("transition-duration")?e="transition":"none"!==window.getComputedStyle(f._backdrop).getPropertyValue("animation-name")&&(e="animation"),e}}class y extends t.Organizer{static get name(){return"PreferenceOrganizer"}static PreferenceOrganizer_onDoOrganize(e,t,r){return this.waitFor([{rootNode:"bm-preference"}]).then((()=>{document.querySelector("bm-preference").subscribe(this,this.settings.get("preferences"))}))}static getInfo(){return{sections:"preferences",order:900}}static init(e,t){this._addOrganizerHandler(e,"doOrganize",y.PreferenceOrganizer_onDoOrganize)}}function b(e,t){void 0===t&&(t={});for(var r=function(e){for(var t=[],r=0;r<e.length;){var i=e[r];if("*"!==i&&"+"!==i&&"?"!==i)if("\\"!==i)if("{"!==i)if("}"!==i)if(":"!==i)if("("!==i)t.push({type:"CHAR",index:r,value:e[r++]});else{var s=1,n="";if("?"===e[o=r+1])throw new TypeError('Pattern cannot start with "?" at '.concat(o));for(;o<e.length;)if("\\"!==e[o]){if(")"===e[o]){if(0==--s){o++;break}}else if("("===e[o]&&(s++,"?"!==e[o+1]))throw new TypeError("Capturing groups are not allowed at ".concat(o));n+=e[o++]}else n+=e[o++]+e[o++];if(s)throw new TypeError("Unbalanced pattern at ".concat(r));if(!n)throw new TypeError("Missing pattern at ".concat(r));t.push({type:"PATTERN",index:r,value:n}),r=o}else{for(var a="",o=r+1;o<e.length;){var l=e.charCodeAt(o);if(!(l>=48&&l<=57||l>=65&&l<=90||l>=97&&l<=122||95===l))break;a+=e[o++]}if(!a)throw new TypeError("Missing parameter name at ".concat(r));t.push({type:"NAME",index:r,value:a}),r=o}else t.push({type:"CLOSE",index:r,value:e[r++]});else t.push({type:"OPEN",index:r,value:e[r++]});else t.push({type:"ESCAPED_CHAR",index:r++,value:e[r++]});else t.push({type:"MODIFIER",index:r,value:e[r++]})}return t.push({type:"END",index:r,value:""}),t}(e),i=t.prefixes,s=void 0===i?"./":i,n="[^".concat(v(t.delimiter||"/#?"),"]+?"),a=[],o=0,l=0,c="",d=function(e){if(l<r.length&&r[l].type===e)return r[l++].value},u=function(e){var t=d(e);if(void 0!==t)return t;var i=r[l],s=i.type,n=i.index;throw new TypeError("Unexpected ".concat(s," at ").concat(n,", expected ").concat(e))},h=function(){for(var e,t="";e=d("CHAR")||d("ESCAPED_CHAR");)t+=e;return t};l<r.length;){var g=d("CHAR"),m=d("NAME"),p=d("PATTERN");if(m||p){var _=g||"";-1===s.indexOf(_)&&(c+=_,_=""),c&&(a.push(c),c=""),a.push({name:m||o++,prefix:_,suffix:"",pattern:p||n,modifier:d("MODIFIER")||""})}else{var f=g||d("ESCAPED_CHAR");if(f)c+=f;else if(c&&(a.push(c),c=""),d("OPEN")){_=h();var y=d("NAME")||"",b=d("PATTERN")||"",O=h();u("CLOSE"),a.push({name:y||(b?o++:""),pattern:y&&!b?n:b,prefix:_,suffix:O,modifier:d("MODIFIER")||""})}else u("END")}}return a}function v(e){return e.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function O(e){return e&&e.sensitive?"":"i"}function w(e,t,r){return function(e,t,r){void 0===r&&(r={});for(var i=r.strict,s=void 0!==i&&i,n=r.start,a=void 0===n||n,o=r.end,l=void 0===o||o,c=r.encode,d=void 0===c?function(e){return e}:c,u=r.delimiter,h=void 0===u?"/#?":u,g=r.endsWith,m="[".concat(v(void 0===g?"":g),"]|$"),p="[".concat(v(h),"]"),_=a?"^":"",f=0,y=e;f<y.length;f++){var b=y[f];if("string"==typeof b)_+=v(d(b));else{var w=v(d(b.prefix)),S=v(d(b.suffix));if(b.pattern)if(t&&t.push(b),w||S)if("+"===b.modifier||"*"===b.modifier){var R="*"===b.modifier?"?":"";_+="(?:".concat(w,"((?:").concat(b.pattern,")(?:").concat(S).concat(w,"(?:").concat(b.pattern,"))*)").concat(S,")").concat(R)}else _+="(?:".concat(w,"(").concat(b.pattern,")").concat(S,")").concat(b.modifier);else"+"===b.modifier||"*"===b.modifier?_+="((?:".concat(b.pattern,")").concat(b.modifier,")"):_+="(".concat(b.pattern,")").concat(b.modifier);else _+="(?:".concat(w).concat(S,")").concat(b.modifier)}}if(l)s||(_+="".concat(p,"?")),_+=r.endsWith?"(?=".concat(m,")"):"$";else{var E=e[e.length-1],C="string"==typeof E?p.indexOf(E[E.length-1])>-1:void 0===E;s||(_+="(?:".concat(p,"(?=").concat(m,"))?")),C||(_+="(?=".concat(p,"|").concat(m,")"))}return new RegExp(_,O(r))}(b(e,r),t,r)}function S(e,t,r){return e instanceof RegExp?function(e,t){if(!t)return e;for(var r=/\((?:\?<(.*?)>)?(?!\?)/g,i=0,s=r.exec(e.source);s;)t.push({name:s[1]||i++,prefix:"",suffix:"",modifier:"",pattern:""}),s=r.exec(e.source);return e}(e,t):Array.isArray(e)?function(e,t,r){var i=e.map((function(e){return S(e,t,r).source}));return new RegExp("(?:".concat(i.join("|"),")"),O(r))}(e,t,r):w(e,t,r)}class R extends t.Organizer{static get name(){return"RouteOrganizer"}static RouteOrganizer_onDoOrganize(e,t,r){this._enumSettings(t.detail.settings.routings,((e,t)=>{R._addRoute(this,t)})),this._routeInfo=R.__loadRouteInfo(this,window.location.href),this._enumSettings(t.detail.settings.specs,((e,t)=>{this._specs[e]=t}))}static RouteOrganizer_onDoStart(e,t,r){if(this.routeInfo.specName){let e={query:this.settings.get("settings.query")};return this.switchSpec(this.routeInfo.specName,e)}}static RouteOrganizer_onAfterReady(e,t,r){return this.openRoute()}static RouteOrganizer_onDoValidateFail(e,t,r){this.settings.get("routings.settings.autoFix")&&R.__fixRoute(this,t.detail.url)}static RouteOrganizer_onAfterValidate(e,t,r){if(!this.validationResult.result)throw R.__dumpValidationErrors(this),new URIError("URL validation failed.")}static getInfo(){return{sections:["routings","specs"],order:900,depends:"ValidationOrganizer"}}static globalInit(){history.replaceState(R.__getState("connect"),null,null)}static init(e,r){Object.defineProperty(e,"routeInfo",{get(){return this._routeInfo}}),Object.defineProperty(e,"specs",{get(){return this._specs}}),Object.defineProperty(e,"spec",{get(){return this._spec}}),e.loadParameters=function(e){return R._loadParameters(e)},e.switchSpec=function(e,t){return R._switchSpec(this,e,t)},e.openRoute=function(e,t){return R._open(this,e,t)},e.jumpRoute=function(e,t){return R._jumpRoute(this,e,t)},e.updateRoute=function(e,t){return R._updateRoute(this,e,t)},e.refreshRoute=function(e,t){return R._refreshRoute(this,e,t)},e.replaceRoute=function(e,t){return R._replaceRoute(this,e,t)},e.normalizeRoute=function(){return R._normalizeRoute(this)},e._routes=[],e._specs={},e._spec=new t.ChainableStore({chain:e.settings,writeThrough:!0}),Object.defineProperty(e,"settings",{get(){return this._spec}}),this._addOrganizerHandler(e,"doOrganize",R.RouteOrganizer_onDoOrganize),this._addOrganizerHandler(e,"doStart",R.RouteOrganizer_onDoStart),this._addOrganizerHandler(e,"afterReady",R.RouteOrganizer_onAfterReady),this._addOrganizerHandler(e,"doValidateFail",R.RouteOrganizer_onDoValidateFail),this._addOrganizerHandler(e,"afterValidate",R.RouteOrganizer_onAfterValidate),R._loadAttrSettings(e),R.__initPopState(e)}static _addRoute(e,t,r){let i=[],s={origin:t.origin,name:t.name,path:t.path,keys:i,specName:t.specName,componentName:t.componentName,re:S(t.path,i)};r?e._routes.unshift(s):e._routes.push(s)}static _buildUrl(e,t,r){let i="";if(i+=t.url?t.url:"",i+=t.path?t.path:"",i+=t.query?"?"+t.query:"",t.queryParameters){let s={};r&&r.mergeParameters&&(s=Object.assign(s,e.routeInfo.queryParameters)),s=Object.assign(s,t.queryParameters),i+=R._buildUrlQuery(s)}return i||"/"}static _buildUrlQuery(e){let t="";return e&&(t=Object.keys(e).reduce(((t,r)=>(Array.isArray(e[r])?t+=encodeURIComponent(r)+"="+encodeURIComponent(e[r].join())+"&":e[r]&&(t+=encodeURIComponent(r)+"="+encodeURIComponent(e[r])+"&"),t)),"")),t?"?"+t.slice(0,-1):""}static _loadParameters(e){e=e||window.location.href;let t,r,i={};if(window.location.href.indexOf("?")>-1){let s=e.slice(e.indexOf("?")+1).split("&");for(let e=0;e<s.length;e++)t=s[e].split("="),r=t[1]?t[1].split("#")[0]:t[1],i[t[0]]=decodeURIComponent(r)}return i}static _switchSpec(e,r,i){return t.Util.assert(r,"RouteOrganizer._switchSpec(): A spec name not specified.",TypeError),Promise.resolve().then((()=>{if(!e._specs[r])return R._loadSpec(e,r,i).then((t=>{e._specs[r]=t}))})).then((()=>{e._spec.items=e._specs[r]})).then((()=>{if(e.settings.get("settings.hasExtender"))return R._loadExtender(e,r,i)})).then((()=>e.attachOrganizers({settings:e._specs[e._routeInfo.specName]}))).then((()=>e.trigger("doOrganize",{settings:e._specs[e._routeInfo.specName]}))).then((()=>e.trigger("afterLoadSettings",{settings:e._specs[e._routeInfo.specName]})))}static _open(e,r,i){i=Object.assign({},i);let s,n,a=t.Util.safeGet(i,"pushState",!!r),o=e._routeInfo;if(r?(s=R._buildUrl(e,r,i),n=R.__loadRouteInfo(e,s)):(s=window.location.href,n=o),!i.jump&&n.name&&o.specName==n.specName)return Promise.resolve().then((()=>{a&&history.pushState(R.__getState("_open.pushState"),null,s),e._routeInfo=n})).then((()=>{if(o.specName!=n.specName)return R._updateRoute(e,o,n,i)})).then((()=>{if(e.settings.get("routings.settings.autoValidate")){let t={validatorName:e.settings.get("routings.settings.validatorName"),items:R._loadParameters(s),url:s};return e.validate(t)}})).then((()=>R._refreshRoute(e,n,i))).then((()=>R._normalizeRoute(e,window.location.href)));R._jumpRoute(e,{url:s})}static _jumpRoute(e,t,r){let i=R._buildUrl(e,t,r);window.location.href=i}static _updateRoute(e,t,r,i){return R._switchSpec(e,r.specName)}static _refreshRoute(e,t,r){return e.refresh(r)}static _replaceRoute(e,t,r){history.replaceState(R.__getState("replaceRoute",window.history.state),null,R._buildUrl(e,t,r)),e._routeInfo=R.__loadRouteInfo(e,window.location.href)}static _normalizeRoute(e,t){return Promise.resolve().then((()=>e.trigger("beforeNormalizeURL"))).then((()=>e.trigger("doNormalizeURL"))).then((()=>e.trigger("afterNormalizeURL")))}static _loadAttrSettings(e){let t=e.getAttribute("bm-specpath");t&&e.settings.set("system.specPath",t)}static _loadSpec(e,r,i){let s,n=[],a=t.Util.safeGet(i,"path",t.Util.concatPath([e.settings.get("system.appBaseUrl",""),e.settings.get("system.specPath","")])),o=t.Util.deepMerge({type:"js",bindTo:this},i);return n.push(t.SettingOrganizer.loadFile(r,a,o)),Promise.all(n).then((e=>(s=e[0],s)))}static _loadExtender(e,r,i){let s=t.Util.safeGet(i,"query"),n=t.Util.safeGet(i,"path",t.Util.concatPath([e.settings.get("system.appBaseUrl",""),e.settings.get("system.specPath","")]))+r+".extender.js"+(s?"?"+s:"");return t.AjaxUtil.loadScript(n)}static __loadRouteInfo(e,t){let r,i,s={},n=new URL(t,window.location.href),a={};for(let t=e._routes.length-1;t>=0;t--){if(e._routes[t].origin&&n.origin!=e._routes[t].origin)continue;let s=e._routes[t].path?e._routes[t].re.exec(n.pathname):[];if(s){r=e._routes[t].name,i=e._routes[t].specName?e._routes[t].specName:"";for(let r=0;r<s.length-1;r++){a[e._routes[t].keys[r].name]=s[r+1];let n=e._routes[t].keys[r].name,o=s[r+1];i=i.replace("{{:"+n+"}}",o)}break}}return s.name=r,s.specName=i,s.url=n.href,s.path=n.pathname,s.query=n.search,s.parsedUrl=n,s.routeParameters=a,s.queryParameters=R._loadParameters(t),s}static __initPopState(e){window.addEventListener("popstate",(t=>Promise.resolve().then((()=>e.trigger("beforePopState"))).then((()=>R._open(e,{url:window.location.href},{pushState:!1}))).then((()=>e.trigger("afterPopState")))))}static __getState(e,r){let i={msg:e};return r&&(i=t.Util.deepMerge(t.Util.deepClone(r),i)),i}static __fixRoute(e,t){let r=!0,i=R._loadParameters(t);Object.keys(e.validationResult.invalids).forEach((t=>{let s=e.validationResult.invalids[t];void 0!==s.fix?i[s.key]=s.fix:"notAllowed"===s.failed[0].validity?delete i[s.key]:r=!1})),r&&(R._replaceRoute(e,{queryParameters:i}),e.validationResult.result=!0)}static __dumpValidationErrors(e){Object.keys(e.validationResult.invalids).forEach((t=>{let r=e.validationResult.invalids[t];if(r.failed)for(let e=0;e<r.failed.length;e++);}))}}class E{constructor(e,r,i){i=i||{},this._resourceName=r,this._component=e,this._options=new t.Store({items:i}),this._data={},this._items=[],this._name="ResourceHandler",this._target={},this._currentIndex=0}get name(){return this._name}set name(e){this._name=e}get resourceName(){return this._resourceName}set resourceName(e){this._resourceName=e}get target(){return this._target}get data(){return this._data}set data(e){this._data=e,this._items=this.__reshapeItems(e)}get items(){return this._items}get options(){return this._options}get(e,t){return Promise.resolve().then((()=>this._get(e,t))).then((e=>(this.data=e,this._data)))}delete(e,t){return Promise.resolve().then((()=>this._delete(e,t)))}post(e,t,r){return t=this.__reshapeData(t),Promise.resolve().then((()=>this._post(e,t,r)))}put(e,t,r){return t=this.__reshapeData(t),Promise.resolve().then((()=>this._put(e,t,r)))}getText(e){let t=e,r=this._options.get("fieldOptions.text");return this._items&&e in this._items&&(t=this._items[e][r]),t}getItem(e){let t;return this._items&&e in this._items&&(t=this._items[e]),t}_get(e,t){}_delete(e,t){}_post(e,t,r){}_put(e,t,r){}__reshapeItems(e){let r=this._options.get("fieldOptions.items"),i=r?t.Util.safeGet(e,r):e;if(this._options.get("reshapeOptions.get.reshape")){i=this._options.get("reshapeOptions.get.reshaper",this.__reshaper_get.bind(this))(i)}return i}__reshapeData(e){if(this._options.get("reshapeOptions.put.reshape")){let t=this._options.get("reshapeOptions.put.reshaper",(()=>e));e=t(e)}return e}__reshaper_get(e){let t;if(e){let r=this._options.get("fieldOptions.id");t=e.reduce(((e,t)=>(e[t[r]]=t,e)),{})}return t}}class C{constructor(e,r,i){i=i||{},this._name=r,this._component=e,this._options=new t.Store({items:i})}get name(){return this._name}set name(e){this._name=e}get options(){return this._options}static createValidationResult(e,t,r,i,s){return{key:e,value:t,message:C._getFunctionValue(e,t,"message",r),fix:C._getFunctionValue(e,t,"fix",r),failed:i,extras:s}}static validate(e,t,r){t=t||{};let i={};return(r=r||{}).allowList&&Object.keys(e).forEach((s=>{if(-1===r.allowList.indexOf(s)){let r=[{rule:"allowList",validity:"notAllowed"}];i[s]=C.createValidationResult(s,e[s],t[s],r)}})),r.allowOnlyInRules&&Object.keys(e).forEach((r=>{if(!(r in t)){let s=[{rule:"allowList",validity:"notAllowed"}];i[r]=C.createValidationResult(r,e[r],t[r],s)}})),r.disallowList&&Object.keys(e).forEach((s=>{if(r.disallowList.indexOf(s)>-1){let r=[{rule:"disallowList",validity:"disallowed"}];i[s]=C.createValidationResult(s,e[s],t[s],r)}})),Object.keys(t).forEach((r=>{if("constraints"in t[r]&&t[r].constraints&&"required"in t[r].constraints&&t[r].constraints.required&&!(r in e)){let s=[{rule:"required",validity:"valueMissing"}];i[r]=C.createValidationResult(r,e[r],t[r],s)}})),i}checkValidity(e,t,r){}reportValidity(e,t){}static _getFunctionValue(e,t,r,i){let s;return i&&r in i&&(s="function"==typeof i[r]?i[r](e,t,i):i[r]),s}}class k extends C{static validate(e,r){let i={};return t.Util.assert(e,"FormValidationHandler.checkValidity(): Form tag does not exist.",TypeError),t.Util.assert(e.checkValidity,"FormValidationHandler.checkValidity(): check validity not supported.",TypeError),t.Util.scopedSelectorAll(e,"input:not([novalidate])").forEach((e=>{let t=e.getAttribute("bm-bind"),n=s.getValue(e),a=r&&r[t]?r[t]:null,o=k._validateValue(e,t,n,a);o.length>0&&(i[t]=C.createValidationResult(t,n,a,o,{element:e}),i.message=i.message||e.validationMessage)})),i}checkValidity(e,r,i){let n,a={},o=this._component.querySelector("form");if(r||i){let e=s.getFields(o);a=C.validate(e,r,i)}n=k.validate(o,r);let l=t.Util.deepMerge(a,n);this._component.validationResult.result=!(Object.keys(l).length>0),this._component.validationResult.invalids=l}reportValidity(e,r){let i=this._component.querySelector("form");t.Util.assert(i,"FormValidationHandler.reportValidity(): Form tag does not exist.",TypeError),t.Util.assert(i.reportValidity,"FormValidationHandler.reportValidity(): Report validity not supported.",TypeError),i.reportValidity()}static _validateValue(e,t,r,i){let s=[],n=e.validity;if(!n.valid)for(const e in n)"valid"!==e&&n[e]&&s.push({validity:e});return s}}class z extends C{static validate(e,t){let r={};return t&&Object.keys(e).forEach((i=>{if(t[i]){let s=z._validateValue(i,e[i],t[i]);s.length>0&&(r[i]=C.createValidationResult(i,e[i],t[i],s))}})),r}checkValidity(e,r,i){let s=C.validate(e,r,i),n=z.validate(e,r),a=t.Util.deepMerge(s,n);this._component.validationResult.result=!(Object.keys(a).length>0),this._component.validationResult.invalids=a}reportValidity(e,t){}static _validateValue(e,t,r){let i=[];return r&&r.constraints&&Object.keys(r.constraints).forEach((s=>{let n=z._checkConstraint(e,t,s,r.constraints[s]);n&&i.push(n)})),i}static _checkConstraint(e,t,r,i){let s,n,a;switch(r){case"type":s=z._checkType(e,t,r,i);break;case"required":t||(s={rule:"required",validity:"valueMissing"});break;case"minlength":n=String(t).length,n<i&&(s={rule:"minlength",validity:"tooShort(min:"+i+")"});break;case"maxlength":n=String(t).length,n>i&&(s={rule:"maxlength",validity:"tooLong(max:"+i+")"});break;case"min":a=parseInt(t),a<i&&(s={rule:"min",validity:"rangeUnderflow(min:"+i+")"});break;case"max":a=parseInt(t),a>i&&(s={rule:"max",validity:"rangeOverflow(max:"+i+")"});break;case"pattern":new RegExp(i).test(t)||(s={rule:"pattern",validity:"patternMismatch(pattern:"+i+")"});break;case"valids":-1===i.indexOf(t)&&(s={rule:"valids",validity:"validsMismatch"});break;case"custom":i(e,t,i)||(s={rule:"custom",validity:"customMismatch"})}return s}static _checkType(e,t,r,i){let s;if(t)switch(i){case"object":"object"!=typeof t&&(s={rule:"type",validity:"typeMismatch(object)"});break;case"function":"function"!=typeof t&&(s={rule:"type",validity:"typeMismatch(function)"});break;case"string":"string"!=typeof t&&(s={rule:"type",validity:"typeMismatch(string)"});break;case"number":let e=parseInt(t);isNaN(e)&&(s={rule:"type",validity:"typeMismatch(number)"})}return s}}function x(e){return Reflect.construct(t.Component,[e],this.constructor)}function A(e){return Reflect.construct(t.Component,[e],this.constructor)}function I(e){return Reflect.construct(t.Component,[e],this.constructor)}function U(){return Reflect.construct(HTMLElement,[],this.constructor)}function N(){return Reflect.construct(HTMLElement,[],this.constructor)}function T(e){return Reflect.construct(t.Component,[e],this.constructor)}t.ClassUtil.inherit(x,t.Component),x.prototype._getSettings=function(){return{settings:{name:"ChainedSelect",autoClear:!0,autoSubmit:!0,useDefaultInput:!0,rootNodes:{newitem:".btn-newitem",removeitem:".btn-removeitem",edititem:".btn-edititem",select:"select"}},events:{this:{handlers:{beforeStart:["ChainedSelect_onBeforeStart"],afterTransform:["ChainedSelect_onAfterTransform"],doClear:["ChainedSelect_onDoClear"],doFill:["ChainedSelect_onDoFill"]}},"cmb-item":{rootNode:"select",handlers:{change:["ChainedSelect_onCmbItemChange"]}},"btn-newitem":{rootNode:".btn-newitem",handlers:{click:["ChainedSelect_onBtnNewItemClick"]}},"btn-edititem":{rootNode:".btn-edititem",handlers:{click:["ChainedSelect_onBtnEditItemClick"]}},"btn-removeitem":{rootNode:".btn-removeitem",handlers:{click:["ChainedSelect_onBtnRemoveItemClick"]}}},validators:{}}},Object.defineProperty(x.prototype,"items",{get(){let e=0,t=1;for(;this.querySelector(":scope .item[data-level='"+t+"'] select");)t++,e++;return e}}),x.prototype.ChainedSelect_onBeforeStart=function(e,t,r){this.rootNodes=this.settings.get("settings.rootNodes"),this.settings.get("settings.useDefaultInput",!0)&&(this.addEventHandler("beforeAdd","ChainedSelect_onBeforeAdd"),this.addEventHandler("doAdd","ChainedSelect_onDoAdd"),this.addEventHandler("beforeEdit","ChainedSelect_onBeforeEdit"),this.addEventHandler("doEdit","ChainedSelect_onDoEdit"),this.addEventHandler("beforeRemove","ChainedSelect_onBeforeRemove"),this.addEventHandler("doRemove","ChainedSelect_onDoRemove"))},x.prototype.ChainedSelect_onAfterTransform=function(e,t,r){this.clear({fromLevel:1,toLevel:this.length}),this.settings.get("settings.isAddable",!0)||this.querySelectorAll(":scope "+this.rootNodes.newitem).forEach((e=>{e.style.display="none"})),this.settings.get("settings.isEditable",!0)||this.querySelectorAll(":scope "+this.rootNodes.edititem).forEach((e=>{e.style.display="none"})),this.settings.get("settings.isRemovable",!0)||this.querySelectorAll(":scope "+this.rootNodes.removeitem).forEach((e=>{e.style.display="none"}))},x.prototype.ChainedSelect_onDoClear=function(e,r,i){let s=t.Util.safeGet(r.detail,"fromLevel",1),n=t.Util.safeGet(r.detail,"toLevel",this.length);for(let e=s;e<=n;e++)this.settings.get("settings.autoClear")&&(this.querySelector(":scope .item[data-level='"+e+"'] "+this.rootNodes.select).options.length=0),this.querySelector(":scope .item[data-level='"+e+"'] "+this.rootNodes.select).selectedIndex=-1,this._initElement("select",e),this._initElement("newitem",e),this._initElement("edititem",e),this._initElement("removeitem",e)},x.prototype.ChainedSelect_onDoFill=function(e,r,i){let s=t.Util.safeGet(r.detail,"level",1);this.assignItems(s,this.items)},x.prototype.ChainedSelect_onCmbItemChange=function(e,t,r){return this.selectItem(e.parentNode.getAttribute("data-level"),e.value)},x.prototype.ChainedSelect_onBtnNewItemClick=function(e,t,r){if(e.classList.contains("disabled"))return;let i=e.parentNode.getAttribute("data-level");this.modalResult={result:!1};let s={level:i,validatorName:""};return this.trigger("beforeAdd",s).then((()=>{if(this.modalResult.result)return this.validate(s).then((()=>{if(this.validationResult.result)return Promise.resolve().then((()=>this.trigger("doAdd",s))).then((()=>this.trigger("afterAdd",s))).then((()=>{if(this.settings.get("settings.autoSubmit",!0))return this.submit(s)}))}))}))},x.prototype.ChainedSelect_onBtnEditItemClick=function(e,t,r){if(e.classList.contains("disabled"))return;let i=e.parentNode.getAttribute("data-level");this.modalResult={result:!1};let s={level:i,validatorName:""};return this.trigger("beforeEdit",s).then((()=>{if(this.modalResult.result)return this.validate(s).then((()=>{if(this.validationResult.result)return Promise.resolve().then((()=>this.trigger("doEdit",s))).then((()=>this.trigger("afterEdit",s))).then((()=>{if(this.settings.get("settings.autoSubmit",!0))return this.submit(s)}))}))}))},x.prototype.onChainedSelect_onBtnRemoveItemClick=function(e,t,r){if(e.classList.contains("disabled"))return;let i=e.parentNode.getAttribute("data-level");this.modalResult={result:!1};let s={level:i,validatorName:""};return this.trigger("beforeRemove",s).then((()=>{if(this.modalResult.result)return this.validate(s).then((()=>{if(this.validationResult.result)return Promise.resolve().then((()=>this.trigger("doRemove",s))).then((()=>this.trigger("afterRemove",s))).then((()=>{if(this.settings.get("settings.autoSubmit",!0))return this.submit(s)}))}))}))},x.prototype.ChainedSelect_onBeforeAdd=function(e,t,r){return new Promise(((e,t)=>{let r=window.prompt("アイテム名を入力してください","");r&&(this.modalResult.text=r,this.modalResult.value=r,this.modalResult.result=!0),e()}))},x.prototype.ChainedSelect_onDoAdd=function(e,t,r){return this.newItem(t.detail.level,this.modalResult.text,this.modalResult.value)},x.prototype.ChainedSelect_onBeforeEdit=function(e,r,i){let s=parseInt(t.Util.safeGet(r.detail,"level",1)),n=this.getSelect(s);return new Promise(((e,t)=>{let r=window.prompt("アイテム名を入力してください","");r&&(this.modalResult.old={text:n.options[n.selectedIndex].text,value:n.value},this.modalResult.new={text:r,value:r},this.modalResult.result=!0),e()}))},x.prototype.ChainedSelect_onDoEdit=function(e,t,r){this.editItem(t.detail.level,this.modalResult.new.text,this.modalResult.new.value)},x.prototype.ChainedSelect_onBeforeRemove=function(e,r,i){return new Promise(((e,i)=>{if(window.confirm("削除しますか？")){let e=parseInt(t.Util.safeGet(r.detail,"level",1)),i=this.getSelect(e);this.modalResult.text=i.options[i.selectedIndex].text,this.modalResult.value=i.value,this.modalResult.result=!0}e()}))},x.prototype.ChainedSelect_onDoRemove=function(e,t,r){return this.removeItem(t.detail.level)},x.prototype.getSelect=function(e){return this.querySelector(":scope [data-level='"+e+"'] "+this.rootNodes.select)},x.prototype.assignItems=function(e,r){let i=this.querySelector(":scope [data-level='"+e+"'] > select");if(t.Util.assert(i,`ChainedSelect.editItem(): select not found. name=${this.name}, level=${e}`),r=r||{},Array.isArray(r))for(let e=0;e<r.length;e++){let s=document.createElement("option");r[e];{s.value=t.Util.safeGet(r[e],"value",r[e]),s.text=t.Util.safeGet(r[e],"text",r[e]);let i=t.Util.safeGet(r[e],"css");i&&Object.keys(i).forEach((e=>{s.css[e]=i[e]}))}i.add(s)}else Object.keys(r).forEach((e=>{let s=document.createElement("option");s.value=t.Util.safeGet(r[e],"value",e),s.text=t.Util.safeGet(r[e],"text",e);let n=t.Util.safeGet(r[e],"css");n&&Object.keys(n).forEach((e=>{s.css[e]=n[e]})),i.add(s)}));i.value="",this._initElement("select",e,!0),this._initElement("newitem",e,!0)},x.prototype.selectItem=function(e,r){let i=this.querySelector(":scope .item[data-level='"+e+"'] select");return t.Util.assert(i,`ChainedSelect.editItem(): select not found. name=${this.name}, level=${e}`),i.value=r,this._initElement("edititem",e,!0),this._initElement("removeitem",e,!0),this.clear({fromLevel:parseInt(e)+1,toLevel:this.length}),Promise.resolve().then((()=>{if(e++,this.querySelector(":scope .item[data-level='"+e+"'] select"))return this._initElement("newitem",e),this.refresh({level:e,value:r})}))},x.prototype.newItem=function(e,r,i){let s=this.querySelector(":scope .item[data-level='"+e+"'] select");t.Util.assert(s,`ChainedSelect.editItem(): select not found. name=${this.name}, level=${e}`);let n=s.selectedIndex,a=document.createElement("option");a.value=i||r,a.text=r,s.add(a),s.selectedIndex=n},x.prototype.editItem=function(e,r,i){let s=this.querySelector(":scope .item[data-level='"+e+"'] select");t.Util.assert(s,`ChainedSelect.editItem(): select not found. name=${this.name}, level=${e}`),s.options[s.selectedIndex].text=r,s.options[s.selectedIndex].value=i||r},x.prototype.removeItem=function(e){let r=this.querySelector(":scope .item[data-level='"+e+"'] select");t.Util.assert(r,`ChainedSelect.removeItem(): select not found. name=${this.name}, level=${e}`),r.remove(r.selectedIndex),r.value="",this._initElement("edititem",e),this._initElement("removeitem",e),this.clear({fromLevel:parseInt(e)+1,toLevel:this.length})},x.prototype._initElement=function(e,t,r){e=this.rootNodes[e],r?(this.querySelector(":scope .item[data-level='"+t+"'] "+e).disabled=!1,this.querySelector(":scope .item[data-level='"+t+"'] "+e).classList.remove("disabled")):(this.querySelector(":scope .item[data-level='"+t+"'] "+e).disabled=!0,this.querySelector(":scope .item[data-level='"+t+"'] "+e).classList.add("disabled"))},t.ClassUtil.inherit(A,t.Component),A.prototype._getSettings=function(){return{settings:{autoTransform:!1,name:"BmTabindex"},events:{"tab-indices":{rootNode:"[data-tabindex]",handlers:{click:["TabIndex_onTabIndexClick"]}}}}},A.prototype.TabIndex_onTabIndexClick=function(e,t,r){e.classList.contains("active")||this.switchIndex(e.getAttribute("data-tabindex"))},A.prototype.switchIndex=function(e){this.querySelector(":scope [data-tabindex].active").classList.remove("active"),this.querySelector(":scope [data-tabindex='"+e+"']").classList.add("active");let t=document.querySelector(this.getAttribute("data-pair"));t&&t.switchContent(e)},A.prototype.getActiveIndex=function(){return this.querySelector(":scope .active")},customElements.define("bm-tabindex",A),t.ClassUtil.inherit(I,t.Component),I.prototype._getSettings=function(){return{settings:{autoTransform:!1,name:"BmTabcontent"}}},I.prototype.switchContent=function(e){this.querySelector(":scope > .active").classList.remove("active"),this.querySelector(":scope > [data-tabindex='"+e+"']").classList.add("active"),this.querySelector(":scope > [data-tabindex='"+e+"']").focus()},I.prototype.getActiveContent=function(){return this.querySelector(":scope .active")},customElements.define("bm-tabcontent",I),t.ClassUtil.inherit(U,t.Component),U.prototype.start=function(e){let r={settings:{name:"TagLoader"}};return e=e?t.Util.deepMerge(r,e):r,t.Component.prototype.start.call(this,e).then((()=>{"loading"!==document.readyState?t.LoaderOrganizer.load(document.body,this.settings):document.addEventListener("DOMContentLoaded",(()=>{t.LoaderOrganizer.load(document.body,this.settings)}))}))},customElements.define("bm-tagloader",U),t.ClassUtil.inherit(N,t.Component),N.prototype._getSettings=function(){return{settings:{name:"SettingServer",autoSetup:!1}}},customElements.define("bm-setting",N),t.ClassUtil.inherit(T,t.Component),T.prototype._getSettings=function(){return{settings:{autoClear:!1,autoFill:!1,autoTransform:!1,name:"PreferenceServer"},events:{this:{handlers:{beforeStart:["PreferenceServer_onBeforeStart"],doFetch:["PreferenceServer_onDoFetch"],beforeSubmit:["PreferenceServer_onBeforeSubmit"]}}},forms:{settings:{autoValidate:!1,autoCollect:!1}}}},T.prototype.PreferenceServer_onBeforeStart=function(e,i,s){this._defaults=new t.ChainableStore,this._store=new r({chain:this._defaults,filter:this._filter,async:!0})},T.prototype.PreferenceServer_onDoFetch=function(e,t,r){return this.settings.get("defaults.preferences")&&(this._defaults.items=this.settings.get("defaults.preferences")),this.resources.preferences.get().then((e=>{this._store.merge(e),this.items=this._store.items}))},T.prototype.PreferenceServer_onBeforeSubmit=function(e,t,r){this._store.set("",t.detail.items,t.detail.options,...t.detail.args),t.detail.items=this._store.items},T.prototype.subscribe=function(e,t){this._store.subscribe(e.name+"_"+e.uniqueId,this._triggerEvent.bind(e),t)},T.prototype.get=function(e,t){return this._store.get(e,t)},T.prototype.set=function(e,t,...r){return this.submit({items:e,options:t,args:r})},T.prototype._triggerEvent=function(e,r){let i=this.settings.get("preferences.settings.eventName","doSetup"),s=t.Util.safeGet(r,"sender");return this.trigger(i,{sender:s,items:e})},T.prototype._filter=function(e,t,...r){let i=!1,s=t.options.targets;if("*"===s)i=!0;else{s=Array.isArray(s)?s:[s];for(let t=0;t<s.length;t++)if(e[s[t]]){i=!0;break}}return i},customElements.define("bm-preference",T),window.BITSMIST.v1.ObservableStore=r,window.BITSMIST.v1.BindableStore=n,t.OrganizerOrganizer.register(a),t.OrganizerOrganizer.register(o),t.OrganizerOrganizer.register(l),t.OrganizerOrganizer.register(c),t.OrganizerOrganizer.register(d),t.OrganizerOrganizer.register(u),t.OrganizerOrganizer.register(h),t.OrganizerOrganizer.register(g),t.OrganizerOrganizer.register(m),t.OrganizerOrganizer.register(p),t.OrganizerOrganizer.register(_),t.OrganizerOrganizer.register(f),t.OrganizerOrganizer.register(y),t.OrganizerOrganizer.register(R),window.BITSMIST.v1.Plugin=class{constructor(e,r){this._component=e,this._options=new t.Store({items:Object.assign({},r)}),this._options.merge(this._getOptions()),this._options.set("name",this._options.get("name",this.constructor.name));let i=this._options.get("events",{});if(Object.keys(i).forEach((t=>{e.addEventHandler(t,i[t],null,this)})),this._options.get("expose")){let t=this;Object.defineProperty(e.__proto__,this._options.get("expose"),{get:()=>t})}}get name(){return this._options.get("name")}get component(){return this._component}set component(e){this._component=e}_getOptions(){return{}}},window.BITSMIST.v1.CookieResourceHandler=class extends E{constructor(e,r,i){super(e,r,Object.assign({autoLoad:!0},i)),this._name="CookieResourceHandler",this._cookieName=t.Util.safeGet(i,"cookieOptions.name","preferences")}_get(e,t){return this.__getCookie(this._cookieName)}_put(e,t,r){this.__setCookie(this._cookieName,t)}__getCookie(e){let t=document.cookie.split(";").reduce(((e,t)=>{const[r,i]=t.split("=");return r&&(e[r.trim()]=i?decodeURIComponent(i.trim()):void 0),e}),{});return t[e]?JSON.parse(t[e]):{}}__setCookie(e,t){let r=e+"="+encodeURIComponent(JSON.stringify(t))+"; ",i=this._options.get("cookieOptions");r+=Object.keys(i).reduce(((e,t)=>e+=t+"="+i[t]+"; "),""),document.cookie=r}},window.BITSMIST.v1.ApiResourceHandler=class extends E{constructor(e,t,r){super(e,t,r),this._name="ApiResourceHandler"}_get(e,r){let i="GET",s=this._getOption("headers",i),n=this._getOption("options",i),a=this._getOption("url",i),o=a.dataType,l=this._buildApiUrl(this._resourceName,e,r,a);return t.AjaxUtil.ajaxRequest({url:l,method:i,headers:s,options:n}).then((e=>this._convertResponseData(e.responseText,o)))}_delete(e,r){let i="DELETE",s=this._getOption("headers",i),n=this._getOption("options",i),a=this._getOption("url",i);a.dataType;let o=this._buildApiUrl(this._resourceName,e,r,a);return t.AjaxUtil.ajaxRequest({url:o,method:i,headers:s,options:n})}_post(e,r,i){let s="POST",n=this._getOption("headers",s),a=this._getOption("options",s),o=this._getOption("url",s),l=o.dataType,c=this._buildApiUrl(this._resourceName,e,i,o);return t.AjaxUtil.ajaxRequest({url:c,method:s,headers:n,options:a,data:this._convertRequestData(r,l)})}_put(e,r,i){let s="PUT",n=this._getOption("headers",s),a=this._getOption("options",s),o=this._getOption("url",s),l=o.dataType,c=this._buildApiUrl(this._resourceName,e,i,o);return t.AjaxUtil.ajaxRequest({url:c,method:s,headers:n,options:a,data:this._convertRequestData(r,l)})}_convertRequestData(e,t){let r;return r=JSON.stringify(e),r}_convertResponseData(e,t){let r;return r=JSON.parse(e),r}_getOption(e,t){let r=this._options.get("ajaxOptions",{}),i=e in r&&"COMMON"in r[e]?r[e].COMMON:{},s=e in r&&t in r[e]?r[e][t]:{};return Object.assign(i,s)}_buildApiUrl(e,t,r,i){let s=i.baseUrl||this._component.settings.get("system.apiBaseUrl",""),n=i.scheme||"",a=i.host||"",o=i.dataType||"",l=i.version||"";return(i.format||"").replace("@scheme@",n).replace("@host@",a).replace("@baseUrl@",s).replace("@resource@",e).replace("@id@",t).replace("@dataType@",o).replace("@query@",this._buildUrlQuery(r)).replace("@version@",l)}_buildUrlQuery(e){let t="";return e&&(t=Object.keys(e).reduce(((t,r)=>(Array.isArray(e[r])?t+=encodeURIComponent(r)+"="+encodeURIComponent(e[r].join())+"&":e[r]&&(t+=encodeURIComponent(r)+"="+encodeURIComponent(e[r])+"&"),t)),"")),t?"?"+t.slice(0,-1):""}},window.BITSMIST.v1.ObjectResourceHandler=class extends E{constructor(e,t,r){super(e,t,Object.assign({autoLoad:!0,autoFetch:!1,autoSubmit:!1},r)),this._name="ObjectResourceHandler",r.items&&(this.data=r.items)}_get(e,t){return this._data}_put(e,t,r){this.data=t}},window.BITSMIST.v1.LinkedResourceHandler=class extends E{constructor(e,t,r){super(e,t,Object.assign({autoLoad:!0,autoFetch:!1,autoSubmit:!1},r)),this._name="LinkedResourceHandler",this._ref}get data(){return this._ref.data}set data(e){}get items(){return this._ref.items}getText(e){return this._ref.getText(e)}getItem(e){return this._ref.getItem(e)}_get(e,t){let r=this._options.get("rootNode"),i=this._options.get("resourceName")||this._resourceName;return this._component.waitFor([{rootNode:r}]).then((()=>(this._ref=document.querySelector(r).resources[i],this._ref)))}_delete(e,t){return this._ref.delete(e,t)}_post(e,t,r){return this._ref.post(e,t,r)}_put(e,t,r){return this._ref.put(e,t,r)}},window.BITSMIST.v1.WebstorageResourceHandler=class extends E{constructor(e,t,r){super(e,t,Object.assign({},r)),this._name="WebstorageResourceHandler"}_get(e,t){let r,i=localStorage.getItem(e);return i&&(r=JSON.parse(i)),r}_delete(e,t){localStorage.removeItem(e)}_post(e,t,r){localStorage.setItem(e,JSON.stringify(t))}_put(e,t,r){localStorage.setItem(e,JSON.stringify(t))}},window.BITSMIST.v1.ValidationHandler=C,window.BITSMIST.v1.HTML5FormValidationHandler=k,window.BITSMIST.v1.ObjectValidationHandler=z,window.BITSMIST.v1.FormatterUtil=i,window.BITSMIST.v1.ChainedSelect=x,window.BITSMIST.v1.BmTabindex=A,window.BITSMIST.v1.BmTabcontent=I}();

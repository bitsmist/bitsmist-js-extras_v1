!function(){"use strict";var t=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.globalInit=function(){e.__initErrorListeners(),e._observers=new BITSMIST.v1.ObserverStore({filter:e.__filter})},e.organize=function(t,r,n){return r.settings.get("errors")&&e._observers.set(r.uniqueId,{object:r,targets:"*"}),n},e.__filter=function(t,e,r,n){for(var o=!1,i=e.object._settings.get("errors").targets,s=0;s<i.length;s++)if(n.error.name==i[s]){o=!0;break}return o},e.__initErrorListeners=function(){window.addEventListener("unhandledrejection",(function(t){var r={};return t.reason?t.reason instanceof XMLHttpRequest?(r.message=t.reason.statusText,r.stack=t.reason.stack,r.object=t.reason):(r.message=t.reason.message,r.object=t.reason):r.message=t,r.type=t.type,r.name=e.__getErrorName(t),r.filename="",r.funcname="",r.lineno="",r.colno="",e.__handleException(r),!1})),window.addEventListener("error",(function(t,r,n,o){var i={type:"error"};return i.name=e.__getErrorName(t),i.message=t.message,i.file=t.filename,i.line=t.lineno,i.col=t.colno,t.error&&(i.stack=t.error.stack,i.object=t.error),e.__handleException(i),!1}))},e.__getErrorName=function(t){var e,r;if((r=t.reason instanceof XMLHttpRequest||t.reason?t.reason:t.error?t.error:t.message).name)e=r.name;else if(r instanceof TypeError)e="TypeError";else if(r instanceof XMLHttpRequest)e="AjaxError";else if(r instanceof EvalError)e="EvalError";else if(r instanceof RangeError)e="RangeError";else if(r instanceof ReferenceError)e="ReferenceError";else if(r instanceof SyntaxError)e="SyntaxError";else if(r instanceof URIError)e="URIError";else{var n=r.indexOf(":");n>-1&&(e=r.substring(0,n))}return e},e.__handleException=function(t){return e._observers.notifySync("trigger","error",e,{error:t})},e}(BITSMIST.v1.Organizer),e=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.init=function(t,e,r){e._plugins={}},e.organize=function(t,r,n){var o=r.settings.get("plugins");return o&&Object.keys(o).forEach((function(t){e._addPlugin(r,t,o[t])})),n},e._addPlugin=function(t,e,r){var n,o="className"in(r=Object.assign({},r))?r.className:e;return n=BITSMIST.v1.ClassUtil.createObject(o,t,r),t._plugins[e]=n,n},e}(BITSMIST.v1.Organizer),r=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.organize=function(t,e,r){var n=[],o=r.files;return o&&Object.keys(o).forEach((function(t){n.push(BITSMIST.v1.AjaxUtil.loadScript(o[t].href))})),Promise.all(n).then((function(){return r}))},e}(BITSMIST.v1.Organizer),n=function(t,e){this._name=t,this._options=e,this._data,this._parameters={}};n.prototype.get=function(t,e){var r=this,n="GET",o=this._getOption("headers",n),i=this._getOption("options",n),s=this._getOption("url",n),a=s.dataType,c=this._buildApiUrl(this._name,t,e,s);return BITSMIST.v1.AjaxUtil.ajaxRequest({url:c,method:n,headers:o,options:i}).then((function(t){return r._convertResponseData(t.responseText,a)}))},n.prototype.delete=function(t,e){var r=this,n="DELETE",o=this._getOption("headers",n),i=this._getOption("options",n),s=this._getOption("url",n),a=s.dataType,c=this._buildApiUrl(this._name,t,e,s);return BITSMIST.v1.AjaxUtil.ajaxRequest({url:c,method:n,headers:o,options:i}).then((function(t){return r._convertResponseData(t.responseText,a)}))},n.prototype.insert=function(t,e,r){var n=this,o="POST",i=this._getOption("headers",o),s=this._getOption("options",o),a=this._getOption("url",o),c=a.dataType,u=this._buildApiUrl(this._name,t,r,a);return BITSMIST.v1.AjaxUtil.ajaxRequest({url:u,method:o,headers:i,options:s,data:this._convertRequestData(e,c)}).then((function(t){return n._convertResponseData(t.responseText,c)}))},n.prototype.update=function(t,e,r){var n=this,o="PUT",i=this._getOption("headers",o),s=this._getOption("options",o),a=this._getOption("url",o),c=a.dataType,u=this._buildApiUrl(this._name,t,r,a);return BITSMIST.v1.AjaxUtil.ajaxRequest({url:u,method:o,headers:i,options:s,data:this._convertRequestData(e,c)}).then((function(t){return n._convertResponseData(t.responseText,c)}))},n.prototype._convertRequestData=function(t,e){var r;switch(e){case"json":default:r=JSON.stringify(t)}return r},n.prototype._convertResponseData=function(t,e){var r;switch(e){case"json":default:r=JSON.parse(t)}return r},n.prototype._getOption=function(t,e){var r="settings"in this._options?this._options.settings:{},n=t in r&&"COMMON"in r[t]?r[t].COMMON:{},o=t in r&&e in r[t]?r[t][e]:{};return Object.assign(n,o)},n.prototype._buildApiUrl=function(t,e,r,n){var o=n.baseUrl,i=n.scheme,s=n.host,a=n.dataType,c=n.version;return(n.format?n.format:"@baseUrl@@query@").replace("@scheme@",i).replace("@host@",s).replace("@baseUrl@",o).replace("@resource@",t).replace("@id@",e).replace("@dataType@",a).replace("@query@",this._buildUrlQuery(r)).replace("@version@",c)},n.prototype._buildUrlQuery=function(t){var e="";return t&&(e=Object.keys(t).reduce((function(e,r){return Array.isArray(t[r])?e+=encodeURIComponent(r)+"="+encodeURIComponent(t[r].join())+"&":t[r]&&(e+=encodeURIComponent(r)+"="+encodeURIComponent(t[r])+"&"),e}),"")),e?"?"+e.slice(0,-1):""};var o=function(t){function e(e,r){if(t.call(this,e,r),this._items,"items"in r){var n;if("object"==typeof r.items)n=r.items;else{var o=window;r.items.split(".").forEach((function(t){if(!(o=o[t]))throw new ReferenceError("Master not found. Master="+r.items)})),n=o}this._items=this.__reshapeItems(n)}}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var r={items:{configurable:!0}};return r.items.get=function(){return this._items},e.prototype.load=function(){var t=this;return this.get("list").then((function(e){t._items=t.__reshapeItems(e.data)}))},e.prototype.getValue=function(t){var e=t,r=this._options.title;return this._items&&t in this._items&&(e=this._items[t][r]),e},e.prototype.getItem=function(t){var e;return this._items&&t in this._items&&(e=this._items[t]),e},e.prototype.filter=function(t){var e=this;return Object.keys(this._items).reduce((function(r,n){return t(e._items[n])&&(r[n]=e._items[n]),r}),{})},e.prototype.__reshapeItems=function(t){var e=this._options.id,r=this._options.title;return t.reduce((function(t,n){var o=n[e];return t[o]=n,t[o].title=n[r],t}),{})},Object.defineProperties(e.prototype,r),e}(n),i=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.init=function(t,e,r){Object.defineProperty(e,"masters",{get:function(){return this._masters}}),e._masters={}},e.organize=function(t,e,r){var n=this,o=[],i=r.masters;if(i){var s=e.settings.get("ajaxUtil",{});s.url.COMMON.baseUrl=e.settings.get("system.apiBaseUrl",""),Object.keys(i).forEach((function(t){o.push(n._initMaster(e,t,i[t],s))}))}return Promise.all(o).then((function(){return r}))},e._initMaster=function(t,e,r,n){if(t._masters[e]=new o(e,Object.assign({settings:n},r)),r.autoLoad)return t._masters[e].load()},e}(BITSMIST.v1.Organizer),s=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.globalInit=function(){e.__preferences=new BITSMIST.v1.Store,e.__observers=new BITSMIST.v1.ObserverStore({filter:e.__filter}),e.__loaded={},e.__loaded.promise=new Promise((function(t,r){e.__loaded.resolve=t,e.__loaded.reject=r,setTimeout((function(){r("Time out waiting for loading preferences.")}),1e4)})),Object.defineProperty(e,"preferences",{get:function(){return e.__preferences}})},e.init=function(t,r,n){Object.defineProperty(r,"preferences",{get:function(){return this._preferences}}),r._preferences=new a(r),e._register(r,BITSMIST.v1.Util.safeGet(n,"preferences.targets"))},e.organize=function(t,r,n){var o=Promise.resolve();return r.settings.get("preferences.load")&&(e.__preferences.items=r.settings.get("preferences.defaults"),o=e._load(r).then((function(t){e.__preferences.merge(t),e.__loaded.resolve()}))),o.then((function(){return e.__loaded.promise})).then((function(){return n.newPreferences=e.__preferences.items,n}))},e._setup=function(t,r){return(r=Object.assign({},r)).sender&&r.sender,e.__observers.notify("setup",r).then((function(){r.newPreferences&&(e.__preferences.merge(r.newPreferences),e._save(t))}))},e._register=function(t,r){e.__observers.set(t.uniqueId,{object:t,targets:r})},e._deregister=function(t){e.__observers.remove(t.uniqueId)},e._load=function(t,e){var r=e&&e.sender?e.sender:t;return t.trigger("doLoadStore",r)},e._save=function(t,r){var n=r&&r.sender?r.sender:t;return t.trigger("doSaveStore",n,{data:e.__preferences.items})},e.__filter=function(t,e){var r=!1,n=e.targets;if("*"==n)return!0;if(n)for(var o=0;o<n.length;o++)if(t.newPreferences.hasOwnProperty(n[o])){r=!0;break}return r},e}(BITSMIST.v1.Organizer),a=function(t){this._component=t},c={items:{configurable:!0}};c.items.get=function(){return s.__preferences.items},a.prototype.set=function(t,e){return s.__preferences.set(t,e)},a.prototype.get=function(t){return s.__preferences.get(t)},a.prototype.load=function(){return s._load(this._component)},a.prototype.save=function(){return s._save(this._component)},a.prototype.setup=function(t){return s._setup(this._component,t)},Object.defineProperties(a.prototype,c);var u=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.organize=function(t,r,n){var o={afterStart:e.onDoOrganize,afterAppend:e.onDoOrganize,afterSpecLoad:e.onDoOrganize,beforeOpen:e.onDoOrganize,afterOpen:e.onDoOrganize,beforeClose:e.onDoOrganize,afterClose:e.onDoOrganize,doRefresh:e.onDoOrganize},i=n.attrs;return i&&Object.keys(i).forEach((function(t){o[t]&&r.addEventHandler(t,{handler:o[t],options:{attrs:i[t]}})})),n},e.onDoOrganize=function(t,r,n){var o=n.component,i=n.options.attrs;return e._initAttr(o,i)},e._initAttr=function(t,e){return e&&Object.keys(e).forEach((function(r){switch(r){case"style":Object.keys(e[r]).forEach((function(n){t.style[n]=e[r][n]}));break;default:t.setAttribute(r,e[r])}})),Promise.resolve()},e}(BITSMIST.v1.Organizer),p=function(t,e){var r=this;this._component=t,this._options=new BITSMIST.v1.Store({items:Object.assign({},this._getOptions(),e)}),this._options.set("name",this._options.get("name",this.constructor.name));var n=this._options.get("events",{});if(Object.keys(n).forEach((function(e){t.addEventHandler(e,n[e],null,r)})),this._options.get("expose")){var o=this;Object.defineProperty(t.__proto__,this._options.get("expose"),{get:function(){return o}})}},l={name:{configurable:!0},component:{configurable:!0}};function f(t){this._options=t||{}}l.name.get=function(){return this._options.get("name")},l.component.get=function(){return this._component},l.component.set=function(t){this._component=t},p.prototype._getOptions=function(){return{}},Object.defineProperties(p.prototype,l),f.prototype.get=function(t){var e=document.cookie.split(";").reduce((function(t,e){var r=e.split("="),n=r[0],o=r[1];return n&&(t[n.trim()]=o?decodeURIComponent(o.trim()):void 0),t}),{});return e[t]?JSON.parse(e[t]):{}},f.prototype.set=function(t,e,r){var n=t+"="+encodeURIComponent(JSON.stringify(e))+"; ";r=r||{},this._options&&(r=Object.assign(this._options,r)),n+=Object.keys(r).reduce((function(t,e){return t+=e+"="+r[e]+"; "}),""),document.cookie=n};var d=function(t){function e(e,r){t.call(this,e,r),this._cookie=new f(this._options.get("cookieOptions")),this._cookieName=this._options.get("cookieOptions.name","preferences")}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.onDoLoadStore=function(t,e,r){return this._cookie.get(this._cookieName)},e.prototype.onDoSaveStore=function(t,e,r){this._cookie.set(this._cookieName,e.detail.data)},e.prototype._getOptions=function(){return{events:{doLoadStore:this.onDoLoadStore,doSaveStore:this.onDoSaveStore}}},e}(p),h=function(t){function e(e,r){var n=this;t.call(this,e,r),this._options.set("settings",this._component.settings.get("ajaxUtil","")),this._options.set("settings.url.COMMON.baseUrl",this._component.settings.get("system.apiBaseUrl","")),this._resources={},this._defaultResourceName;var o=this._options.get("resources",[]);Object.keys(o).forEach((function(t){var e=o[t];n.addResource(e,{settings:n._options.get("settings",{})})})),this.switchResource(o[0])}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.addResource=function(t,e){this._resources[t]=new n(t,Object.assign({settings:e.settings})),this[t]=this._resources[t]},e.prototype.switchResource=function(t){this._defaultResourceName=t},e.prototype.onDoFetch=function(t,e,r){var n=this,o=BITSMIST.v1.Util.safeGet(e.detail.target,"id"),i=BITSMIST.v1.Util.safeGet(e.detail.target,"parameters");if(BITSMIST.v1.Util.safeGet(e.detail.options,"autoLoad",this._options.get("autoLoad")))return this._resources[this._defaultResourceName].get(o,i).then((function(t){n._component.data=t,"items"in n._component?n._component.items=n._options.get("itemsGetter",(function(t){return t.data}))(t):"item"in n._component&&(n._component.item=n._options.get("itemGetter",(function(t){return t.data[0]}))(t))}))},e.prototype.onDoSubmit=function(t,e,r){var n=this,o=BITSMIST.v1.Util.safeGet(e.detail.target,"id");BITSMIST.v1.Util.safeGet(e.detail.target,"parameters");var i=BITSMIST.v1.Util.safeGet(e.detail,"items");return Promise.resolve().then((function(){return o?n._resources[n._defaultResourceName].update(o,{items:i}):n._resources[n._defaultResourceName].insert(o,{items:i})}))},e.prototype._getOptions=function(){return{events:{doFetch:this.onDoFetch,doSubmit:this.onDoSubmit}}},e}(p);function g(){}function _(){}function m(t){var e=Reflect.construct(BITSMIST.v1.Pad,[t],this.constructor);return e._id,e._parameters,e._item={},e.__cancelSubmit=!1,e._target={},e}function v(){return Reflect.construct(BITSMIST.v1.Pad,[],this.constructor)}g.format=function(t,e,r){var n=r;switch(e.toLowerCase()){case"yyyy/mm/dd":n=g.formatDate(e,n);break;case"price":n=g.formatPrice(e,n)}return n},g.formatPrice=function(t,e){return e?"¥"+String(parseInt(e)).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,"):""},g.formatNumber=function(t){return t?String(parseInt(t)).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,"):""},g.formatDate=function(t,e){var r="";return e&&8==e.length&&(r=e.substr(0,4)+"/"+e.substr(4,2)+"/"+e.substr(6,2)),r},g.deformat=function(t,e,r){var n=r;switch(e){case"yyyy/mm/dd":n=g.deformatDate(e,r);break;case"price":n=g.deformatPrice(e,r)}return n},g.deformatPrice=function(t,e){var r="";return e&&(r=e.replace(/,/g,"").replace(/\//g,"").replace(/\\/g,"").replace("¥","")),r},g.deformatDate=function(t,e){var r="";return e&&(r=e.replace(/,/g,"").replace(/\//g,"").replace(/\\/g,"")),r},g.getNow=function(t){t=t||"-";var e=new Date;return e.getFullYear()+t+("00"+(e.getMonth()+1)).slice(-2)+t+("00"+e.getDate()).slice(-2)+" "+("00"+e.getHours()).slice(-2)+":"+("00"+e.getMinutes()).slice(-2)+":"+("00"+e.getSeconds()).slice(-2)},g.getToday=function(t){t=void 0===t?"-":t;var e=new Date;return e.getFullYear()+t+("00"+(e.getMonth()+1)).slice(-2)+t+("00"+e.getDate()).slice(-2)},g.sanitize=function(t){return"string"==typeof t?t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"):t},_.setFields=function(t,e,r){var n=this,o=t.querySelectorAll("[data-bm-field]");Array.prototype.concat([t],Array.prototype.slice.call(o,0)).forEach((function(t){var o=t.getAttribute("data-bm-field");if(o in e)if(t.hasAttribute("data-bm-master")){var i=t.getAttribute("data-bm-master"),s=n.getMasterValue(r,i,e[o]);n.setValue(t,s)}else n.setValue(t,e[o])}))},_.getFields=function(t,e){var r=this,n={};e=e||"";var o=t.querySelectorAll(e+" [data-bm-formitem]");return(o=Array.prototype.slice.call(o,0)).forEach((function(t){var e=t.getAttribute("data-bm-field"),o=r.getValue(t);if(Array.isArray(n[e]))o&&n[e].push(o);else if(n[e]){if(o){var i=[];i.push(n[e]),i.push(o),n[e]=i}}else n[e]=o})),n},_.clearFields=function(t,e){e=e||"";var r=t.querySelectorAll(e+" input");(r=Array.prototype.slice.call(r,0)).forEach((function(t){switch(t.type.toLowerCase()){case"search":case"text":case"number":t.value="";break;case"checkbox":case"radio":t.checked=!1}})),r=t.querySelectorAll(e+" select"),(r=Array.prototype.slice.call(r,0)).forEach((function(t){t.selectedIndex=-1}))},_.buildFields=function(t,e,r){var n=t.querySelectorAll("[data-bm-field='"+e+"']");(n=Array.prototype.slice.call(n,0)).forEach((function(t){if("select"==t.tagName.toLowerCase()){if(t.options.length=0,"emptyItem"in r){var e="text"in r.emptyItem?r.emptyItem.text:"",n="value"in r.emptyItem?r.emptyItem.value:"",o=document.createElement("option");o.text=e,o.value=n,o.setAttribute("selected",""),t.appendChild(o)}Object.keys(r.items).forEach((function(e){var n=document.createElement("option");n.text=r.items[e].title,n.value=e,t.appendChild(n)}))}else Object.keys(r.items).forEach((function(e){var n=document.createElement("label"),o=document.createElement("input");o.type="radio",o.id=key,o.name=key,o.value=e,o.setAttribute("data-bm-field",key),o.setAttribute("data-bm-formitem",""),n.appendChild(o),n.appendChild(document.createTextNode(r.items[e].title)),t.appendChild(n)}))}))},_.getMasterValue=function(t,e,r){var n=r;return t&&e in t&&(n=t[e].getValue(r)),n},_.setValue=function(t,e){null!==e&&null!=e||(e=""),t.hasAttribute("data-bm-format")&&(e=g.format("",t.getAttribute("data-bm-format"),e));var r=g.sanitize(e),n=t.getAttribute("data-bm-target");if(n)for(var o=n.split(","),i=0;i<o.length;i++){var s=o[i].toLowerCase();switch(s){case"html":t.innerHTML=e;break;case"href":case"src":case"rel":"http"!=e.substring(0,4)&&"/"!=e.substring(0,1)||t.setAttribute(s,e);break;default:var a=t.getAttribute(s);a=a?a+" "+e:r,t.setAttribute(s,a)}}else if(t.hasAttribute("value"))"input"==t.tagName.toLowerCase()&&"checkbox"==t.type.toLowerCase()||"input"==t.tagName.toLowerCase()&&"radio"==t.type.toLowerCase()?Array.isArray(e)?e.indexOf(t.getAttribute("value"))>-1&&(t.checked=!0):t.getAttribute("value")==e&&(t.checked=!0):t.setAttribute("value",g.sanitize(e));else if("select"==t.tagName.toLowerCase())t.value=e;else if("fieldset"==t.tagName.toLowerCase());else if("input"==t.tagName.toLowerCase())switch(t.type.toLowerCase()){case"number":case"search":case"text":t.value=e;break;case"checkbox":t.checked=!!e;break;case"radio":t.value==e&&(t.checked=!0)}else t.innerText=e;var c=document.createEvent("HTMLEvents");c.initEvent("change",!0,!0),t.dispatchEvent(c)},_.getValue=function(t){var e=void 0;switch(t.tagName.toLowerCase()){case"input":switch(t.type.toLowerCase()){case"radio":case"checkbox":t.checked&&(e=t.hasAttribute("value")?t.getAttribute("value"):t.checked);break;default:e=t.value}break;case"select":e=t.value;break;default:t.hasAttribute("selected")&&(e=t.getAttribute("value"))}return t.hasAttribute("data-bm-format")&&(e=BITSMIST.v1.FormatterUtil.deformat("",t.getAttribute("data-bm-format"),e)),e},_.reportValidity=function(t){var e=!0,r=t.querySelectorAll("input");return(r=Array.prototype.slice.call(r,0)).forEach((function(t){switch(t.getAttribute("type")){case"number":(t.validity&&0==t.validity.valid||isNaN(t.value))&&(t.style.border="solid 3px red",e=!1)}})),e},BITSMIST.v1.ClassUtil.inherit(m,BITSMIST.v1.Pad),Object.defineProperty(m.prototype,"item",{get:function(){return this._item},set:function(t){this._item=t}}),Object.defineProperty(m.prototype,"data",{get:function(){return this._data},set:function(t){this._data=t}}),m.prototype.build=function(t){var e=this;Object.keys(t).forEach((function(r){_.buildFields(e,r,t[r])}))},m.prototype.fill=function(t){var e=this,r=(t=Object.assign({},t)).sender?t.sender:this;return this._target.id="id"in t?t.id:this._target.id,this._target.parameters="parameters"in t?t.parameters:this._target.parameters,BITSMIST.v1.Util.safeGet(t,"settings.autoClear",this._settings.get("settings.autoClear"))&&this.clear(),Promise.resolve().then((function(){return e.trigger("doTarget",r,{target:e._target,options:t})})).then((function(){return e.trigger("beforeFetch",r,{target:e._target,options:t})})).then((function(){return e.trigger("doFetch",r,{target:e._target,options:t})})).then((function(){return e.trigger("afterFetch",r,{target:e._target,options:t})})).then((function(){return e.trigger("beforeFill",r)})).then((function(){return _.setFields(e,e._item,e.masters),e.trigger("afterFill",r)}))},m.prototype.clear=function(t){return _.clearFields(this,t)},m.prototype.validate=function(t){var e=this,r=(t=Object.assign({},t)).sender?t.sender:this;return Promise.resolve().then((function(){return e.trigger("beforeValidate",r)})).then((function(){var t=!0,n=e.querySelector("form");return e.settings.get("settings.autoValidate")&&(t=n&&n.reportValidity?n.reportValidity():_.reportValidity(e)),t||(e.__cancelSubmit=!0),e.trigger("afterValidate",r)}))},m.prototype.submit=function(t){var e=this,r=(t=Object.assign({},t)).sender?t.sender:this;return delete t.sender,this.__cancelSubmit=!1,this._item=this.getFields(),Promise.resolve().then((function(){return e.validate()})).then((function(){return e.trigger("beforeSubmit",r)})).then((function(){if(!e.__cancelSubmit){var t=e.settings.get("settings.itemGetter",(function(t){return[t]}))(e._item);return e.trigger("doSubmit",r,{target:e._target,items:t})}})).then((function(){var t=e.settings.get("settings.itemGetter",(function(t){return[t]}))(e._item);return e.trigger("afterSubmit",r,{target:e._target,items:t})}))},m.prototype.getFields=function(){return _.getFields(this)},BITSMIST.v1.ClassUtil.inherit(v,BITSMIST.v1.Pad),Object.defineProperty(v.prototype,"row",{get:function(){return this._row}}),Object.defineProperty(v.prototype,"items",{get:function(){return this._items},set:function(t){this._items=t}}),Object.defineProperty(v.prototype,"data",{get:function(){return this._data},set:function(t){this._data=t}}),v.prototype.onListAfterAppend=function(t,e,r){this._listRootNode=this.querySelector(this._settings.get("settings.listRootNode"));var n=this._settings.get("components")[this._settings.get("settings.row")].className?this._settings.get("components")[this._settings.get("row")].className:this._settings.get("settings.row");return this._row=BITSMIST.v1.ClassUtil.createObject(n),this._row._parent=this,this._row.start()},v.prototype.clear=function(){this._listRootNode.innerHTML=""},v.prototype.fill=function(t){var e=this,r=(t=Object.assign({},t)).sender?t.sender:this,n=this._settings.get("settings.async")?this._buildAsync:this._buildSync,o=document.createDocumentFragment();return this._rows=[],this._target.id="id"in t?t.id:this._target.id,this._target.parameters="parameters"in t?t.parameters:this._target.parameters,Promise.resolve().then((function(){return e.trigger("doTarget",e,{target:e._target,options:t})})).then((function(){return e.trigger("beforeFetch",r,{target:e._target,options:t})})).then((function(){return e.trigger("doFetch",r,{target:e._target,options:t})})).then((function(){return e.trigger("afterFetch",r,{target:e._target,options:t})})).then((function(){return e.trigger("beforeFill",r)})).then((function(){if(e._items)return n.call(e,o)})).then((function(){BITSMIST.v1.Util.safeGet(t,"autoClear",e._settings.get("settings.autoClear"))&&e.clear()})).then((function(){e._listRootNode.appendChild(o)})).then((function(){return e.trigger("afterFill",r)}))},v.prototype.start=function(t){return this._id,this._parameters,this._target={},this._data,this._items,this._listRootNode,this._row,this._rows,t=Object.assign({},t,{events:{this:{handlers:{afterAppend:[{handler:this.onListAfterAppend}]}}}}),BITSMIST.v1.Pad.prototype.start.call(this,t)},v.prototype._buildSync=function(t){for(var e=this._row.settings.get("rowevents"),r=this._row._templates[this._row.settings.get("settings.templateName")].html,n=0;n<this._items.length;n++)this.__appendRowSync(t,n,this._items[n],r,e)},v.prototype._buildAsync=function(t){for(var e=this,r=Promise.resolve(),n=this._row._templates[this._row.settings.get("settings.templateName")].html,o=function(o){r=r.then((function(){return e.__appendRowAsync(t,o,e._items[o],n)}))},i=0;i<e._items.length;i++)o(i);return r},v.prototype.__appendRowAsync=function(t,e,r,n,o){var i=this,s=document.createElement("div");s.innerHTML=n;var a=s.firstElementChild;return t.appendChild(a),this._rows.push(a),o&&Object.keys(o).forEach((function(t){i._row.initEvents(t,o[t],a)})),Promise.resolve().then((function(){return i._row.trigger("beforeFillRow",i,{item:r,no:e,element:a})})).then((function(){_.setFields(a,r,i.masters)})).then((function(){return i._row.trigger("afterFillRow",i,{item:r,no:e,element:a})}))},v.prototype.__appendRowSync=function(t,e,r,n,o){var i=this,s=document.createElement("div");s.innerHTML=n;var a=s.firstElementChild;t.appendChild(a),this._rows.push(a),o&&Object.keys(o).forEach((function(t){i._row.initEvents(t,o[t],a)})),this._row.triggerAsync("beforeFillRow",this,{item:r,no:e,element:a}),_.setFields(a,r,this.masters),this.row.triggerAsync("afterFillRow",this,{item:r,no:e,element:a})};var y=function(t){function e(e,r){t.call(this,e,r),this.__isComposing=!1}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.onAfterAppend=function(t,e,r){var n=this._options.get("features.defaultKeys");n&&(this._component.addEventHandler("keydown",{handler:this.onKeyDown,options:n},null,this),this._component.addEventHandler("keypress",{handler:this.onKeyPress,options:n},null,this),this._component.addEventHandler("compositionstart",{handler:this.onCompositionStart,options:n},null,this),this._component.addEventHandler("compositionend",{handler:this.onCompositionEnd,options:n},null,this));var o=this._options.get("features.defaultButtons");o&&(this.__initElements(o.submit,this.onDefaultSubmit),this.__initElements(o.cancel,this.onDefaultCancel),this.__initElements(o.clear,this.onDefaultClear))},e.prototype.onKeyDown=function(t,e,r){var n=e.key?e.key:this.__getKeyfromKeyCode(e.keyCode);switch(n="esc"==(n=n.toLowerCase())?"escape":n){case"escape":this.onKeyPress(t,e,r)}},e.prototype.onKeyPress=function(t,e,r){if(!this.__isComposing&&229!=e.keyCode){var n=e.key?e.key:this.__getKeyfromKeyCode(e.keyCode);n="esc"==(n=n.toLowerCase())?"escape":n,r.options.submit&&n==r.options.submit.key?this.onDefaultSubmit(t,e,{options:r.options.submit}):r.options.cancel&&n==r.options.cancel.key?this.onDefaultCancel(t,e,{options:r.options.cancel}):r.options.clear&&n==r.options.clear.key&&this.onDefaultClear(t,e,{options:r.options.clear})}},e.prototype.onCompositionStart=function(t,e,r){this.__isComposing=!0},e.prototype.onCompositionEnd=function(t,e,r){this.__isComposing=!1},e.prototype.onDefaultSubmit=function(t,e,r){var n=this;this._component.submit().then((function(){n._component.__cancelSubmit||(n._component._isModal&&(n._component._modalResult.result=!0),r&&r.options.autoClose&&n._component.close())}))},e.prototype.onDefaultCancel=function(t,e,r){this._component.close()},e.prototype.onDefaultClear=function(t,e,r){var n;r&&r.options.target&&(n=t.getAttribute(r.options.target)),this._component.clear(n)},e.prototype.__getKeyfromKeyCode=function(t){var e;switch(t){case 13:e="Enter";break;default:e=String.fromCharCode(t)}return e},e.prototype.__initElements=function(t,e){var r=this;if(t){var n=this._component.querySelectorAll(t.rootNode);(n=Array.prototype.slice.call(n,0)).forEach((function(n){r._component.addEventHandler("click",{handler:e,options:t},n,r)}))}},e.prototype._getOptions=function(){return{events:{afterAppend:this.onAfterAppend}}},e}(p),b=function(t){function e(e,r){t.call(this,"authentications",r)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.authenticate=function(t,e,r){var n=this;return new Promise((function(o,i){n.get("list",{user:t,password:e}).then((function(t){t.result.resultCount>0?r&&"redirect"in r&&(location.href=decodeURI(r.redirect)):i("login failed")}))}))},e}(n);window.BITSMIST=window.BITSMIST||{},window.BITSMIST.v1=window.BITSMIST.v1||{},BITSMIST.v1.OrganizerOrganizer.organizers.set("ErrorOrganizer",{object:t,targetWords:"errors",targetEvents:["beforeStart"],order:100}),BITSMIST.v1.OrganizerOrganizer.organizers.set("PluginOrganizer",{object:e,targetWords:"plugins",targetEvents:["beforeStart"],order:400}),BITSMIST.v1.OrganizerOrganizer.organizers.set("FileOrganizer",{object:r,targetWords:"files",targetEvents:["afterSpecLoad"],order:400}),BITSMIST.v1.OrganizerOrganizer.organizers.set("MasterOrganizer",{object:i,targetWords:"masters",targetEvents:["beforeStart","afterSpecLoad"],order:400}),BITSMIST.v1.OrganizerOrganizer.organizers.set("PreferenceOrganizer",{object:s,targetWords:"preferences",targetEvents:["beforeStart"],order:500}),BITSMIST.v1.OrganizerOrganizer.organizers.set("AttrOrganizer",{object:u,targetWords:"attrs",targetEvents:["beforeStart","afterSpecLoad"],order:600}),BITSMIST.v1.OrganizerOrganizer.organizers.get("EventOrganizer").targetEvents.push("afterSpecLoad"),window.BITSMIST.v1.Plugin=p,window.BITSMIST.v1.CookieStoreHandler=d,window.BITSMIST.v1.ResourceHandler=h,window.BITSMIST.v1.Form=m,window.BITSMIST.v1.List=v,window.BITSMIST.v1.DefaultkeyHandler=y,window.BITSMIST.v1.AuthenticationUtil=b,window.BITSMIST.v1.FormatterUtil=g,window.BITSMIST.v1.MasterUtil=o,window.BITSMIST.v1.ResourceUtil=n,BITSMIST.v1.preferences=s.preferences,BITSMIST.v1.ClassUtil.newComponent(BITSMIST.v1.Component,{settings:{name:"PreferenceManager"}},"bm-preference","PreferenceManager")}();

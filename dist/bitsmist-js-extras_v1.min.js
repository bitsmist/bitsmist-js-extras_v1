!function(){"use strict";function t(){return Reflect.construct(BITSMIST.v1.Component,[],this.constructor)}function n(t,e){void 0===e&&(e={});for(var i=function(t){for(var e=[],r=0;r<t.length;){var n=t[r];if("*"!==n&&"+"!==n&&"?"!==n)if("\\"!==n)if("{"!==n)if("}"!==n)if(":"!==n)if("("!==n)e.push({type:"CHAR",index:r,value:t[r++]});else{var o=1,i="";if("?"===t[a=r+1])throw new TypeError('Pattern cannot start with "?" at '+a);for(;a<t.length;)if("\\"!==t[a]){if(")"===t[a]){if(0===--o){a++;break}}else if("("===t[a]&&(o++,"?"!==t[a+1]))throw new TypeError("Capturing groups are not allowed at "+a);i+=t[a++]}else i+=t[a++]+t[a++];if(o)throw new TypeError("Unbalanced pattern at "+r);if(!i)throw new TypeError("Missing pattern at "+r);e.push({type:"PATTERN",index:r,value:i}),r=a}else{for(var s="",a=r+1;a<t.length;){var u=t.charCodeAt(a);if(!(48<=u&&u<=57||65<=u&&u<=90||97<=u&&u<=122||95===u))break;s+=t[a++]}if(!s)throw new TypeError("Missing parameter name at "+r);e.push({type:"NAME",index:r,value:s}),r=a}else e.push({type:"CLOSE",index:r,value:t[r++]});else e.push({type:"OPEN",index:r,value:t[r++]});else e.push({type:"ESCAPED_CHAR",index:r++,value:t[r++]});else e.push({type:"MODIFIER",index:r,value:t[r++]})}return e.push({type:"END",index:r,value:""}),e}(t),r=e.prefixes,n=void 0===r?"./":r,o="[^"+b(e.delimiter||"/#?")+"]+?",s=[],a=0,u=0,c="",p=function(t){if(u<i.length&&i[u].type===t)return i[u++].value},l=function(t){var e=p(t);if(void 0!==e)return e;var r=i[u],n=r.type,o=r.index;throw new TypeError("Unexpected "+n+" at "+o+", expected "+t)},f=function(){for(var t,e="";t=p("CHAR")||p("ESCAPED_CHAR");)e+=t;return e};u<i.length;){var h,d,m,_,g,v=p("CHAR"),y=p("NAME"),S=p("PATTERN");y||S?(d=v||"",-1===n.indexOf(d)&&(c+=d,d=""),c&&(s.push(c),c=""),s.push({name:y||a++,prefix:d,suffix:"",pattern:S||o,modifier:p("MODIFIER")||""})):(h=v||p("ESCAPED_CHAR"))?c+=h:(c&&(s.push(c),c=""),p("OPEN")?(d=f(),m=p("NAME")||"",_=p("PATTERN")||"",g=f(),l("CLOSE"),s.push({name:m||(_?a++:""),pattern:m&&!_?o:_,prefix:d,suffix:g,modifier:p("MODIFIER")||""})):l("END"))}return s}function b(t){return t.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function T(t){return t&&t.sensitive?"":"i"}function s(t,e,r){return function(t,e,r){void 0===r&&(r={});for(var n=r.strict,o=void 0!==n&&n,i=r.start,s=void 0===i||i,a=r.end,u=void 0===a||a,c=r.encode,p=void 0===c?function(t){return t}:c,l="["+b(r.endsWith||"")+"]|$",f="["+b(r.delimiter||"/#?")+"]",h=s?"^":"",d=0,m=t;d<m.length;d++){var _,g,v,y=m[d];"string"==typeof y?h+=b(p(y)):(_=b(p(y.prefix)),g=b(p(y.suffix)),y.pattern?(e&&e.push(y),_||g?"+"===y.modifier||"*"===y.modifier?(v="*"===y.modifier?"?":"",h+="(?:"+_+"((?:"+y.pattern+")(?:"+g+_+"(?:"+y.pattern+"))*)"+g+")"+v):h+="(?:"+_+"("+y.pattern+")"+g+")"+y.modifier:h+="("+y.pattern+")"+y.modifier):h+="(?:"+_+g+")"+y.modifier)}{var S,I;u?(o||(h+=f+"?"),h+=r.endsWith?"(?="+l+")":"$"):(S=t[t.length-1],I="string"==typeof S?-1<f.indexOf(S[S.length-1]):void 0===S,o||(h+="(?:"+f+"(?="+l+"))?"),I||(h+="(?="+f+"|"+l+")"))}return new RegExp(h,T(r))}(n(t,r),e,r)}function a(t,e,r){return t instanceof RegExp?function(t,e){if(!e)return t;for(var r=/\((?:\?<(.*?)>)?(?!\?)/g,n=0,o=r.exec(t.source);o;)e.push({name:o[1]||n++,prefix:"",suffix:"",modifier:"",pattern:""}),o=r.exec(t.source);return t}(t,e):Array.isArray(t)?(n=e,o=r,i=t.map(function(t){return a(t,n,o).source}),new RegExp("(?:"+i.join("|")+")",T(o))):s(t,e,r);var n,o,i}BITSMIST.v1.ClassUtil.inherit(t,BITSMIST.v1.Component),customElements.define("bm-app",t);function i(){}function e(){return Reflect.construct(BITSMIST.v1.Component,[],this.constructor)}function r(){return Reflect.construct(BITSMIST.v1.Component,[],this.constructor)}function o(){return Reflect.construct(BITSMIST.v1.Component,[],this.constructor)}function u(){return Reflect.construct(BITSMIST.v1.Component,[],this.constructor)}i.init=function(t,e){e._routes=[],e._specs={}},i.organize=function(t,e){var r=e.settings.get("routes");if(r)for(var n=0;n<r.length;n++)i.addRoute(e,r[n]);var o=e.settings.get("specs");return o&&Object.keys(o).forEach(function(t){e._specs[t]=o[t]}),Promise.resolve()},i.isTarget=function(t){return"*"!=t&&"beforeStart"!=t&&"afterSpecLoad"!=t?!1:!0},i.addRoute=function(t,e,r){var n=[],o={origin:e.origin,name:e.name,path:e.path,keys:n,specName:e.specName,componentName:e.componentName,re:a(e.path,n)};r?t._routes.unshift(o):t._routes.push(o)},i.loadSpec=function(t,e){var r,n=BITSMIST.v1.Util.concatPath([e,t+".js"]),o=[];return o.push(i.__loadSpecFile(n)),Promise.all(o).then(function(t){try{r=JSON.parse(t[0])}catch(t){throw new SyntaxError("Illegal json string. url="+n)}return r})},i.__loadSpecFile=function(t,e){return BITSMIST.v1.AjaxUtil.ajaxRequest({url:t,method:"GET"}).then(function(t){return t.responseText}).catch(function(t){if(e)return e})},BITSMIST.v1.ClassUtil.inherit(e,BITSMIST.v1.Component),customElements.define("bm-router",e),Object.defineProperty(e.prototype,"routeInfo",{get:function(){return this._routeInfo}}),e.prototype.start=function(t){var e=this;return t=BITSMIST.v1.Util.deepMerge({name:"Router",autoSetup:!1,organizers:{RouteOrganizer:"",PluginOrganizer:"",ComponentOrganizer:"",FileOrganizer:""}},t),BITSMIST.v1.Component.prototype.start.call(this,t).then(function(){history.replaceState(e.__getDefaultState("connect"),null,null),e._routeInfo=e.__loadRouteInfo(window.location.href),e.__initPopState();var t=e.getAttribute("data-specpath")||"";t&&e._settings.set("system.specPath",t)}).then(function(){return e.__initSpec(e._routeInfo.specName)})},e.prototype.buildUrl=function(t){var e;return t.url?e=t.url:(e=t.path?t.path:this._routeInfo.path,e+=t.query?"?"+t.query:"",e+=t.queryParameters?this.buildUrlQuery(t.queryParameters):""),e},e.prototype.buildUrlQuery=function(r){var t="";return r&&(t=Object.keys(r).reduce(function(t,e){return Array.isArray(r[e])?t+=encodeURIComponent(e)+"="+encodeURIComponent(r[e].join())+"&":r[e]&&(t+=encodeURIComponent(e)+"="+encodeURIComponent(r[e])+"&"),t},"")),t?"?"+t.slice(0,-1):""},e.prototype.loadParameters=function(){var t,e,r={};if(-1<window.location.href.indexOf("?"))for(var n=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),o=0;o<n.length;o++)e=(t=n[o].split("="))[1]?t[1].split("#")[0]:t[1],r[t[0]]=decodeURIComponent(e);return r},e.prototype.openRoute=function(t,e){this._open(t,e)},e.prototype.jumpRoute=function(t,e){var r=this.buildUrl(t);this._jump(r)},e.prototype.refreshRoute=function(t,e){return this._refresh(t,e)},e.prototype.updateRoute=function(t,e){return this._update(t,e)},e.prototype.replaceRoute=function(t){history.replaceState(this.__getDefaultState("replaceRoute"),null,this.buildUrl(t)),this._routeInfo=this.__loadRouteInfo(window.location.href)},e.prototype._open=function(t,e){var r=this;(e=Object.assign({},e)).pushState=void 0===e.pushState||e.pushState;var n=this.buildUrl(t),o=Object.assign({},this._routeInfo),i=this.__loadRouteInfo(n);this._routeInfo=this.__loadRouteInfo(n),!e.jump&&i.name&&o.name==i.name?Promise.resolve().then(function(){e.pushState&&history.pushState(r.__getDefaultState("_open.pushState"),null,n)}).then(function(){return o.specName!=i.specName?r._update(i,e):r._refresh(t,e)}).then(function(){t.dispUrl&&history.replaceState(r.__getDefaultState("_open.dispUrl"),null,t.dispUrl)}):this._jump(n)},e.prototype._jump=function(t){window.location.href=t},e.prototype._refresh=function(t,e){var r=this._routeInfo.componentName;if(this._components[r])return this._components[r].refresh({sender:this,pushState:!1})},e.prototype._update=function(t,e){var r=this;return Promise.resolve().then(function(){return r.clearOrganizers()}).then(function(){return r.__initSpec(t.specName)})},e.prototype.__loadRouteInfo=function(t){for(var e,r,n={},o=new URL(t,window.location.href),i={},s=this._routes.length-1;0<=s;s--)if(!this._routes[s].origin||this._routes[s].origin&&o.origin==this._routes[s].origin){var a=this._routes[s].path?this._routes[s].re.exec(o.pathname):[];if(a){e=this._routes[s].name,l=this._routes[s].specName?this._routes[s].specName:"",r=this._routes[s].componentName;for(var u=0;u<a.length-1;u++){i[this._routes[s].keys[u].name]=a[u+1];var c=this._routes[s].keys[u].name,p=a[u+1],l=l.replace("{{:"+c+"}}",p)}break}}return n.name=e,n.specName=l,n.componentName=r,n.url=o.href,n.path=o.pathname,n.query=o.search,n.parsedUrl=o,n.routeParameters=i,n.queryParameters=this.loadParameters(),n},e.prototype.__initPopState=function(){var n=this;window.history&&window.history.pushState&&window.addEventListener("popstate",function(t){var e,r;t.state&&(r=n._routeInfo.componentName,n._components&&n._components[r]&&(e=n._components[r].trigger("beforePopState",n)),Promise.all([e]).then(function(){n.openRoute(n.__loadRouteInfo(window.location.href),{pushState:!1})}).then(function(){var t=n._routeInfo.componentName;n._components&&n._components[t]&&n._components[t].trigger("afterPopState",n)}))})},e.prototype.__initSpec=function(e){var r=this;if(e)return Promise.resolve().then(function(){if(!r._specs[e])return i.loadSpec(e,r._settings.get("system.specPath")).then(function(t){r._specs[e]=t})}).then(function(){return r.callOrganizers("afterSpecLoad",r._specs[e])}).then(function(){return r.trigger("afterSpecLoad",r,{spec:r._specs[r._routeInfo.specName]})})},e.prototype.__getDefaultState=function(t){return t+":"+window.location.href},BITSMIST.v1.ClassUtil.inherit(r,BITSMIST.v1.Component),customElements.define("bm-setting",r),r.prototype.onAfterStart=function(t,e,r){BITSMIST.v1.Globals.settings.items=this._settings.items.settings},r.prototype.start=function(t){var e={name:"SettingManager",autoSetup:!1,events:{afterStart:{handler:this.onAfterStart}}};return t=BITSMIST.v1.Util.deepMerge(e,t),BITSMIST.v1.Component.prototype.start.call(this,t)},r.prototype.get=function(t,e){return BITSMIST.v1.Globals.settings.get(t,e)},r.prototype.set=function(t,e){BITSMIST.v1.Globals.settings.set(t,e)},BITSMIST.v1.ClassUtil.inherit(o,BITSMIST.v1.Component),customElements.define("bm-preference",o),Object.defineProperty(o.prototype,"items",{get:function(){return BITSMIST.v1.Globals.preferences.items}}),o.prototype.onBeforeSetup=function(t,e,r){var n=e.detail;return this._observers.notifySync("setup",n,n)},o.prototype.start=function(t){var e=this,r={name:"PreferenceManager",autoSetup:!1,events:{beforeSetup:{handler:this.onBeforeSetup}},organizers:{PluginOrganizer:""}};return t=BITSMIST.v1.Util.deepMerge(r,t),this._observers=new BITSMIST.v1.ObserverStore({filter:this.__isTarget.bind(this)}),BITSMIST.v1.Component.prototype.start.call(this,t).then(function(){BITSMIST.v1.Globals.preferences.items=e._settings.items.defaults}).then(function(){return e.load()}).then(function(t){BITSMIST.v1.Globals.preferences.merge(t)})},o.prototype.get=function(t,e){return BITSMIST.v1.Globals.preferences.get(t,e)},o.prototype.set=function(t,e){BITSMIST.v1.Globals.preferences.set(t,e)},o.prototype.setup=function(t){var e=this;(t=Object.assign({},t)).sender&&t.sender;return BITSMIST.v1.Pad.prototype.setup.call(this,t).then(function(){t.newPreferences&&(BITSMIST.v1.Globals.preferences.merge(t.newPreferences),e.save())})},o.prototype.register=function(t,e){this._observers.set(t.uniqueId,{object:t,targets:e})},o.prototype.deregister=function(t){this._observers.remove(t.uniqueId)},o.prototype.load=function(t){var e=t&&t.sender?t.sender:this;return this.trigger("doLoadStore",e)},o.prototype.save=function(t){var e=t&&t.sender?t.sender:this;return this.trigger("doSaveStore",e,{data:BITSMIST.v1.Globals.preferences.items})},o.prototype.__isTarget=function(t,e){for(var r=!1,n=e.targets,o=0;o<n.length;o++)if(t.newPreferences.hasOwnProperty(n[o])){r=!0;break}return r},BITSMIST.v1.ClassUtil.inherit(u,BITSMIST.v1.Component),customElements.define("bm-error",u),u.prototype.start=function(t){return t=BITSMIST.v1.Util.deepMerge({name:"ErrorManager",autoSetup:!1},t),this._observers=new BITSMIST.v1.ObserverStore,this.__initErrorListeners(),BITSMIST.v1.Component.prototype.start.call(this,t)},u.prototype.register=function(t,e){this._observers.set(t.uniqueId,{object:t,targets:e})},u.prototype.__isTarget=function(t,e,r){for(var n=!1,o=0;o<e.length;o++)e[o]&&r.name==e[o]&&(n=!0);return n},u.prototype.__initErrorListeners=function(){var i=this;window.addEventListener("unhandledrejection",function(t){var e={};return t.reason?(e.message=t.reason instanceof XMLHttpRequest?t.reason.statusText:t.reason.message,e.stack=t.reason.stack,e.object=t.reason):e.message=t,e.type=t.type,e.name=i.__getErrorName(t),e.filename="",e.funcname="",e.lineno="",e.colno="",i.__handleException(e),!1}),window.addEventListener("error",function(t,e,r,n){var o={type:"error"};return o.name=i.__getErrorName(t),o.message=t.message,o.file=t.filename,o.line=t.lineno,o.col=t.colno,t.error&&(o.stack=t.error.stack,o.object=t.error),i.__handleException(o),!1})},u.prototype.__getErrorName=function(t){var e,r,n=t.reason?t.reason:t.error?t.error:t.message;return n.name?e=n.name:n instanceof TypeError?e="TypeError":n instanceof XMLHttpRequest?e="AjaxError":n instanceof EvalError?e="EvalError":n instanceof RangeError?e="RangeError":n instanceof ReferenceError?e="ReferenceError":n instanceof SyntaxError?e="SyntaxError":n instanceof URIError?e="URIError":-1<(r=n.indexOf(":"))&&(e=n.substring(0,r)),e},u.prototype.__handleException=function(t){return this._observers.notifySync("handle",t,{error:t})};function c(){}c.init=function(t,e){e._plugins={}},c.organize=function(t,e){var r=e.settings.get("plugins");return r&&Object.keys(r).forEach(function(t){c.addPlugin(e,t,r[t])}),Promise.resolve()},c.isTarget=function(t){return"*"!=t&&"beforeStart"!=t?!1:!0},c.addPlugin=function(t,e,r){var n="className"in(r=Object.assign({},r))?r.className:e,o=BITSMIST.v1.ClassUtil.createObject(n,t,r);return t._plugins[e]=o};function p(){}p.organize=function(t,e){return p.addRouteHandler(e),Promise.resolve()},p.isTarget=function(t){return"*"!=t&&"afterAppend"!=t?!1:!0},p.addRouteHandler=function(t){t.querySelectorAll("[data-routepath]").forEach(function(o){t.addEventHandler(o,"click",function(t,e,r){var n={path:o.getAttribute("data-routepath")};document.querySelector("bm-router").openRoute(n)})})};function l(){}l.organize=function(t,e,r){var n=[],o=r.files;return o&&Object.keys(o).forEach(function(t){n.push(BITSMIST.v1.AjaxUtil.loadScript(o[t].href))}),Promise.all(n)},l.isTarget=function(t){return"*"!=t&&"afterSpecLoad"!=t?!1:!0};function f(e,t){var r=this;this._component=e,this._options=new BITSMIST.v1.Store({items:Object.assign({},this._getOptions(),t)}),this._options.set("name",this._options.get("name",this.constructor.name));var n,o=this._options.get("events",{});Object.keys(o).forEach(function(t){e.addEventHandler(e,t,o[t],null,r)}),this._options.get("expose")&&(n=this,Object.defineProperty(e.__proto__,this._options.get("expose"),{get:function(){return n}}))}var h={name:{configurable:!0},component:{configurable:!0}};h.name.get=function(){return this._options.get("name")},h.component.get=function(){return this._component},h.component.set=function(t){this._component=t},f.prototype._getOptions=function(){return{}},Object.defineProperties(f.prototype,h);function d(){this.target.push("NoRouteError")}var m=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype.onAfterError=function(t,e){return this.handle(e.detail.error)},e.prototype.handle=function(t){var e,o=this;"AjaxError"==t.name&&(e=t.object.status,Object.keys(this._options.handlers.statusCode).forEach(function(n){e==n&&Object.keys(o._options.handlers.statusCode[n]).forEach(function(t){var e=o._options.handlers.statusCode[n][t];switch(t){case"route":"appName"in e||(e.appName="");var r=e.routeInfo;Object.keys(r.queryParameters).forEach(function(t){r.queryParameters[t]=r.queryParameters[t].replace("@url@",location.href)}),document.querySelector("bm-router").openRoute(r,{jump:!0})}})}))},e.prototype._getOptions=function(){return{events:{afterError:{handler:this.onAfterError}}}},e}(f);function _(t){this._options=t||{}}d.prototype.handle=function(){if(this.container.loader.loadParameters()._redirected_by_norouteerrorhandler)throw new Error("Page not found");var t={resourceName:this.options.route.resourceName,commandName:this.options.route.commandName,parameters:this.options.route.parameters};t.parameters._redirected_by_norouteerrorhandler=!0,this.container.router.openRoute(t,{})},_.prototype.get=function(t){var e=document.cookie.split(";").reduce(function(t,e){var r=e.split("="),n=r[0],o=r[1];return n&&(t[n.trim()]=o?decodeURIComponent(o.trim()):void 0),t},{});return e[t]?JSON.parse(e[t]):{}},_.prototype.set=function(t,e,r){var n=t+"="+encodeURIComponent(JSON.stringify(e))+"; ";r=r||{},this._options&&(r=Object.assign(this._options,r)),n+=Object.keys(r).reduce(function(t,e){return t+=e+"="+r[e]+"; "},""),document.cookie=n};function g(t,e){this._name=t,this._options=e,this._data,this._parameters={}}var v=function(r){function t(t,e){r.call(this,t,e),this._cookie=new _(this._options.get("cookieOptions")),this._cookieName=this._options.get("cookieOptions.name","preferences")}return r&&(t.__proto__=r),((t.prototype=Object.create(r&&r.prototype)).constructor=t).prototype.onDoLoadStore=function(){return this._cookie.get(this._cookieName)},t.prototype.onDoSaveStore=function(t,e){this._cookie.set(this._cookieName,e.detail.data)},t.prototype._getOptions=function(){return{events:{doLoadStore:this.onDoLoadStore,doSaveStore:this.onDoSaveStore}}},t}(f);g.prototype.get=function(t,e){var r=this,n="GET",o=this._getOption("headers",n),i=this._getOption("options",n),s=this._getOption("url",n),a=s.dataType,u=this._buildApiUrl(this._name,t,e,s);return BITSMIST.v1.AjaxUtil.ajaxRequest({url:u,method:n,headers:o,options:i}).then(function(t){return r._convertResponseData(t.responseText,a)})},g.prototype.delete=function(t,e){var r=this,n="DELETE",o=this._getOption("headers",n),i=this._getOption("options",n),s=this._getOption("url",n),a=s.dataType,u=this._buildApiUrl(this._name,t,e,s);return BITSMIST.v1.AjaxUtil.ajaxRequest({url:u,method:n,headers:o,options:i}).then(function(t){return r._convertResponseData(t.responseText,a)})},g.prototype.insert=function(t,e,r){var n=this,o="POST",i=this._getOption("headers",o),s=this._getOption("options",o),a=this._getOption("url",o),u=a.dataType,c=this._buildApiUrl(this._name,t,r,a);return BITSMIST.v1.AjaxUtil.ajaxRequest({url:c,method:o,headers:i,options:s,data:this._convertRequestData(e,u)}).then(function(t){return n._convertResponseData(t.responseText,u)})},g.prototype.update=function(t,e,r){var n=this,o="PUT",i=this._getOption("headers",o),s=this._getOption("options",o),a=this._getOption("url",o),u=a.dataType,c=this._buildApiUrl(this._name,t,r,a);return BITSMIST.v1.AjaxUtil.ajaxRequest({url:c,method:o,headers:i,options:s,data:this._convertRequestData(e,u)}).then(function(t){return n._convertResponseData(t.responseText,u)})},g.prototype._convertRequestData=function(t,e){var r;switch(e){case"json":default:r=JSON.stringify(t)}return r},g.prototype._convertResponseData=function(t,e){var r;switch(e){case"json":default:r=JSON.parse(t)}return r},g.prototype._getOption=function(t,e){var r="settings"in this._options?this._options.settings:{},n=t in r&&"COMMON"in r[t]?r[t].COMMON:{},o=t in r&&e in r[t]?r[t][e]:{};return Object.assign(n,o)},g.prototype._buildApiUrl=function(t,e,r,n){var o=n.baseUrl,i=n.scheme,s=n.host,a=n.dataType,u=n.version;return(n.format?n.format:"@baseUrl@@query@").replace("@scheme@",i).replace("@host@",s).replace("@baseUrl@",o).replace("@resource@",t).replace("@id@",e).replace("@dataType@",a).replace("@query@",this._buildUrlQuery(r)).replace("@version@",u)},g.prototype._buildUrlQuery=function(r){var t="";return r&&(t=Object.keys(r).reduce(function(t,e){return Array.isArray(r[e])?t+=encodeURIComponent(e)+"="+encodeURIComponent(r[e].join())+"&":r[e]&&(t+=encodeURIComponent(e)+"="+encodeURIComponent(r[e])+"&"),t},"")),t?"?"+t.slice(0,-1):""};var y=function(o){function t(t,e){var r,n;o.call(this,t,e),this._items,"items"in e&&(n="object"==typeof e.items?e.items:(r=window,e.items.split(".").forEach(function(t){if(!(r=r[t]))throw new ReferenceError("Master not found. Master="+e.items)}),r),this._items=this.__reshapeItems(n))}o&&(t.__proto__=o),(t.prototype=Object.create(o&&o.prototype)).constructor=t;var e={items:{configurable:!0}};return e.items.get=function(){return this._items},t.prototype.load=function(){var e=this;return this.get("list").then(function(t){e._items=e.__reshapeItems(t.data)})},t.prototype.getValue=function(t){var e=t,r=this._options.title;return this._items&&t in this._items&&(e=this._items[t][r]),e},t.prototype.getItem=function(t){var e;return this._items&&t in this._items&&(e=this._items[t]),e},t.prototype.filter=function(r){var n=this;return Object.keys(this._items).reduce(function(t,e){return r(n._items[e])&&(t[e]=n._items[e]),t},{})},t.prototype.__reshapeItems=function(t){var n=this._options.id,o=this._options.title;return t.reduce(function(t,e){var r=e[n];return t[r]=e,t[r].title=e[o],t},{})},Object.defineProperties(t.prototype,e),t}(g),S=function(r){function t(t,e){r.call(this,t,e),this._masters={}}return r&&(t.__proto__=r),((t.prototype=Object.create(r&&r.prototype)).constructor=t).prototype.onAfterStart=function(){return this.__initMasters(this._component.settings.get("masters"))},t.prototype.onAfterSpecLoad=function(t,e){return this.__initMasters(BITSMIST.v1.Util.safeGet(e.detail,"spec.masters"))},t.prototype.__initMasters=function(e){var r,n=this,o=[];return e&&((r=this._component.settings.get("ajaxUtil",{})).url.COMMON.baseUrl=this._component.settings.get("system.apiBaseUrl",""),Object.keys(e).forEach(function(t){n._masters[t]=new y(t,Object.assign({settings:r},e[t])),e[t].autoLoad?o.push(n._masters[t].load().then(function(){n[t]=n._masters[t]})):n[t]=n._masters[t]})),Promise.all(o)},t.prototype._getOptions=function(){return{events:{afterStart:this.onAfterStart,afterSpecLoad:this.onAfterSpecLoad}}},t}(f),I=function(o){function t(t,e){var r=this;o.call(this,t,e),this._options.set("settings",this._component.settings.get("ajaxUtil","")),this._options.set("settings.url.COMMON.baseUrl",this._component.settings.get("system.apiBaseUrl","")),this._resources={},this._defaultResourceName;var n=this._options.get("resources",[]);Object.keys(n).forEach(function(t){var e=n[t];r.addResource(e,{settings:r._options.get("settings",{})})}),this.switchResource(n[0])}return o&&(t.__proto__=o),((t.prototype=Object.create(o&&o.prototype)).constructor=t).prototype.addResource=function(t,e){this._resources[t]=new g(t,Object.assign({settings:e.settings})),this[t]=this._resources[t]},t.prototype.switchResource=function(t){this._defaultResourceName=t},t.prototype.onDoFetch=function(t,e){var r=this,n=BITSMIST.v1.Util.safeGet(e.detail.target,"id"),o=BITSMIST.v1.Util.safeGet(e.detail.target,"parameters");if(BITSMIST.v1.Util.safeGet(e.detail.options,"autoLoad",this._options.get("autoLoad")))return this._resources[this._defaultResourceName].get(n,o).then(function(t){r._component.data=t,"items"in r._component?r._component.items=r._options.get("itemsGetter",function(t){return t.data})(t):"item"in r._component&&(r._component.item=r._options.get("itemGetter",function(t){return t.data[0]})(t))})},t.prototype.onDoSubmit=function(t,e){var r=this,n=BITSMIST.v1.Util.safeGet(e.detail.target,"id"),o=(BITSMIST.v1.Util.safeGet(e.detail.target,"parameters"),BITSMIST.v1.Util.safeGet(e.detail,"items"));return Promise.resolve().then(function(){return n?r._resources[r._defaultResourceName].update(n,{items:o}):r._resources[r._defaultResourceName].insert(n,{items:o})})},t.prototype._getOptions=function(){return{events:{doFetch:this.onDoFetch,doSubmit:this.onDoSubmit}}},t}(f);function w(){}function M(){}function E(t){var e=Reflect.construct(BITSMIST.v1.Pad,[t],this.constructor);return e._id,e._parameters,e._item={},e.__cancelSubmit=!1,e._target={},e}function O(){return Reflect.construct(BITSMIST.v1.Pad,[],this.constructor)}w.format=function(t,e,r){var n=r;switch(e.toLowerCase()){case"yyyy/mm/dd":n=w.formatDate(e,n);break;case"price":n=w.formatPrice(e,n)}return n},w.formatPrice=function(t,e){return e?"¥"+String(parseInt(e)).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,"):""},w.formatNumber=function(t){return t?String(parseInt(t)).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,"):""},w.formatDate=function(t,e){var r="";return e&&8==e.length&&(r=e.substr(0,4)+"/"+e.substr(4,2)+"/"+e.substr(6,2)),r},w.deformat=function(t,e,r){var n=r;switch(e){case"yyyy/mm/dd":n=w.deformatDate(e,r);break;case"price":n=w.deformatPrice(e,r)}return n},w.deformatPrice=function(t,e){var r="";return e&&(r=e.replace(/,/g,"").replace(/\//g,"").replace(/\\/g,"").replace("¥","")),r},w.deformatDate=function(t,e){var r="";return e&&(r=e.replace(/,/g,"").replace(/\//g,"").replace(/\\/g,"")),r},w.getNow=function(t){t=t||"-";var e=new Date;return e.getFullYear()+t+("00"+(e.getMonth()+1)).slice(-2)+t+("00"+e.getDate()).slice(-2)+" "+("00"+e.getHours()).slice(-2)+":"+("00"+e.getMinutes()).slice(-2)+":"+("00"+e.getSeconds()).slice(-2)},w.getToday=function(t){t=void 0===t?"-":t;var e=new Date;return e.getFullYear()+t+("00"+(e.getMonth()+1)).slice(-2)+t+("00"+e.getDate()).slice(-2)},w.sanitize=function(t){return"string"==typeof t?t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"):t},M.setFields=function(t,o,i){var s=this,e=t.querySelectorAll("[data-bm-field]");Array.prototype.concat([t],Array.prototype.slice.call(e,0)).forEach(function(t){var e,r,n=t.getAttribute("data-bm-field");n in o&&(t.hasAttribute("data-bm-master")?(e=t.getAttribute("data-bm-master"),r=s.getMasterValue(i,e,o[n]),s.setValue(t,r)):s.setValue(t,o[n]))})},M.getFields=function(t,e){var o=this,i={};e=e||"";var r=t.querySelectorAll(e+" [data-bm-formitem]");return(r=Array.prototype.slice.call(r,0)).forEach(function(t){var e,r=t.getAttribute("data-bm-field"),n=o.getValue(t);Array.isArray(i[r])?n&&i[r].push(n):i[r]?n&&((e=[]).push(i[r]),e.push(n),i[r]=e):i[r]=n}),i},M.clearFields=function(t,e){e=e||"";var r=t.querySelectorAll(e+" input");(r=Array.prototype.slice.call(r,0)).forEach(function(t){switch(t.type.toLowerCase()){case"search":case"text":case"number":t.value="";break;case"checkbox":case"radio":t.checked=!1}}),r=t.querySelectorAll(e+" select"),(r=Array.prototype.slice.call(r,0)).forEach(function(t){t.selectedIndex=-1})},M.buildFields=function(t,e,o){var r=t.querySelectorAll("[data-bm-field='"+e+"']");(r=Array.prototype.slice.call(r,0)).forEach(function(n){var t,e,r;"select"==n.tagName.toLowerCase()?(n.options.length=0,"emptyItem"in o&&(t="text"in o.emptyItem?o.emptyItem.text:"",e="value"in o.emptyItem?o.emptyItem.value:"",(r=document.createElement("option")).text=t,r.value=e,r.setAttribute("selected",""),n.appendChild(r)),Object.keys(o.items).forEach(function(t){var e=document.createElement("option");e.text=o.items[t].title,e.value=t,n.appendChild(e)})):Object.keys(o.items).forEach(function(t){var e=document.createElement("label"),r=document.createElement("input");r.type="radio",r.id=key,r.name=key,r.value=t,r.setAttribute("data-bm-field",key),r.setAttribute("data-bm-formitem",""),e.appendChild(r),e.appendChild(document.createTextNode(o.items[t].title)),n.appendChild(e)})})},M.getMasterValue=function(t,e,r){var n=r;return t&&e in t&&(n=t[e].getValue(r)),n},M.setValue=function(t,e){null!==e&&null!=e||(e=""),t.hasAttribute("data-bm-format")&&(e=w.format("",t.getAttribute("data-bm-format"),e));var r=w.sanitize(e),n=t.getAttribute("data-bm-target");if(n)for(var o=n.split(","),i=0;i<o.length;i++){var s=o[i].toLowerCase();switch(s){case"html":t.innerHTML=e;break;case"href":case"src":case"rel":"http"!=e.substring(0,4)&&"/"!=e.substring(0,1)||t.setAttribute(s,e);break;default:var a=(a=t.getAttribute(s))?a+" "+e:r;t.setAttribute(s,a)}}else if(t.hasAttribute("value"))"input"==t.tagName.toLowerCase()&&"checkbox"==t.type.toLowerCase()||"input"==t.tagName.toLowerCase()&&"radio"==t.type.toLowerCase()?Array.isArray(e)?-1<e.indexOf(t.getAttribute("value"))&&(t.checked=!0):t.getAttribute("value")==e&&(t.checked=!0):t.setAttribute("value",w.sanitize(e));else if("select"==t.tagName.toLowerCase())t.value=e;else if("fieldset"!=t.tagName.toLowerCase())if("input"==t.tagName.toLowerCase())switch(t.type.toLowerCase()){case"number":case"search":case"text":t.value=e;break;case"checkbox":t.checked=!!e;break;case"radio":t.value==e&&(t.checked=!0)}else t.innerText=e;var u=document.createEvent("HTMLEvents");u.initEvent("change",!0,!0),t.dispatchEvent(u)},M.getValue=function(t){var e=void 0;switch(t.tagName.toLowerCase()){case"input":switch(t.type.toLowerCase()){case"radio":case"checkbox":t.checked&&(e=t.hasAttribute("value")?t.getAttribute("value"):t.checked);break;default:e=t.value}break;case"select":e=t.value;break;default:t.hasAttribute("selected")&&(e=t.getAttribute("value"))}return t.hasAttribute("data-bm-format")&&(e=BITSMIST.v1.FormatterUtil.deformat("",t.getAttribute("data-bm-format"),e)),e},M.reportValidity=function(t){var e=!0,r=t.querySelectorAll("input");return(r=Array.prototype.slice.call(r,0)).forEach(function(t){switch(t.getAttribute("type")){case"number":(t.validity&&0==t.validity.valid||isNaN(t.value))&&(t.style.border="solid 3px red",e=!1)}}),e},BITSMIST.v1.ClassUtil.inherit(E,BITSMIST.v1.Pad),Object.defineProperty(E.prototype,"item",{get:function(){return this._item},set:function(t){this._item=t}}),Object.defineProperty(E.prototype,"data",{get:function(){return this._data},set:function(t){this._data=t}}),E.prototype.build=function(e){var r=this;Object.keys(e).forEach(function(t){M.buildFields(r,t,e[t])})},E.prototype.fill=function(t){var e=this,r=(t=Object.assign({},t)).sender?t.sender:this;return this._target.id="id"in t?t.id:this._target.id,this._target.parameters="parameters"in t?t.parameters:this._target.parameters,BITSMIST.v1.Util.safeGet(t,"autoClear",this._settings.get("autoClear"))&&this.clear(),Promise.resolve().then(function(){return e.trigger("doTarget",r,{target:e._target,options:t})}).then(function(){return e.trigger("beforeFetch",r,{target:e._target,options:t})}).then(function(){return e.trigger("doFetch",r,{target:e._target,options:t})}).then(function(){return e.trigger("afterFetch",r,{target:e._target,options:t})}).then(function(){return e.trigger("beforeFill",r)}).then(function(){return M.setFields(e,e._item,e.masters),e.trigger("afterFill",r)})},E.prototype.clear=function(t){return M.clearFields(this,t)},E.prototype.validate=function(t){var r=this,n=(t=Object.assign({},t)).sender?t.sender:this;return Promise.resolve().then(function(){return r.trigger("beforeValidate",n)}).then(function(){var t=!0,e=r.querySelector("form");return r.settings.get("autoValidate")&&(t=e&&e.reportValidity?e.reportValidity():M.reportValidity(r)),t||(r.__cancelSubmit=!0),r.trigger("afterValidate",n)})},E.prototype.submit=function(t){var e=this,r=(t=Object.assign({},t)).sender?t.sender:this;return delete t.sender,this.__cancelSubmit=!1,this._item=this.getFields(),Promise.resolve().then(function(){return e.validate()}).then(function(){return e.trigger("beforeSubmit",r)}).then(function(){if(!e.__cancelSubmit){var t=e.settings.get("itemGetter",function(t){return[t]})(e._item);return e.trigger("doSubmit",r,{target:e._target,items:t})}}).then(function(){var t=e.settings.get("itemGetter",function(t){return[t]})(e._item);return e.trigger("afterSubmit",r,{target:e._target,items:t})})},E.prototype.getFields=function(){return M.getFields(this)},BITSMIST.v1.ClassUtil.inherit(O,BITSMIST.v1.Pad),Object.defineProperty(O.prototype,"row",{get:function(){return this._row}}),Object.defineProperty(O.prototype,"items",{get:function(){return this._items},set:function(t){this._items=t}}),Object.defineProperty(O.prototype,"data",{get:function(){return this._data},set:function(t){this._data=t}}),O.prototype.onListAfterAppend=function(t,e,r){this._listRootNode=this.querySelector(this._settings.get("listRootNode"));var n=this._settings.get("components")[this._settings.get("row")].className?this._settings.get("components")[this._settings.get("row")].className:this._settings.get("row");return this._row=BITSMIST.v1.ClassUtil.createObject(n),(this._row._parent=this)._row.start()},O.prototype.clear=function(){this._listRootNode.innerHTML=""},O.prototype.fill=function(t){var e=this,r=(t=Object.assign({},t)).sender?t.sender:this,n=this._settings.get("async")?this._buildAsync:this._buildSync,o=document.createDocumentFragment();return this._rows=[],this._target.id="id"in t?t.id:this._target.id,this._target.parameters="parameters"in t?t.parameters:this._target.parameters,Promise.resolve().then(function(){return e.trigger("doTarget",e,{target:e._target,options:t})}).then(function(){return e.trigger("beforeFetch",r,{target:e._target,options:t})}).then(function(){return e.trigger("doFetch",r,{target:e._target,options:t})}).then(function(){return e.trigger("afterFetch",r,{target:e._target,options:t})}).then(function(){return e.trigger("beforeFill",r)}).then(function(){if(e._items)return n.call(e,o)}).then(function(){BITSMIST.v1.Util.safeGet(t,"autoClear",e._settings.get("autoClear"))&&e.clear()}).then(function(){e._listRootNode.appendChild(o)}).then(function(){return e.trigger("afterFill",r)})},O.prototype.start=function(t){return this._id,this._parameters,this._target={},this._data,this._items,this._listRootNode,this._row,this._rows,t=Object.assign({},t,{events:{afterAppend:[{handler:this.onListAfterAppend}]}}),BITSMIST.v1.Pad.prototype.start.call(this,t)},O.prototype._buildSync=function(t){for(var e=0;e<this._items.length;e++)this.__appendRowSync(t,e,this._items[e])},O.prototype._buildAsync=function(e){for(var r=this,n=Promise.resolve(),t=0;t<r._items.length;t++)!function(t){n=n.then(function(){return r.__appendRowAsync(e,t,r._items[t])})}(t);return n},O.prototype.__appendRowAsync=function(t,e,r){var n=this,o=this._row.cloneTemplate();t.appendChild(o),this._rows.push(o);var i=this._row.getEventHandler(this._row.settings.get("events.click"));return i&&this._row.addEventHandler(o,"click",i,{item:r,no:e,element:o}),Object.keys(this._row.settings.get("elements",{})).forEach(function(t){n._row.setHtmlEventHandlers(t,{item:ttem,no:e,element:o},o)}),Promise.resolve().then(function(){return n._row.trigger("beforeFillRow",n,{item:r,no:e,element:o})}).then(function(){M.setFields(o,r,n.masters)}).then(function(){return n._row.trigger("afterFillRow",n,{item:r,no:e,element:o})})},O.prototype.__appendRowSync=function(t,e,r){var n=this,o=this._row.cloneTemplate();t.appendChild(o),this._rows.push(o);var i=this._row.getEventHandler(this._row.settings.get("events.click"));i&&this._row.addEventHandler(o,"click",i,{item:r,no:e,element:o}),Object.keys(this._row.settings.get("elements",{})).forEach(function(t){n._row.setHtmlEventHandlers(t,{item:r,no:e,element:o},o)}),this._row.triggerSync("beforeFillRow",this,{item:r,no:e,element:o}),M.setFields(o,r,this.masters),this.row.triggerSync("afterFillRow",this,{item:r,no:e,element:o})};var R=function(r){function t(t,e){r.call(this,t,e),this.__isComposing=!1}return r&&(t.__proto__=r),((t.prototype=Object.create(r&&r.prototype)).constructor=t).prototype.onAfterAppend=function(){var t=this._options.get("features.defaultKeys");t&&(this._component.addEventHandler(this._component,"keydown",this.onKeyDown,t,this),this._component.addEventHandler(this._component,"keypress",this.onKeyPress,t,this),this._component.addEventHandler(this._component,"compositionstart",this.onCompositionStart,t,this),this._component.addEventHandler(this._component,"compositionend",this.onCompositionEnd,t,this));var e=this._options.get("features.defaultButtons");e&&(this.__initElements(e.submit,this.onDefaultSubmit),this.__initElements(e.cancel,this.onDefaultCancel),this.__initElements(e.clear,this.onDefaultClear))},t.prototype.onKeyDown=function(t,e,r){var n=e.key?e.key:this.__getKeyfromKeyCode(e.keyCode);switch(n="esc"==(n=n.toLowerCase())?"escape":n){case"escape":this.onKeyPress(t,e,r)}},t.prototype.onKeyPress=function(t,e,r){var n;this.__isComposing||229==e.keyCode||(n="esc"==(n=(n=e.key?e.key:this.__getKeyfromKeyCode(e.keyCode)).toLowerCase())?"escape":n,r.options.submit&&n==r.options.submit.key?this.onDefaultSubmit(t,e,{options:r.options.submit}):r.options.cancel&&n==r.options.cancel.key?this.onDefaultCancel(t,e,{options:r.options.cancel}):r.options.clear&&n==r.options.clear.key&&this.onDefaultClear(t,e,{options:r.options.clear}))},t.prototype.onCompositionStart=function(){this.__isComposing=!0},t.prototype.onCompositionEnd=function(){this.__isComposing=!1},t.prototype.onDefaultSubmit=function(t,e,r){var n=this;this._component.submit().then(function(){n._component.__cancelSubmit||(n._component._isModal&&(n._component._modalResult.result=!0),r&&r.options.autoClose&&n._component.close())})},t.prototype.onDefaultCancel=function(){this._component.close()},t.prototype.onDefaultClear=function(t,e,r){var n;r&&r.options.target&&(n=t.getAttribute(r.options.target)),this._component.clear(n)},t.prototype.__getKeyfromKeyCode=function(t){var e;switch(t){case 13:e="Enter";break;default:e=String.fromCharCode(t)}return e},t.prototype.__initElements=function(e,r){var t,n=this;e&&(t=this._component.querySelectorAll(e.rootNode),(t=Array.prototype.slice.call(t,0)).forEach(function(t){n._component.addEventHandler(t,"click",r,e,n)}))},t.prototype._getOptions=function(){return{events:{afterAppend:this.onAfterAppend}}},t}(f),A=function(r){function t(t,e){r.call(this,"authentications",e)}return r&&(t.__proto__=r),((t.prototype=Object.create(r&&r.prototype)).constructor=t).prototype.authenticate=function(r,n,o){var i=this;return new Promise(function(t,e){i.get("list",{user:r,password:n}).then(function(t){0<t.result.resultCount?o&&"redirect"in o&&(location.href=decodeURI(o.redirect)):e("login failed")})})},t}(g);window.BITSMIST=window.BITSMIST||{},window.BITSMIST.v1=window.BITSMIST.v1||{},window.BITSMIST.v1.App=t,window.BITSMIST.v1.Router=e,window.BITSMIST.v1.SettingManager=r,window.BITSMIST.v1.PreferenceManager=o,window.BITSMIST.v1.ErrorManager=u,BITSMIST.v1.Globals.organizers.set("PluginOrganizer",{object:c,targets:"plugins",order:1e3}),BITSMIST.v1.Globals.organizers.set("RouteOrganizer",{object:i,targets:"routes",order:1100}),BITSMIST.v1.Globals.organizers.set("RouteHandlerOrganizer",{object:p,targets:"",order:1200}),BITSMIST.v1.Globals.organizers.set("FileOrganizer",{object:l,targets:"files",order:139}),window.BITSMIST.v1.Plugin=f,window.BITSMIST.v1.AjaxErrorHandler=m,window.BITSMIST.v1.NoRouteErrorHandler=d,window.BITSMIST.v1.CookieStoreHandler=v,window.BITSMIST.v1.MasterHandler=S,window.BITSMIST.v1.ResourceHandler=I,window.BITSMIST.v1.Form=E,window.BITSMIST.v1.List=O,window.BITSMIST.v1.DefaultkeyHandler=R,window.BITSMIST.v1.AuthenticationUtil=A,window.BITSMIST.v1.FormatterUtil=w,window.BITSMIST.v1.MasterUtil=y,window.BITSMIST.v1.ResourceUtil=g}();

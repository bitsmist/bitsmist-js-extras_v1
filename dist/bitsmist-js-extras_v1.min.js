!function(){"use strict";var e=function(e){function t(t){e.call(this,t),this._observers=[]}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.set=function(e,t){this.get(e)!=t&&(BITSMIST.v1.Util.safeSet(this._items,e,t),this.notifyAsync(e))},t.prototype.subscribe=function(e,t,r){if("function"!=typeof t)throw TypeError("Notification handler is not a function. id="+e);this._observers.push({id:e,handler:t,options:r})},t.prototype.unsubscribe=function(e){for(var t=0;t<this._observers.length;t++)if(this._obvservers[t].id==e){this._observers.splice(t,1);break}},t.prototype.notify=function(e){for(var t=this,r=[],n=arguments.length-1;n-- >0;)r[n]=arguments[n+1];for(var o=Promise.resolve(),i=function(n){o=o.then((function(){var o,i;if((o=t)._filter.apply(o,[e,t._observers[n].options].concat(r)))return(i=t._observers[n]).handler.apply(i,[e].concat(r))}))},s=0;s<t._observers.length;s++)i(s);return o},t.prototype.notifyAsync=function(e){for(var t,r,n=[],o=arguments.length-1;o-- >0;)n[o]=arguments[o+1];for(var i=0;i<this._observers.length;i++)(t=this)._filter.apply(t,[e,this._observers[i].options].concat(n))&&(r=this._observers[i]).handler.apply(r,[e].concat(n))},t}(BITSMIST.v1.Store),t=function(){};t.setElementValue=function(e,t){null!==t&&null!=t||(t="");var r=t,n=e.getAttribute("bm-bindtarget");if(n)for(var o=n.split(","),i=0;i<o.length;i++){var s=o[i].toLowerCase();switch(s){case"text":e.innerText=t;break;case"html":e.innerHTML=t;break;case"href":case"src":case"rel":"http"!=t.substring(0,4)&&"/"!=t.substring(0,1)||e.setAttribute(s,t);break;default:var a=e.getAttribute(s);a=a?a+" "+t:r,e.setAttribute(s,a)}}else if(e.hasAttribute("value"))("input"==e.tagName.toLowerCase()&&"checkbox"==e.type.toLowerCase()||"input"==e.tagName.toLowerCase()&&"radio"==e.type.toLowerCase())&&(Array.isArray(t)?t.indexOf(e.getAttribute("value"))>-1&&(e.checked=!0):e.getAttribute("value")==t&&(e.checked=!0));else if("select"==e.tagName.toLowerCase())e.value=t;else if("fieldset"==e.tagName.toLowerCase());else if("input"==e.tagName.toLowerCase())switch(e.type.toLowerCase()){case"number":case"search":case"text":e.value=t;break;case"checkbox":e.checked=!!t;break;case"radio":e.value==t&&(e.checked=!0)}else e.innerText=t;var c=document.createEvent("HTMLEvents");c.initEvent("change",!0,!0),e.dispatchEvent(c)},t.getElementValue=function(e){var t=void 0;switch(e.tagName.toLowerCase()){case"input":switch(e.type.toLowerCase()){case"radio":case"checkbox":e.checked&&(t=e.hasAttribute("value")?e.getAttribute("value"):e.checked);break;default:t=e.value}break;case"select":t=e.value;break;default:e.hasAttribute("selected")&&(t=e.getAttribute("value"))}return t},t.build=function(e,t){if("select"==e.tagName.toLowerCase()){if(e.options.length=0,"emptyItem"in t){var r="text"in t.emptyItem?t.emptyItem.text:"",n="value"in t.emptyItem?t.emptyItem.value:"",o=document.createElement("option");o.text=r,o.value=n,o.setAttribute("selected",""),e.appendChild(o)}Object.keys(t.items).forEach((function(r){var n=document.createElement("option");n.text=t.items[r].title,n.value=r,e.appendChild(n)}))}else Object.keys(t.items).forEach((function(r){var n=document.createElement("label"),o=document.createElement("input");o.type="radio",o.id=key,o.name=key,o.value=r,o.setAttribute("bm-bind",key),n.appendChild(o),n.appendChild(document.createTextNode(t.items[r].title)),e.appendChild(n)}))};var r=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),r.prototype=Object.create(e&&e.prototype),r.prototype.constructor=r,r.prototype.bindTo=function(e){var r=this,n=e.getAttribute("bm-bind");if(t.setElementValue(e,this.get(n)),!!(!e.__bm_bindinfo||!e.__bm_bindinfo.bound)&&BITSMIST.v1.Util.safeGet(this._options,"2way",!0)){this.subscribe(n,(function(){t.setElementValue(e,r.get(n))}));var o=BITSMIST.v1.Util.safeGet(this._options,"eventName","change");e.addEventListener(o,function(){r.set(n,t.getElementValue(e))}.bind(this)),e.__bm_bindinfo={bound:!0}}},r}(e),n=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.globalInit=function(){t.__initErrorListeners(),t._observers=new BITSMIST.v1.ObservableStore({filter:t.__filter})},t.organize=function(e,r,n){return r.settings.get("errors")&&t._observers.subscribe(r.uniqueId,r.trigger.bind(r),{component:r}),n},t.__filter=function(e,t,r,n){for(var o=!1,i=t.component.settings.get("errors.targets"),s=0;s<i.length;s++)if(n.error.name==i[s]){o=!0;break}return o},t.__initErrorListeners=function(){window.addEventListener("unhandledrejection",(function(e){var r={};return e.reason?e.reason instanceof XMLHttpRequest?(r.message=e.reason.statusText,r.stack=e.reason.stack,r.object=e.reason):(r.message=e.reason.message,r.object=e.reason):r.message=e,r.type=e.type,r.name=t.__getErrorName(e),r.filename="",r.funcname="",r.lineno="",r.colno="",t.__handleException(r),!1})),window.addEventListener("error",(function(e,r,n,o){var i={type:"error"};return i.name=t.__getErrorName(e),i.message=e.message,i.file=e.filename,i.line=e.lineno,i.col=e.colno,e.error&&(i.stack=e.error.stack,i.object=e.error),t.__handleException(i),!1}))},t.__getErrorName=function(e){var t,r;if((r=e.reason instanceof XMLHttpRequest||e.reason?e.reason:e.error?e.error:e.message).name)t=r.name;else if(r instanceof TypeError)t="TypeError";else if(r instanceof XMLHttpRequest)t="AjaxError";else if(r instanceof EvalError)t="EvalError";else if(r instanceof RangeError)t="RangeError";else if(r instanceof ReferenceError)t="ReferenceError";else if(r instanceof SyntaxError)t="SyntaxError";else if(r instanceof URIError)t="URIError";else{var n=r.indexOf(":");n>-1&&(t=r.substring(0,n))}return t},t.__handleException=function(e){return t._observers.notifyAsync("error",t,{error:e})},t}(BITSMIST.v1.Organizer),o=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.init=function(e,t,r){t._plugins={}},t.organize=function(e,r,n){var o=r.settings.get("plugins");return o&&Object.keys(o).forEach((function(e){t._addPlugin(r,e,o[e])})),n},t._addPlugin=function(e,t,r){var n,o="className"in(r=Object.assign({},r))?r.className:t;return n=BITSMIST.v1.ClassUtil.createObject(o,e,r),e._plugins[t]=n,n},t}(BITSMIST.v1.Organizer),i=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.organize=function(e,t,r){var n=[],o=r.files;return o&&Object.keys(o).forEach((function(e){n.push(BITSMIST.v1.AjaxUtil.loadScript(o[e].href))})),Promise.all(n).then((function(){return r}))},t}(BITSMIST.v1.Organizer),s=function(e,t){this._name=e,this._options=t,this._data,this._parameters={}};s.prototype.get=function(e,t){var r=this,n="GET",o=this._getOption("headers",n),i=this._getOption("options",n),s=this._getOption("url",n),a=s.dataType,c=this._buildApiUrl(this._name,e,t,s);return BITSMIST.v1.AjaxUtil.ajaxRequest({url:c,method:n,headers:o,options:i}).then((function(e){return r._convertResponseData(e.responseText,a)}))},s.prototype.delete=function(e,t){var r=this,n="DELETE",o=this._getOption("headers",n),i=this._getOption("options",n),s=this._getOption("url",n),a=s.dataType,c=this._buildApiUrl(this._name,e,t,s);return BITSMIST.v1.AjaxUtil.ajaxRequest({url:c,method:n,headers:o,options:i}).then((function(e){return r._convertResponseData(e.responseText,a)}))},s.prototype.insert=function(e,t,r){var n=this,o="POST",i=this._getOption("headers",o),s=this._getOption("options",o),a=this._getOption("url",o),c=a.dataType,u=this._buildApiUrl(this._name,e,r,a);return BITSMIST.v1.AjaxUtil.ajaxRequest({url:u,method:o,headers:i,options:s,data:this._convertRequestData(t,c)}).then((function(e){return n._convertResponseData(e.responseText,c)}))},s.prototype.update=function(e,t,r){var n=this,o="PUT",i=this._getOption("headers",o),s=this._getOption("options",o),a=this._getOption("url",o),c=a.dataType,u=this._buildApiUrl(this._name,e,r,a);return BITSMIST.v1.AjaxUtil.ajaxRequest({url:u,method:o,headers:i,options:s,data:this._convertRequestData(t,c)}).then((function(e){return n._convertResponseData(e.responseText,c)}))},s.prototype._convertRequestData=function(e,t){var r;switch(t){case"json":default:r=JSON.stringify(e)}return r},s.prototype._convertResponseData=function(e,t){var r;switch(t){case"json":default:r=JSON.parse(e)}return r},s.prototype._getOption=function(e,t){var r="settings"in this._options?this._options.settings:{},n=e in r&&"COMMON"in r[e]?r[e].COMMON:{},o=e in r&&t in r[e]?r[e][t]:{};return Object.assign(n,o)},s.prototype._buildApiUrl=function(e,t,r,n){var o=n.baseUrl,i=n.scheme,s=n.host,a=n.dataType,c=n.version;return(n.format?n.format:"@baseUrl@@query@").replace("@scheme@",i).replace("@host@",s).replace("@baseUrl@",o).replace("@resource@",e).replace("@id@",t).replace("@dataType@",a).replace("@query@",this._buildUrlQuery(r)).replace("@version@",c)},s.prototype._buildUrlQuery=function(e){var t="";return e&&(t=Object.keys(e).reduce((function(t,r){return Array.isArray(e[r])?t+=encodeURIComponent(r)+"="+encodeURIComponent(e[r].join())+"&":e[r]&&(t+=encodeURIComponent(r)+"="+encodeURIComponent(e[r])+"&"),t}),"")),t?"?"+t.slice(0,-1):""};var a=function(e){function t(t,r){if(e.call(this,t,r),this._items,"items"in r){var n;if("object"==typeof r.items)n=r.items;else{var o=window;r.items.split(".").forEach((function(e){if(!(o=o[e]))throw new ReferenceError("Master not found. Master="+r.items)})),n=o}this._items=this.__reshapeItems(n)}}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={items:{configurable:!0}};return r.items.get=function(){return this._items},t.prototype.load=function(){var e=this;return this.get("list").then((function(t){e._items=e.__reshapeItems(t.data)}))},t.prototype.getValue=function(e){var t=e,r=this._options.title;return this._items&&e in this._items&&(t=this._items[e][r]),t},t.prototype.getItem=function(e){var t;return this._items&&e in this._items&&(t=this._items[e]),t},t.prototype.filter=function(e){var t=this;return Object.keys(this._items).reduce((function(r,n){return e(t._items[n])&&(r[n]=t._items[n]),r}),{})},t.prototype.__reshapeItems=function(e){var t=this._options.id,r=this._options.title;return e.reduce((function(e,n){var o=n[t];return e[o]=n,e[o].title=n[r],e}),{})},Object.defineProperties(t.prototype,r),t}(s),c=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.init=function(e,t,r){Object.defineProperty(t,"masters",{get:function(){return this._masters}}),t._masters={}},t.organize=function(e,t,r){var n=this,o=[],i=r.masters;if(i){var s=t.settings.get("ajaxUtil",{});s.url.COMMON.baseUrl=t.settings.get("system.apiBaseUrl",""),Object.keys(i).forEach((function(e){o.push(n._initMaster(t,e,i[e],s))}))}return Promise.all(o).then((function(){return r}))},t._initMaster=function(e,t,r,n){if(e._masters[t]=new a(t,Object.assign({settings:n},r)),r.autoLoad)return e._masters[t].load()},t}(BITSMIST.v1.Organizer),u=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.globalInit=function(){t.__preferences=new BITSMIST.v1.Store,t.__observers=new BITSMIST.v1.ObservableStore({filter:t.__filter}),t.__loaded={},t.__loaded.promise=new Promise((function(e,r){t.__loaded.resolve=e,t.__loaded.reject=r,setTimeout((function(){r("Time out waiting for loading preferences.")}),1e4)})),Object.defineProperty(t,"preferences",{get:function(){return t.__preferences}})},t.init=function(e,r,n){Object.defineProperty(r,"preferences",{get:function(){return this._preferences}}),r._preferences=new p(r),t.__observers.subscribe(r.uniqueId,r.setup.bind(r),{targets:BITSMIST.v1.Util.safeGet(n,"preferences.targets")})},t.organize=function(e,r,n){var o=Promise.resolve();return r.settings.get("preferences.load")&&(t.__preferences.items=r.settings.get("preferences.defaults"),o=t._load(r).then((function(e){t.__preferences.merge(e),t.__loaded.resolve()}))),o.then((function(){return t.__loaded.promise})).then((function(){return n.newPreferences=t.__preferences.items,n}))},t._setup=function(e,r){return(r=Object.assign({},r)).sender&&r.sender,t.__observers.notify(r).then((function(){r.newPreferences&&(t.__preferences.merge(r.newPreferences),t._save(e))}))},t._load=function(e,t){var r=t&&t.sender?t.sender:e;return e.trigger("doLoadStore",r)},t._save=function(e,r){var n=r&&r.sender?r.sender:e;return e.trigger("doSaveStore",n,{data:t.__preferences.items})},t.__filter=function(e,t){var r=!1,n=t.targets;if("*"==n)return!0;if(n)for(var o=0;o<n.length;o++)if(e.newPreferences.hasOwnProperty(n[o])){r=!0;break}return r},t}(BITSMIST.v1.Organizer),p=function(e){this._component=e},l={items:{configurable:!0}};l.items.get=function(){return u.__preferences.items},p.prototype.set=function(e,t){return u.__preferences.set(e,t)},p.prototype.get=function(e){return u.__preferences.get(e)},p.prototype.load=function(){return u._load(this._component)},p.prototype.save=function(){return u._save(this._component)},p.prototype.setup=function(e){return u._setup(this._component,e)},Object.defineProperties(p.prototype,l);var f=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.organize=function(e,r,n){var o=n.elements;return o&&Object.keys(o).forEach((function(e){r.addEventHandler(e,{handler:t.onDoOrganize,options:{attrs:o[e]}})})),n},t.onDoOrganize=function(e,r,n){var o=n.component,i=n.options.attrs;Object.keys(i).forEach((function(e){t.__initAttr(o,e,i[e])}))},t.__getTargetElements=function(e,t,r){return r.rootNode?"this"==r.rootNode||r.rootNode==e.tagName.toLowerCase()?[e]:e.querySelectorAll(r.rootNode):"this"==t||t==e.tagName.toLowerCase()?[e]:e.querySelectorAll("#"+t)},t.__initAttr=function(e,r,n){if(n)for(var o=t.__getTargetElements(e,r,n),i=function(e){Object.keys(n).forEach((function(t){switch(t){case"attribute":Object.keys(n[t]).forEach((function(r){o[e].setAttribute(r,n[t][r])}));break;case"style":Object.keys(n[t]).forEach((function(r){o[e].style[r]=n[t][r]}));break;case"property":Object.keys(n[t]).forEach((function(r){o[e][r]=n[t][r]}))}}))},s=0;s<o.length;s++)i(s)},t}(BITSMIST.v1.Organizer),h=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.init=function(e,n,o){Object.defineProperty(n,"binds",{get:function(){return this._binds},set:function(e){t.update(this,e)}}),n.bindData=function(e){return t._bindData(this,e)},n._binds=new r},t.organize=function(e,r,n){var o=n.binds;return r.addEventHandler("afterAppend",{handler:t.onAfterAppend,options:{data:o}}),n},t.update=function(e,r){e.binds.items=r,t._bindData(e)},t.onAfterAppend=function(e,r,n){var o=n.component,i=n.options.data;t.update(o,i)},t._bindData=function(e,t){(t=t||e).querySelectorAll("[bm-bind]").forEach((function(t){e.binds.bindTo(t)}))},t}(BITSMIST.v1.Organizer),d=function(e,t){var r=this;this._component=e,this._options=new BITSMIST.v1.Store({items:Object.assign({},this._getOptions(),t)}),this._options.set("name",this._options.get("name",this.constructor.name));var n=this._options.get("events",{});if(Object.keys(n).forEach((function(t){e.addEventHandler(t,n[t],null,r)})),this._options.get("expose")){var o=this;Object.defineProperty(e.__proto__,this._options.get("expose"),{get:function(){return o}})}},g={name:{configurable:!0},component:{configurable:!0}};g.name.get=function(){return this._options.get("name")},g.component.get=function(){return this._component},g.component.set=function(e){this._component=e},d.prototype._getOptions=function(){return{}},Object.defineProperties(d.prototype,g);var _=function(e){function t(t,r){e.call(this,t,r),this._cookieName=this._options.get("cookieOptions.name","preferences")}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.onDoLoadStore=function(e,t,r){return this.__getCookie(this._cookieName)},t.prototype.onDoSaveStore=function(e,t,r){this.__setCookie(this._cookieName,t.detail.data)},t.prototype._getOptions=function(){return{events:{doLoadStore:this.onDoLoadStore,doSaveStore:this.onDoSaveStore}}},t.prototype.__getCookie=function(e){var t=document.cookie.split(";").reduce((function(e,t){var r=t.split("="),n=r[0],o=r[1];return n&&(e[n.trim()]=o?decodeURIComponent(o.trim()):void 0),e}),{});return t[e]?JSON.parse(t[e]):{}},t.prototype.__setCookie=function(e,t){var r=e+"="+encodeURIComponent(JSON.stringify(t))+"; ",n=this._options.get("cookieOptions",{});r+=Object.keys(n).reduce((function(e,t){return e+=t+"="+n[t]+"; "}),""),document.cookie=r},t}(d),m=function(e){function t(t,r){var n=this;e.call(this,t,r),this._options.set("settings",this._component.settings.get("ajaxUtil","")),this._options.set("settings.url.COMMON.baseUrl",this._component.settings.get("system.apiBaseUrl","")),this._resources={},this._defaultResourceName;var o=this._options.get("resources",[]);Object.keys(o).forEach((function(e){var t=o[e];n.addResource(t,{settings:n._options.get("settings",{})})})),this.switchResource(o[0])}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.addResource=function(e,t){this._resources[e]=new s(e,Object.assign({settings:t.settings})),this[e]=this._resources[e]},t.prototype.switchResource=function(e){this._defaultResourceName=e},t.prototype.onDoFetch=function(e,t,r){var n=this,o=BITSMIST.v1.Util.safeGet(t.detail.target,"id"),i=BITSMIST.v1.Util.safeGet(t.detail.target,"parameters");if(BITSMIST.v1.Util.safeGet(t.detail.options,"autoLoad",this._options.get("autoLoad")))return this._resources[this._defaultResourceName].get(o,i).then((function(e){n._component.data=e,"items"in n._component?n._component.items=n._options.get("itemsGetter",(function(e){return e.data}))(e):"item"in n._component&&(n._component.item=n._options.get("itemGetter",(function(e){return e.data[0]}))(e))}))},t.prototype.onDoSubmit=function(e,t,r){var n=this,o=BITSMIST.v1.Util.safeGet(t.detail.target,"id");BITSMIST.v1.Util.safeGet(t.detail.target,"parameters");var i=BITSMIST.v1.Util.safeGet(t.detail,"items"),s=[],a={};r.component.querySelectorAll("[bm-bind]").forEach((function(e){e.hasAttribute("bm-submit")&&(a[e.getAttribute("bm-bind")]=!0)}));for(var c=function(e){var t={};Object.keys(i[e]).forEach((function(r){a[r]&&(t[r]=i[e][r])})),s.push(t)},u=0;u<i.length;u++)c(u);return Promise.resolve().then((function(){return o?n._resources[n._defaultResourceName].update(o,{items:s}):n._resources[n._defaultResourceName].insert(o,{items:s})}))},t.prototype._getOptions=function(){return{events:{doFetch:this.onDoFetch,doSubmit:this.onDoSubmit}}},t}(d);function v(){}function b(){}function y(e){return Reflect.construct(BITSMIST.v1.Pad,[e],this.constructor)}function S(){return Reflect.construct(BITSMIST.v1.Pad,[],this.constructor)}v.format=function(e,t,r){var n=r;switch(t.toLowerCase()){case"yyyy/mm/dd":n=v.formatDate(t,n);break;case"price":n=v.formatPrice(t,n)}return n},v.formatPrice=function(e,t){return t?"¥"+String(parseInt(t)).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,"):""},v.formatNumber=function(e){return e?String(parseInt(e)).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,"):""},v.formatDate=function(e,t){var r="";return t&&8==t.length&&(r=t.substr(0,4)+"/"+t.substr(4,2)+"/"+t.substr(6,2)),r},v.deformat=function(e,t,r){var n=r;switch(t){case"yyyy/mm/dd":n=v.deformatDate(t,r);break;case"price":n=v.deformatPrice(t,r)}return n},v.deformatPrice=function(e,t){var r="";return t&&(r=t.replace(/,/g,"").replace(/\//g,"").replace(/\\/g,"").replace("¥","")),r},v.deformatDate=function(e,t){var r="";return t&&(r=t.replace(/,/g,"").replace(/\//g,"").replace(/\\/g,"")),r},v.getNow=function(e){e=e||"-";var t=new Date;return t.getFullYear()+e+("00"+(t.getMonth()+1)).slice(-2)+e+("00"+t.getDate()).slice(-2)+" "+("00"+t.getHours()).slice(-2)+":"+("00"+t.getMinutes()).slice(-2)+":"+("00"+t.getSeconds()).slice(-2)},v.getToday=function(e){e=void 0===e?"-":e;var t=new Date;return t.getFullYear()+e+("00"+(t.getMonth()+1)).slice(-2)+e+("00"+t.getDate()).slice(-2)},v.sanitize=function(e){return"string"==typeof e?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"):e},b.setFields=function(e,t,r){var n=this,o=e.querySelectorAll("[bm-bind]");Array.prototype.concat([e],Array.prototype.slice.call(o,0)).forEach((function(e){var o=e.getAttribute("bm-bind");if(o in t)if(e.hasAttribute("bm-master")){var i=e.getAttribute("bm-master"),s=n.getMasterValue(r,i,t[o]);n.setValue(e,s)}else n.setValue(e,t[o])}))},b.getFields=function(e,t){var r=this,n={};t=t||"";var o=e.querySelectorAll(t+" [bm-submit]");return(o=Array.prototype.slice.call(o,0)).forEach((function(e){var t=e.getAttribute("bm-bind"),o=r.getValue(e);if(Array.isArray(n[t]))o&&n[t].push(o);else if(n[t]){if(o){var i=[];i.push(n[t]),i.push(o),n[t]=i}}else n[t]=o})),n},b.clearFields=function(e,t){t=t||"";var r=e.querySelectorAll(t+" input");(r=Array.prototype.slice.call(r,0)).forEach((function(e){switch(e.type.toLowerCase()){case"search":case"text":case"number":e.value="";break;case"checkbox":case"radio":e.checked=!1}})),r=e.querySelectorAll(t+" select"),(r=Array.prototype.slice.call(r,0)).forEach((function(e){e.selectedIndex=-1}))},b.buildFields=function(e,t,r){var n=e.querySelectorAll("[bm-bind='"+t+"']");(n=Array.prototype.slice.call(n,0)).forEach((function(e){if("select"==e.tagName.toLowerCase()){if(e.options.length=0,"emptyItem"in r){var t="text"in r.emptyItem?r.emptyItem.text:"",n="value"in r.emptyItem?r.emptyItem.value:"",o=document.createElement("option");o.text=t,o.value=n,o.setAttribute("selected",""),e.appendChild(o)}Object.keys(r.items).forEach((function(t){var n=document.createElement("option");n.text=r.items[t].title,n.value=t,e.appendChild(n)}))}else Object.keys(r.items).forEach((function(t){var n=document.createElement("label"),o=document.createElement("input");o.type="radio",o.id=key,o.name=key,o.value=t,o.setAttribute("bm-bind",key),o.setAttribute("bm-submit",""),n.appendChild(o),n.appendChild(document.createTextNode(r.items[t].title)),e.appendChild(n)}))}))},b.getMasterValue=function(e,t,r){var n=r;return e&&t in e&&(n=e[t].getValue(r)),n},b.setValue=function(e,t){null!==t&&null!=t||(t=""),e.hasAttribute("bm-format")&&(t=v.format("",e.getAttribute("bm-format"),t));var r=v.sanitize(t),n=e.getAttribute("bm-target");if(n)for(var o=n.split(","),i=0;i<o.length;i++){var s=o[i].toLowerCase();switch(s){case"html":e.innerHTML=t;break;case"href":case"src":case"rel":"http"!=t.substring(0,4)&&"/"!=t.substring(0,1)||e.setAttribute(s,t);break;default:var a=e.getAttribute(s);a=a?a+" "+t:r,e.setAttribute(s,a)}}else if(e.hasAttribute("value"))"input"==e.tagName.toLowerCase()&&"checkbox"==e.type.toLowerCase()||"input"==e.tagName.toLowerCase()&&"radio"==e.type.toLowerCase()?Array.isArray(t)?t.indexOf(e.getAttribute("value"))>-1&&(e.checked=!0):e.getAttribute("value")==t&&(e.checked=!0):e.setAttribute("value",v.sanitize(t));else if("select"==e.tagName.toLowerCase())e.value=t;else if("fieldset"==e.tagName.toLowerCase());else if("input"==e.tagName.toLowerCase())switch(e.type.toLowerCase()){case"number":case"search":case"text":e.value=t;break;case"checkbox":e.checked=!!t;break;case"radio":e.value==t&&(e.checked=!0)}else e.innerText=t;var c=document.createEvent("HTMLEvents");c.initEvent("change",!0,!0),e.dispatchEvent(c)},b.getValue=function(e){var t=void 0;switch(e.tagName.toLowerCase()){case"input":switch(e.type.toLowerCase()){case"radio":case"checkbox":e.checked&&(t=e.hasAttribute("value")?e.getAttribute("value"):e.checked);break;default:t=e.value}break;case"select":t=e.value;break;default:e.hasAttribute("selected")&&(t=e.getAttribute("value"))}return e.hasAttribute("bm-format")&&(t=BITSMIST.v1.FormatterUtil.deformat("",e.getAttribute("bm-format"),t)),t},b.reportValidity=function(e){var t=!0,r=e.querySelectorAll("input");return(r=Array.prototype.slice.call(r,0)).forEach((function(e){switch(e.getAttribute("type")){case"number":(e.validity&&0==e.validity.valid||isNaN(e.value))&&(e.style.border="solid 3px red",t=!1)}})),t},BITSMIST.v1.ClassUtil.inherit(y,BITSMIST.v1.Pad),Object.defineProperty(y.prototype,"item",{get:function(){return this._item},set:function(e){this._item=e}}),Object.defineProperty(y.prototype,"data",{get:function(){return this._data},set:function(e){this._data=e}}),y.prototype.start=function(e){return this._id,this._parameters,this._item={},this.__cancelSubmit=!1,this._target={},e=Object.assign({},e,{settings:{autoClear:!0}}),BITSMIST.v1.Pad.prototype.start.call(this,e)},y.prototype.build=function(e){var t=this;Object.keys(e).forEach((function(r){b.buildFields(t,r,e[r])}))},y.prototype.fill=function(e){var t=this,r=(e=Object.assign({},e)).sender?e.sender:this,n="target"in e?this.querySelector(e.target):this;return this._target.id="id"in e?e.id:this._target.id,this._target.parameters="parameters"in e?e.parameters:this._target.parameters,BITSMIST.v1.Util.safeGet(e,"settings.autoClear",this._settings.get("settings.autoClear"))&&this.clear(n),Promise.resolve().then((function(){if(BITSMIST.v1.Util.safeGet(e,"autoLoad",!0))return Promise.resolve().then((function(){return t.trigger("doTarget",r,{target:t._target,options:e})})).then((function(){return t.trigger("beforeFetch",r,{target:t._target,options:e})})).then((function(){return t.trigger("doFetch",r,{target:t._target,options:e})})).then((function(){return t.trigger("afterFetch",r,{target:t._target,options:e})}))})).then((function(){return t.trigger("beforeFill",r)})).then((function(){var n="target"in e?t.querySelector(e.target):t;return b.setFields(n,t._item,t.masters),t.trigger("afterFill",r)}))},y.prototype.clear=function(e,t){return e=e||this,b.clearFields(e,t)},y.prototype.validate=function(e){var t=this,r=(e=Object.assign({},e)).sender?e.sender:this;return Promise.resolve().then((function(){return t.trigger("beforeValidate",r)})).then((function(){var e=!0,n=t.querySelector("form");return t.settings.get("settings.autoValidate")&&(e=n&&n.reportValidity?n.reportValidity():b.reportValidity(t)),e||(t.__cancelSubmit=!0),t.trigger("afterValidate",r)}))},y.prototype.submit=function(e){var t=this,r=(e=Object.assign({},e)).sender?e.sender:this;return delete e.sender,this.__cancelSubmit=!1,this._item=this.getFields(),Promise.resolve().then((function(){return t.validate()})).then((function(){return t.trigger("beforeSubmit",r)})).then((function(){if(!t.__cancelSubmit){var e=t.settings.get("settings.itemGetter",(function(e){return[e]}))(t._item);return t.trigger("doSubmit",r,{target:t._target,items:e})}})).then((function(){var e=t.settings.get("settings.itemGetter",(function(e){return[e]}))(t._item);return t.trigger("afterSubmit",r,{target:t._target,items:e})}))},y.prototype.getFields=function(){return b.getFields(this)},BITSMIST.v1.ClassUtil.inherit(S,BITSMIST.v1.Pad),Object.defineProperty(S.prototype,"row",{get:function(){return this._row}}),Object.defineProperty(S.prototype,"items",{get:function(){return this._items},set:function(e){this._items=e}}),Object.defineProperty(S.prototype,"data",{get:function(){return this._data},set:function(e){this._data=e}}),S.prototype.onListAfterAppend=function(e,t,r){this._listRootNode=this.querySelector(this._settings.get("settings.listRootNode"));var n=this._settings.get("components")[this._settings.get("settings.row")].className?this._settings.get("components")[this._settings.get("row")].className:this._settings.get("settings.row");return this._row=BITSMIST.v1.ClassUtil.createObject(n),this._row._parent=this,this._row.start()},S.prototype.start=function(e){return this._id,this._parameters,this._target={},this._data,this._items,this._listRootNode,this._row,this._rows,e=Object.assign({},e,{events:{this:{handlers:{afterAppend:[{handler:this.onListAfterAppend}]}}}}),BITSMIST.v1.Pad.prototype.start.call(this,e)},S.prototype.clear=function(){this._listRootNode.innerHTML=""},S.prototype.fill=function(e){var t=this,r=(e=Object.assign({},e)).sender?e.sender:this,n=this._settings.get("settings.async")?this._buildAsync:this._buildSync,o=document.createDocumentFragment();return this._rows=[],this._target.id="id"in e?e.id:this._target.id,this._target.parameters="parameters"in e?e.parameters:this._target.parameters,Promise.resolve().then((function(){if(BITSMIST.v1.Util.safeGet(e,"autoLoad",!0))return Promise.resolve().then((function(){return t.trigger("doTarget",t,{target:t._target,options:e})})).then((function(){return t.trigger("beforeFetch",r,{target:t._target,options:e})})).then((function(){return t.trigger("doFetch",r,{target:t._target,options:e})})).then((function(){return t.trigger("afterFetch",r,{target:t._target,options:e})}))})).then((function(){return t.trigger("beforeFill",r)})).then((function(){if(t._items)return n.call(t,o)})).then((function(){BITSMIST.v1.Util.safeGet(e,"autoClear",t._settings.get("settings.autoClear"))&&t.clear()})).then((function(){t._listRootNode.appendChild(o)})).then((function(){return t.trigger("afterFill",r)}))},S.prototype._buildSync=function(e){for(var t=this._row.settings.get("rowevents"),r=this._row._templates[this._row.settings.get("settings.templateName")].html,n=0;n<this._items.length;n++)this.__appendRowSync(e,n,this._items[n],r,t)},S.prototype._buildAsync=function(e){for(var t=this,r=Promise.resolve(),n=this._row._templates[this._row.settings.get("settings.templateName")].html,o=function(o){r=r.then((function(){return t.__appendRowAsync(e,o,t._items[o],n)}))},i=0;i<t._items.length;i++)o(i);return r},S.prototype.__appendRowAsync=function(e,t,r,n,o){var i=this,s=document.createElement("div");s.innerHTML=n;var a=s.firstElementChild;return e.appendChild(a),this._rows.push(a),o&&Object.keys(o).forEach((function(e){i._row.initEvents(e,o[e],a)})),Promise.resolve().then((function(){return i._row.trigger("beforeFillRow",i,{item:r,no:t,element:a})})).then((function(){b.setFields(a,r,i.masters)})).then((function(){return i._row.trigger("afterFillRow",i,{item:r,no:t,element:a})}))},S.prototype.__appendRowSync=function(e,t,r,n,o){var i=this,s=document.createElement("div");s.innerHTML=n;var a=s.firstElementChild;e.appendChild(a),this._rows.push(a),o&&Object.keys(o).forEach((function(e){i._row.initEvents(e,o[e],a)})),this._row.triggerAsync("beforeFillRow",this,{item:r,no:t,element:a}),b.setFields(a,r,this.masters),this.row.triggerAsync("afterFillRow",this,{item:r,no:t,element:a})};var T=function(e){function t(t,r){e.call(this,t,r),this.__isComposing=!1}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.onAfterAppend=function(e,t,r){var n=this._options.get("features.defaultKeys");n&&(this._component.addEventHandler("keydown",{handler:this.onKeyDown,options:n},null,this),this._component.addEventHandler("keypress",{handler:this.onKeyPress,options:n},null,this),this._component.addEventHandler("compositionstart",{handler:this.onCompositionStart,options:n},null,this),this._component.addEventHandler("compositionend",{handler:this.onCompositionEnd,options:n},null,this));var o=this._options.get("features.defaultButtons");o&&(this.__initElements(o.submit,this.onDefaultSubmit),this.__initElements(o.cancel,this.onDefaultCancel),this.__initElements(o.clear,this.onDefaultClear))},t.prototype.onKeyDown=function(e,t,r){var n=t.key?t.key:this.__getKeyfromKeyCode(t.keyCode);switch(n="esc"==(n=n.toLowerCase())?"escape":n){case"escape":this.onKeyPress(e,t,r)}},t.prototype.onKeyPress=function(e,t,r){if(!this.__isComposing&&229!=t.keyCode){var n=t.key?t.key:this.__getKeyfromKeyCode(t.keyCode);n="esc"==(n=n.toLowerCase())?"escape":n,r.options.submit&&n==r.options.submit.key?this.onDefaultSubmit(e,t,{options:r.options.submit}):r.options.cancel&&n==r.options.cancel.key?this.onDefaultCancel(e,t,{options:r.options.cancel}):r.options.clear&&n==r.options.clear.key&&this.onDefaultClear(e,t,{options:r.options.clear})}},t.prototype.onCompositionStart=function(e,t,r){this.__isComposing=!0},t.prototype.onCompositionEnd=function(e,t,r){this.__isComposing=!1},t.prototype.onDefaultSubmit=function(e,t,r){var n=this;this._component.submit().then((function(){n._component.__cancelSubmit||(n._component._isModal&&(n._component._modalResult.result=!0),r&&r.options.autoClose&&n._component.close())}))},t.prototype.onDefaultCancel=function(e,t,r){this._component.close()},t.prototype.onDefaultClear=function(e,t,r){var n;r&&r.options.target&&(n=e.getAttribute(r.options.target)),this._component.clear(n)},t.prototype.__getKeyfromKeyCode=function(e){var t;switch(e){case 13:t="Enter";break;default:t=String.fromCharCode(e)}return t},t.prototype.__initElements=function(e,t){var r=this;if(e){var n=this._component.querySelectorAll(e.rootNode);(n=Array.prototype.slice.call(n,0)).forEach((function(n){r._component.addEventHandler("click",{handler:t,options:e},n,r)}))}},t.prototype._getOptions=function(){return{events:{afterAppend:this.onAfterAppend}}},t}(d),I=function(e){function t(t,r){e.call(this,"authentications",r)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.authenticate=function(e,t,r){var n=this;return new Promise((function(o,i){n.get("list",{user:e,password:t}).then((function(e){e.result.resultCount>0?r&&"redirect"in r&&(location.href=decodeURI(r.redirect)):i("login failed")}))}))},t}(s);window.BITSMIST=window.BITSMIST||{},window.BITSMIST.v1=window.BITSMIST.v1||{},window.BITSMIST.v1.ObservableStore=e,window.BITSMIST.v1.BindableStore=r,BITSMIST.v1.OrganizerOrganizer.organizers.set("ErrorOrganizer",{object:n,targetWords:"errors",targetEvents:["beforeStart"],order:100}),BITSMIST.v1.OrganizerOrganizer.organizers.set("PluginOrganizer",{object:o,targetWords:"plugins",targetEvents:["beforeStart"],order:400}),BITSMIST.v1.OrganizerOrganizer.organizers.set("FileOrganizer",{object:i,targetWords:"files",targetEvents:["afterSpecLoad"],order:400}),BITSMIST.v1.OrganizerOrganizer.organizers.set("MasterOrganizer",{object:c,targetWords:"masters",targetEvents:["beforeStart","afterSpecLoad"],order:400}),BITSMIST.v1.OrganizerOrganizer.organizers.set("PreferenceOrganizer",{object:u,targetWords:"preferences",targetEvents:["beforeStart"],order:500}),BITSMIST.v1.OrganizerOrganizer.organizers.set("ElementOrganizer",{object:f,targetWords:"elements",targetEvents:["beforeStart"],order:600}),BITSMIST.v1.OrganizerOrganizer.organizers.set("DatabindingOrganizer",{object:h,targetWords:"data",targetEvents:["beforeStart"],order:900}),BITSMIST.v1.OrganizerOrganizer.organizers.get("EventOrganizer").targetEvents.push("afterSpecLoad"),window.BITSMIST.v1.Plugin=d,window.BITSMIST.v1.CookieStoreHandler=_,window.BITSMIST.v1.ResourceHandler=m,window.BITSMIST.v1.Form=y,window.BITSMIST.v1.List=S,window.BITSMIST.v1.DefaultkeyHandler=T,window.BITSMIST.v1.AuthenticationUtil=I,window.BITSMIST.v1.FormatterUtil=v,window.BITSMIST.v1.MasterUtil=a,window.BITSMIST.v1.ResourceUtil=s,BITSMIST.v1.preferences=u.preferences,BITSMIST.v1.ClassUtil.newComponent(BITSMIST.v1.Component,{settings:{name:"PreferenceManager"}},"bm-preference","PreferenceManager")}();
